"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4928],{8541:function(a,b,c){c.r(b),c.d(b,{AbortException:function(){return pK},AnnotationEditorLayer:function(){return pL},AnnotationEditorParamsType:function(){return pM},AnnotationEditorType:function(){return pN},AnnotationEditorUIManager:function(){return pO},AnnotationLayer:function(){return pP},AnnotationMode:function(){return pQ},ColorPicker:function(){return pR},DOMSVGFactory:function(){return pS},DrawLayer:function(){return pT},FeatureTest:function(){return pU},GlobalWorkerOptions:function(){return pV},ImageKind:function(){return pW},InvalidPDFException:function(){return pX},MissingPDFException:function(){return pY},OPS:function(){return pZ},OutputScale:function(){return p$},PDFDataRangeTransport:function(){return p_},PDFDateString:function(){return p0},PDFWorker:function(){return p1},PasswordResponses:function(){return p2},PermissionFlag:function(){return p3},PixelsPerInch:function(){return p4},RenderingCancelledException:function(){return p5},TextLayer:function(){return p6},UnexpectedResponseException:function(){return p7},Util:function(){return p8},VerbosityLevel:function(){return p9},XfaLayer:function(){return qa},build:function(){return qb},createValidAbsoluteUrl:function(){return qc},fetchData:function(){return qd},getDocument:function(){return qe},getFilenameFromUrl:function(){return qf},getPdfFilenameFromUrl:function(){return qg},getXfaPageViewport:function(){return qh},isDataScheme:function(){return qi},isPdfFile:function(){return qj},noContextMenu:function(){return qk},normalizeUnicode:function(){return ql},setLayerDimensions:function(){return qm},shadow:function(){return qn},version:function(){return qo}});var d=c(3454),e=c(8764).Buffer,f={};f.d=(a,b)=>{for(var c in b)f.o(b,c)&&!f.o(a,c)&&Object.defineProperty(a,c,{enumerable:!0,get:b[c]})},f.o=(a,b)=>Object.prototype.hasOwnProperty.call(a,b);var b=globalThis.pdfjsLib={};f.d(b,{AbortException:()=>J,AnnotationEditorLayer:()=>pf,AnnotationEditorParamsType:()=>m,AnnotationEditorType:()=>l,AnnotationEditorUIManager:()=>bs,AnnotationLayer:()=>hE,AnnotationMode:()=>k,ColorPicker:()=>kB,DOMSVGFactory:()=>gC,DrawLayer:()=>pw,FeatureTest:()=>N,GlobalWorkerOptions:()=>ee,ImageKind:()=>p,InvalidPDFException:()=>F,MissingPDFException:()=>G,OPS:()=>t,OutputScale:()=>aR,PDFDataRangeTransport:()=>gf,PDFDateString:()=>aL,PDFWorker:()=>gm,PasswordResponses:()=>u,PermissionFlag:()=>n,PixelsPerInch:()=>az,RenderingCancelledException:()=>aC,TextLayer:()=>ff,UnexpectedResponseException:()=>H,Util:()=>P,VerbosityLevel:()=>s,XfaLayer:()=>gD,build:()=>gx,createValidAbsoluteUrl:()=>A,fetchData:()=>aA,getDocument:()=>ga,getFilenameFromUrl:()=>aF,getPdfFilenameFromUrl:()=>aG,getXfaPageViewport:()=>aM,isDataScheme:()=>aD,isPdfFile:()=>aE,noContextMenu:()=>aJ,normalizeUnicode:()=>av,setLayerDimensions:()=>aQ,shadow:()=>B,version:()=>gw});let g="object"==typeof d&&d+""=="[object process]"&&!d.versions.nw&&!(d.versions.electron&&d.type&&"browser"!==d.type),h=[1,0,0,1,0,0],i=[.001,0,0,.001,0,0],j={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},k={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},l={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},m={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},n={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},o={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},p={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},q={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},r={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},s={ERRORS:0,WARNINGS:1,INFOS:5},t={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},u={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},v=s.WARNINGS;function w(a){v>=s.INFOS&&console.log(`Info: ${a}`)}function x(a){v>=s.WARNINGS&&console.log(`Warning: ${a}`)}function y(a){throw Error(a)}function z(a,b){a||y(b)}function A(a,b=null,c=null){if(!a)return null;try{if(c&&"string"==typeof a){if(c.addDefaultProtocol&&a.startsWith("www.")){let d=a.match(/\./g);d?.length>=2&&(a=`http://${a}`)}if(c.tryConvertEncoding)try{a=as(a)}catch{}}let e=b?new URL(a,b):new URL(a);if(function(a){switch(a?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(e))return e}catch{}return null}function B(a,b,c,d=!1){return Object.defineProperty(a,b,{value:c,enumerable:!d,configurable:!0,writable:!1}),c}let C=function(){function a(a,b){this.message=a,this.name=b}return a.prototype=Error(),a.constructor=a,a}();class D extends C{constructor(a,b){super(a,"PasswordException"),this.code=b}}class E extends C{constructor(a,b){super(a,"UnknownErrorException"),this.details=b}}class F extends C{constructor(a){super(a,"InvalidPDFException")}}class G extends C{constructor(a){super(a,"MissingPDFException")}}class H extends C{constructor(a,b){super(a,"UnexpectedResponseException"),this.status=b}}class I extends C{constructor(a){super(a,"FormatError")}}class J extends C{constructor(a){super(a,"AbortException")}}function K(a){("object"!=typeof a||a?.length===void 0)&&y("Invalid argument for bytesToString");let b=a.length;if(b<8192)return String.fromCharCode.apply(null,a);let c=[];for(let d=0;d<b;d+=8192){let e=Math.min(d+8192,b),f=a.subarray(d,e);c.push(String.fromCharCode.apply(null,f))}return c.join("")}function L(a){"string"!=typeof a&&y("Invalid argument for stringToBytes");let b=a.length,c=new Uint8Array(b);for(let d=0;d<b;++d)c[d]=255&a.charCodeAt(d);return c}function M(a){let b=Object.create(null);for(let[c,d]of a)b[c]=d;return b}class N{static get isLittleEndian(){return B(this,"isLittleEndian",function(){let a=new Uint8Array(4);a[0]=1;let b=new Uint32Array(a.buffer,0,1);return 1===b[0]}())}static get isEvalSupported(){return B(this,"isEvalSupported",function(){try{return Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return B(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get platform(){return"undefined"!=typeof navigator&&"string"==typeof navigator?.platform?B(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:"string"==typeof navigator?.userAgent&&navigator.userAgent.includes("Firefox")}):B(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return B(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}let O=Array.from(Array(256).keys(),a=>a.toString(16).padStart(2,"0"));class P{static makeHexColor(a,b,c){return`#${O[a]}${O[b]}${O[c]}`}static scaleMinMax(a,b){let c;a[0]?(a[0]<0&&(c=b[0],b[0]=b[2],b[2]=c),b[0]*=a[0],b[2]*=a[0],a[3]<0&&(c=b[1],b[1]=b[3],b[3]=c),b[1]*=a[3],b[3]*=a[3]):(c=b[0],b[0]=b[1],b[1]=c,c=b[2],b[2]=b[3],b[3]=c,a[1]<0&&(c=b[1],b[1]=b[3],b[3]=c),b[1]*=a[1],b[3]*=a[1],a[2]<0&&(c=b[0],b[0]=b[2],b[2]=c),b[0]*=a[2],b[2]*=a[2]),b[0]+=a[4],b[1]+=a[5],b[2]+=a[4],b[3]+=a[5]}static transform(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]}static applyTransform(a,b){let c=a[0]*b[0]+a[1]*b[2]+b[4],d=a[0]*b[1]+a[1]*b[3]+b[5];return[c,d]}static applyInverseTransform(a,b){let c=b[0]*b[3]-b[1]*b[2],d=(a[0]*b[3]-a[1]*b[2]+b[2]*b[5]-b[4]*b[3])/c,e=(-a[0]*b[1]+a[1]*b[0]+b[4]*b[1]-b[5]*b[0])/c;return[d,e]}static getAxialAlignedBoundingBox(a,b){let c=this.applyTransform(a,b),d=this.applyTransform(a.slice(2,4),b),e=this.applyTransform([a[0],a[3]],b),f=this.applyTransform([a[2],a[1]],b);return[Math.min(c[0],d[0],e[0],f[0]),Math.min(c[1],d[1],e[1],f[1]),Math.max(c[0],d[0],e[0],f[0]),Math.max(c[1],d[1],e[1],f[1])]}static inverseTransform(a){let b=a[0]*a[3]-a[1]*a[2];return[a[3]/b,-a[1]/b,-a[2]/b,a[0]/b,(a[2]*a[5]-a[4]*a[3])/b,(a[4]*a[1]-a[5]*a[0])/b]}static singularValueDecompose2dScale(a){let b=[a[0],a[2],a[1],a[3]],c=a[0]*b[0]+a[1]*b[2],d=a[0]*b[1]+a[1]*b[3],e=a[2]*b[0]+a[3]*b[2],f=a[2]*b[1]+a[3]*b[3],g=(c+f)/2,h=Math.sqrt((c+f)**2-4*(c*f-e*d))/2;return[Math.sqrt(g+h||1),Math.sqrt(g-h||1)]}static normalizeRect(a){let b=a.slice(0);return a[0]>a[2]&&(b[0]=a[2],b[2]=a[0]),a[1]>a[3]&&(b[1]=a[3],b[3]=a[1]),b}static intersect(a,b){let c=Math.max(Math.min(a[0],a[2]),Math.min(b[0],b[2])),d=Math.min(Math.max(a[0],a[2]),Math.max(b[0],b[2]));if(c>d)return null;let e=Math.max(Math.min(a[1],a[3]),Math.min(b[1],b[3])),f=Math.min(Math.max(a[1],a[3]),Math.max(b[1],b[3]));return e>f?null:[c,e,d,f]}static  #a(Q,R,S,T,U,V,W,X,Y,Z){if(Y<=0||Y>=1)return;let $=1-Y,_=Y*Y,aa=_*Y,ab=$*($*($*Q+3*Y*R)+3*_*S)+aa*T,ac=$*($*($*U+3*Y*V)+3*_*W)+aa*X;Z[0]=Math.min(Z[0],ab),Z[1]=Math.min(Z[1],ac),Z[2]=Math.max(Z[2],ab),Z[3]=Math.max(Z[3],ac)}static  #b(ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao){if(1e-12>Math.abs(al)){Math.abs(am)>=1e-12&&this.#a(ad,ae,af,ag,ah,ai,aj,ak,-an/am,ao);return}let ap=am**2-4*an*al;if(ap<0)return;let aq=Math.sqrt(ap),ar=2*al;this.#a(ad,ae,af,ag,ah,ai,aj,ak,(-am+aq)/ar,ao),this.#a(ad,ae,af,ag,ah,ai,aj,ak,(-am-aq)/ar,ao)}static bezierBoundingBox(a,b,c,d,e,f,g,h,i){return i?(i[0]=Math.min(i[0],a,g),i[1]=Math.min(i[1],b,h),i[2]=Math.max(i[2],a,g),i[3]=Math.max(i[3],b,h)):i=[Math.min(a,g),Math.min(b,h),Math.max(a,g),Math.max(b,h)],this.#b(a,c,e,g,b,d,f,h,3*(-a+3*(c-e)+g),6*(a-2*c+e),3*(c-a),i),this.#b(a,c,e,g,b,d,f,h,3*(-b+3*(d-f)+h),6*(b-2*d+f),3*(d-b),i),i}}function as(a){return decodeURIComponent(escape(a))}let at=null,au=null;function av(a){return at||(at=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,au=new Map([["ﬅ","ſt"]])),a.replaceAll(at,(a,b,c)=>b?b.normalize("NFKC"):au.get(c))}let aw="pdfjs_internal_id_",ax={BEZIER_CURVE_TO:0,MOVE_TO:1,LINE_TO:2,QUADRATIC_CURVE_TO:3,RESTORE:4,SAVE:5,SCALE:6,TRANSFORM:7,TRANSLATE:8},ay="http://www.w3.org/2000/svg";class az{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function aA(a,b="text"){if(aI(a,document.baseURI)){let c=await fetch(a);if(!c.ok)throw Error(c.statusText);switch(b){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"json":return c.json()}return c.text()}return new Promise((c,d)=>{let e=new XMLHttpRequest;e.open("GET",a,!0),e.responseType=b,e.onreadystatechange=()=>{if(e.readyState===XMLHttpRequest.DONE){if(200===e.status||0===e.status){switch(b){case"arraybuffer":case"blob":case"json":c(e.response);return}c(e.responseText);return}d(Error(e.statusText))}},e.send(null)})}class aB{constructor({viewBox:a,scale:b,rotation:c,offsetX:d=0,offsetY:e=0,dontFlip:f=!1}){this.viewBox=a,this.scale=b,this.rotation=c,this.offsetX=d,this.offsetY=e;let g=(a[2]+a[0])/2,h=(a[3]+a[1])/2,i,j,k,l;switch((c%=360)<0&&(c+=360),c){case 180:i=-1,j=0,k=0,l=1;break;case 90:i=0,j=1,k=1,l=0;break;case 270:i=0,j=-1,k=-1,l=0;break;case 0:i=1,j=0,k=0,l=-1;break;default:throw Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}f&&(k=-k,l=-l);let m,n,o,p;0===i?(m=Math.abs(h-a[1])*b+d,n=Math.abs(g-a[0])*b+e,o=(a[3]-a[1])*b,p=(a[2]-a[0])*b):(m=Math.abs(g-a[0])*b+d,n=Math.abs(h-a[1])*b+e,o=(a[2]-a[0])*b,p=(a[3]-a[1])*b),this.transform=[i*b,j*b,k*b,l*b,m-i*b*g-k*b*h,n-j*b*g-l*b*h],this.width=o,this.height=p}get rawDims(){let{viewBox:a}=this;return B(this,"rawDims",{pageWidth:a[2]-a[0],pageHeight:a[3]-a[1],pageX:a[0],pageY:a[1]})}clone({scale:a=this.scale,rotation:b=this.rotation,offsetX:c=this.offsetX,offsetY:d=this.offsetY,dontFlip:e=!1}={}){return new aB({viewBox:this.viewBox.slice(),scale:a,rotation:b,offsetX:c,offsetY:d,dontFlip:e})}convertToViewportPoint(a,b){return P.applyTransform([a,b],this.transform)}convertToViewportRectangle(a){let b=P.applyTransform([a[0],a[1]],this.transform),c=P.applyTransform([a[2],a[3]],this.transform);return[b[0],b[1],c[0],c[1]]}convertToPdfPoint(a,b){return P.applyInverseTransform([a,b],this.transform)}}class aC extends C{constructor(a,b=0){super(a,"RenderingCancelledException"),this.extraDelay=b}}function aD(a){let b=a.length,c=0;for(;c<b&&""===a[c].trim();)c++;return"data:"===a.substring(c,c+5).toLowerCase()}function aE(a){return"string"==typeof a&&/\.pdf$/i.test(a)}function aF(a){return[a]=a.split(/[#?]/,1),a.substring(a.lastIndexOf("/")+1)}function aG(a,b="document.pdf"){if("string"!=typeof a)return b;if(aD(a))return x('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),b;let c=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,d=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(a),e=c.exec(d[1])||c.exec(d[2])||c.exec(d[3]);if(e&&(e=e[0]).includes("%"))try{e=c.exec(decodeURIComponent(e))[0]}catch{}return e||b}class aH{started=Object.create(null);times=[];time(a){a in this.started&&x(`Timer is already running for ${a}`),this.started[a]=Date.now()}timeEnd(a){a in this.started||x(`Timer has not been started for ${a}`),this.times.push({name:a,start:this.started[a],end:Date.now()}),delete this.started[a]}toString(){let a=[],b=0;for(let{name:c}of this.times)b=Math.max(c.length,b);for(let{name:d,start:e,end:f}of this.times)a.push(`${d.padEnd(b)} ${f-e}ms
`);return a.join("")}}function aI(a,b){try{let{protocol:c}=b?new URL(a,b):new URL(a);return"http:"===c||"https:"===c}catch{return!1}}function aJ(a){a.preventDefault()}function aK(a){console.log("Deprecated API usage: "+a)}class aL{static #c;static toDateObject(a){if(!a||"string"!=typeof a)return null;this.#c||=RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");let b=this.#c.exec(a);if(!b)return null;let c=parseInt(b[1],10),d=parseInt(b[2],10);d=d>=1&&d<=12?d-1:0;let e=parseInt(b[3],10);e=e>=1&&e<=31?e:1;let f=parseInt(b[4],10);f=f>=0&&f<=23?f:0;let g=parseInt(b[5],10);g=g>=0&&g<=59?g:0;let h=parseInt(b[6],10);h=h>=0&&h<=59?h:0;let i=b[7]||"Z",j=parseInt(b[8],10);j=j>=0&&j<=23?j:0;let k=parseInt(b[9],10)||0;return k=k>=0&&k<=59?k:0,"-"===i?(f+=j,g+=k):"+"===i&&(f-=j,g-=k),new Date(Date.UTC(c,d,e,f,g,h))}}function aM(a,{scale:b=1,rotation:c=0}){let{width:d,height:e}=a.attributes.style,f=[0,0,parseInt(d),parseInt(e)];return new aB({viewBox:f,scale:b,rotation:c})}function aN(a){if(a.startsWith("#")){let b=parseInt(a.slice(1),16);return[(16711680&b)>>16,(65280&b)>>8,255&b]}return a.startsWith("rgb(")?a.slice(4,-1).split(",").map(a=>parseInt(a)):a.startsWith("rgba(")?a.slice(5,-1).split(",").map(a=>parseInt(a)).slice(0,3):(x(`Not a valid color format: "${a}"`),[0,0,0])}function aO(a){let{a:b,b:c,c:d,d:e,e:f,f:g}=a.getTransform();return[b,c,d,e,f,g]}function aP(a){let{a:b,b:c,c:d,d:e,e:f,f:g}=a.getTransform().invertSelf();return[b,c,d,e,f,g]}function aQ(a,b,c=!1,d=!0){if(b instanceof aB){let{pageWidth:e,pageHeight:f}=b.rawDims,{style:g}=a,h=N.isCSSRoundSupported,i=`var(--scale-factor) * ${e}px`,j=`var(--scale-factor) * ${f}px`,k=h?`round(down, ${i}, var(--scale-round-x, 1px))`:`calc(${i})`,l=h?`round(down, ${j}, var(--scale-round-y, 1px))`:`calc(${j})`;c&&b.rotation%180!=0?(g.width=l,g.height=k):(g.width=k,g.height=l)}d&&a.setAttribute("data-main-rotation",b.rotation)}class aR{constructor(){let a=window.devicePixelRatio||1;this.sx=a,this.sy=a}get scaled(){return 1!==this.sx||1!==this.sy}get symmetric(){return this.sx===this.sy}}class aS{#d=null;#e=null;#f;#g=null;#h=null;static #i=null;constructor(a){this.#f=a,aS.#i||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){let a=this.#d=document.createElement("div");a.classList.add("editToolbar","hidden"),a.setAttribute("role","toolbar");let b=this.#f._uiManager._signal;a.addEventListener("contextmenu",aJ,{signal:b}),a.addEventListener("pointerdown",aS.#j,{signal:b});let c=this.#g=document.createElement("div");c.className="buttons",a.append(c);let d=this.#f.toolbarPosition;if(d){let{style:e}=a,f="ltr"===this.#f._uiManager.direction?1-d[0]:d[0];e.insetInlineEnd=`${100*f}%`,e.top=`calc(${100*d[1]}% + var(--editor-toolbar-vert-offset))`}return this.#k(),a}get div(){return this.#d}static  #j(aT){aT.stopPropagation()} #l(aU){this.#f._focusEventsAllowed=!1,aU.preventDefault(),aU.stopPropagation()} #m(aV){this.#f._focusEventsAllowed=!0,aV.preventDefault(),aV.stopPropagation()} #n(aW){let aX=this.#f._uiManager._signal;aW.addEventListener("focusin",this.#l.bind(this),{capture:!0,signal:aX}),aW.addEventListener("focusout",this.#m.bind(this),{capture:!0,signal:aX}),aW.addEventListener("contextmenu",aJ,{signal:aX})}hide(){this.#d.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#d.classList.remove("hidden"),this.#h?.shown()} #k(){let{editorType:aY,_uiManager:aZ}=this.#f,a$=document.createElement("button");a$.className="delete",a$.tabIndex=0,a$.setAttribute("data-l10n-id",aS.#i[aY]),this.#n(a$),a$.addEventListener("click",a=>{aZ.delete()},{signal:aZ._signal}),this.#g.append(a$)}get #o(){let a_=document.createElement("div");return a_.className="divider",a_}async addAltText(a){let b=await a.render();this.#n(b),this.#g.prepend(b,this.#o),this.#h=a}addColorPicker(a){this.#e=a;let b=a.renderButton();this.#n(b),this.#g.prepend(b,this.#o)}remove(){this.#d.remove(),this.#e?.destroy(),this.#e=null}}class a0{#g=null;#d=null;#p;constructor(a){this.#p=a} #q(){let a1=this.#d=document.createElement("div");a1.className="editToolbar",a1.setAttribute("role","toolbar"),a1.addEventListener("contextmenu",aJ,{signal:this.#p._signal});let a2=this.#g=document.createElement("div");return a2.className="buttons",a1.append(a2),this.#r(),a1} #s(a3,a4){let a5=0,a6=0;for(let a7 of a3){let a8=a7.y+a7.height;if(a8<a5)continue;let a9=a7.x+(a4?a7.width:0);if(a8>a5){a6=a9,a5=a8;continue}a4?a9>a6&&(a6=a9):a9<a6&&(a6=a9)}return[a4?1-a6:a6,a5]}show(a,b,c){let[d,e]=this.#s(b,c),{style:f}=this.#d||=this.#q();a.append(this.#d),f.insetInlineEnd=`${100*d}%`,f.top=`calc(${100*e}% + var(--editor-toolbar-vert-offset))`}hide(){this.#d.remove()} #r(){let ba=document.createElement("button");ba.className="highlightButton",ba.tabIndex=0,ba.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let bb=document.createElement("span");ba.append(bb),bb.className="visuallyHidden",bb.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let bc=this.#p._signal;ba.addEventListener("contextmenu",aJ,{signal:bc}),ba.addEventListener("click",()=>{this.#p.highlightSelection("floating_button")},{signal:bc}),this.#g.append(ba)}}function bd(a,b,c){for(let d of c)b.addEventListener(d,a[d].bind(a))}class be{#t=(function(){if("undefined"!=typeof crypto&&"function"==typeof crypto?.randomUUID)return crypto.randomUUID();let a=new Uint8Array(32);if("undefined"!=typeof crypto&&"function"==typeof crypto?.getRandomValues)crypto.getRandomValues(a);else for(let b=0;b<32;b++)a[b]=Math.floor(255*Math.random());return K(a)})();#u=0;#v=null;static get _isSVGFittingCanvas(){let a=new OffscreenCanvas(1,3),b=a.getContext("2d",{willReadFrequently:!0}),c=new Image;c.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>';let d=c.decode().then(()=>(b.drawImage(c,0,0,1,1,0,0,1,3),0===new Uint32Array(b.getImageData(0,0,1,1).data.buffer)[0]));return B(this,"_isSVGFittingCanvas",d)}async #w(bf,bg){this.#v||=new Map;let bh=this.#v.get(bf);if(null===bh)return null;if(bh?.bitmap)return bh.refCounter+=1,bh;try{bh||={bitmap:null,id:`image_${this.#t}_${this.#u++}`,refCounter:0,isSvg:!1};let bi;if("string"==typeof bg?(bh.url=bg,bi=await aA(bg,"blob")):bg instanceof File?bi=bh.file=bg:bg instanceof Blob&&(bi=bg),"image/svg+xml"===bi.type){let bj=be._isSVGFittingCanvas,bk=new FileReader,bl=new Image,bm=new Promise((a,b)=>{bl.onload=()=>{bh.bitmap=bl,bh.isSvg=!0,a()},bk.onload=async()=>{let a=bh.svgUrl=bk.result;bl.src=await bj?`${a}#svgView(preserveAspectRatio(none))`:a},bl.onerror=bk.onerror=b});bk.readAsDataURL(bi),await bm}else bh.bitmap=await createImageBitmap(bi);bh.refCounter=1}catch(bn){console.error(bn),bh=null}return this.#v.set(bf,bh),bh&&this.#v.set(bh.id,bh),bh}async getFromFile(a){let{lastModified:b,name:c,size:d,type:e}=a;return this.#w(`${b}_${c}_${d}_${e}`,a)}async getFromUrl(a){return this.#w(a,a)}async getFromBlob(a,b){let c=await b;return this.#w(a,c)}async getFromId(a){this.#v||=new Map;let b=this.#v.get(a);if(!b)return null;if(b.bitmap)return b.refCounter+=1,b;if(b.file)return this.getFromFile(b.file);if(b.blobPromise){let{blobPromise:c}=b;return delete b.blobPromise,this.getFromBlob(b.id,c)}return this.getFromUrl(b.url)}getFromCanvas(a,b){this.#v||=new Map;let c=this.#v.get(a);if(c?.bitmap)return c.refCounter+=1,c;let d=new OffscreenCanvas(b.width,b.height),e=d.getContext("2d");return e.drawImage(b,0,0),c={bitmap:d.transferToImageBitmap(),id:`image_${this.#t}_${this.#u++}`,refCounter:1,isSvg:!1},this.#v.set(a,c),this.#v.set(c.id,c),c}getSvgUrl(a){let b=this.#v.get(a);return b?.isSvg?b.svgUrl:null}deleteId(a){this.#v||=new Map;let b=this.#v.get(a);if(!b||(b.refCounter-=1,0!==b.refCounter))return;let{bitmap:c}=b;if(!b.url&&!b.file){let d=new OffscreenCanvas(c.width,c.height),e=d.getContext("bitmaprenderer");e.transferFromImageBitmap(c),b.blobPromise=d.convertToBlob()}c.close?.(),b.bitmap=null}isValidId(a){return a.startsWith(`image_${this.#t}_`)}}class bo{constructor(a){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:b}=N.platform;for(let[c,d,e={}]of a)for(let f of c){let g=f.startsWith("mac+");b&&g?(this.callbacks.set(f.slice(4),{callback:d,options:e}),this.allKeys.add(f.split("+").at(-1))):b||g||(this.callbacks.set(f,{callback:d,options:e}),this.allKeys.add(f.split("+").at(-1)))}} #x(bp){bp.altKey&&this.buffer.push("alt"),bp.ctrlKey&&this.buffer.push("ctrl"),bp.metaKey&&this.buffer.push("meta"),bp.shiftKey&&this.buffer.push("shift"),this.buffer.push(bp.key);let bq=this.buffer.join("+");return this.buffer.length=0,bq}exec(a,b){if(!this.allKeys.has(b.key))return;let c=this.callbacks.get(this.#x(b));if(!c)return;let{callback:d,options:{bubbles:e=!1,args:f=[],checker:g=null}}=c;(!g||g(a,b))&&(d.bind(a,...f,b)(),e||(b.stopPropagation(),b.preventDefault()))}}class br{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let a=new Map([["CanvasText",null],["Canvas",null]]);return!function(a){let b=document.createElement("span");for(let c of(b.style.visibility="hidden",document.body.append(b),a.keys())){b.style.color=c;let d=window.getComputedStyle(b).color;a.set(c,aN(d))}b.remove()}(a),B(this,"_colors",a)}convert(a){let b=aN(a);if(!window.matchMedia("(forced-colors: active)").matches)return b;for(let[c,d]of this._colors)if(d.every((a,c)=>a===b[c]))return br._colorsMapping.get(c);return b}getHexCode(a){let b=this._colors.get(a);return b?P.makeHexColor(...b):a}}class bs{#y=new AbortController;#z=null;#A=new Map;#B=new Map;#C=null;#D=null;#E=null;#F=new class{#G=[];#H=!1;#I;#J=-1;constructor(a=128){this.#I=a}add({cmd:a,undo:b,post:c,mustExec:d,type:e=NaN,overwriteIfSameType:f=!1,keepUndo:g=!1}){if(d&&a(),this.#H)return;let h={cmd:a,undo:b,post:c,type:e};if(-1===this.#J){this.#G.length>0&&(this.#G.length=0),this.#J=0,this.#G.push(h);return}if(f&&this.#G[this.#J].type===e){g&&(h.undo=this.#G[this.#J].undo),this.#G[this.#J]=h;return}let i=this.#J+1;i===this.#I?this.#G.splice(0,1):(this.#J=i,i<this.#G.length&&this.#G.splice(i)),this.#G.push(h)}undo(){if(-1===this.#J)return;this.#H=!0;let{undo:a,post:b}=this.#G[this.#J];a(),b?.(),this.#H=!1,this.#J-=1}redo(){if(this.#J<this.#G.length-1){this.#J+=1,this.#H=!0;let{cmd:a,post:b}=this.#G[this.#J];a(),b?.(),this.#H=!1}}hasSomethingToUndo(){return -1!==this.#J}hasSomethingToRedo(){return this.#J<this.#G.length-1}destroy(){this.#G=null}};#K=null;#L=0;#M=new Set;#N=null;#O=null;#P=new Set;#Q=!1;#R=!1;#S=!1;#T=null;#U=null;#V=null;#W=null;#X=!1;#Y=null;#Z=new class{#u=0;get id(){return`pdfjs_internal_editor_${this.#u++}`}};#$=!1;#_=!1;#aa=null;#ab=null;#ac=null;#ad=null;#ae=l.NONE;#af=new Set;#ag=null;#ah=null;#ai=null;#aj={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#ak=[0,0];#al=null;#am=null;#an=null;#ao=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){let a=bs.prototype,b=a=>a.#am.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&a.hasSomethingToControl(),c=(a,{target:b})=>{if(b instanceof HTMLInputElement){let{type:c}=b;return"text"!==c&&"number"!==c}return!0},d=this.TRANSLATE_SMALL,e=this.TRANSLATE_BIG;return B(this,"_keyboardManager",new bo([[["ctrl+a","mac+meta+a"],a.selectAll,{checker:c}],[["ctrl+z","mac+meta+z"],a.undo,{checker:c}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],a.redo,{checker:c}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],a.delete,{checker:c}],[["Enter","mac+Enter"],a.addNewEditorFromKeyboard,{checker:(a,{target:b})=>!(b instanceof HTMLButtonElement)&&a.#am.contains(b)&&!a.isEnterHandled}],[[" ","mac+ "],a.addNewEditorFromKeyboard,{checker:(a,{target:b})=>!(b instanceof HTMLButtonElement)&&a.#am.contains(document.activeElement)}],[["Escape","mac+Escape"],a.unselectAll],[["ArrowLeft","mac+ArrowLeft"],a.translateSelectedEditors,{args:[-d,0],checker:b}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],a.translateSelectedEditors,{args:[-e,0],checker:b}],[["ArrowRight","mac+ArrowRight"],a.translateSelectedEditors,{args:[d,0],checker:b}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],a.translateSelectedEditors,{args:[e,0],checker:b}],[["ArrowUp","mac+ArrowUp"],a.translateSelectedEditors,{args:[0,-d],checker:b}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],a.translateSelectedEditors,{args:[0,-e],checker:b}],[["ArrowDown","mac+ArrowDown"],a.translateSelectedEditors,{args:[0,d],checker:b}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],a.translateSelectedEditors,{args:[0,e],checker:b}]]))}constructor(a,b,c,d,e,f,g,h,i,j,k){let l=this._signal=this.#y.signal;this.#am=a,this.#an=b,this.#C=c,this._eventBus=d,d._on("editingaction",this.onEditingAction.bind(this),{signal:l}),d._on("pagechanging",this.onPageChanging.bind(this),{signal:l}),d._on("scalechanging",this.onScaleChanging.bind(this),{signal:l}),d._on("rotationchanging",this.onRotationChanging.bind(this),{signal:l}),d._on("setpreference",this.onSetPreference.bind(this),{signal:l}),d._on("switchannotationeditorparams",a=>this.updateParams(a.type,a.value),{signal:l}),this.#ap(),this.#aq(),this.#ar(),this.#D=e.annotationStorage,this.#T=e.filterFactory,this.#ah=f,this.#W=g||null,this.#Q=h,this.#R=i,this.#S=j,this.#ad=k||null,this.viewParameters={realScale:az.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}destroy(){for(let a of(this.#ao?.resolve(),this.#ao=null,this.#y?.abort(),this.#y=null,this._signal=null,this.#B.values()))a.destroy();this.#B.clear(),this.#A.clear(),this.#P.clear(),this.#z=null,this.#af.clear(),this.#F.destroy(),this.#C?.destroy(),this.#Y?.hide(),this.#Y=null,this.#U&&(clearTimeout(this.#U),this.#U=null),this.#al&&(clearTimeout(this.#al),this.#al=null)}combinedSignal(a){return AbortSignal.any([this._signal,a.signal])}get mlManager(){return this.#ad}get useNewAltTextFlow(){return this.#R}get useNewAltTextWhenAddingImage(){return this.#S}get hcmFilter(){return B(this,"hcmFilter",this.#ah?this.#T.addHCMFilter(this.#ah.foreground,this.#ah.background):"none")}get direction(){return B(this,"direction",getComputedStyle(this.#am).direction)}get highlightColors(){return B(this,"highlightColors",this.#W?new Map(this.#W.split(",").map(a=>a.split("=").map(a=>a.trim()))):null)}get highlightColorNames(){return B(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,a=>a.reverse())):null)}setMainHighlightColorPicker(a){this.#ac=a}editAltText(a,b=!1){this.#C?.editAltText(this,a,b)}switchToMode(a,b){this._eventBus.on("annotationeditormodechanged",b,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:a})}setPreference(a,b){this._eventBus.dispatch("setpreference",{source:this,name:a,value:b})}onSetPreference({name:a,value:b}){"enableNewAltTextWhenAddingImage"===a&&(this.#S=b)}onPageChanging({pageNumber:a}){this.#L=a-1}focusMainContainer(){this.#am.focus()}findParent(a,b){for(let c of this.#B.values()){let{x:d,y:e,width:f,height:g}=c.div.getBoundingClientRect();if(a>=d&&a<=d+f&&b>=e&&b<=e+g)return c}return null}disableUserSelect(a=!1){this.#an.classList.toggle("noUserSelect",a)}addShouldRescale(a){this.#P.add(a)}removeShouldRescale(a){this.#P.delete(a)}onScaleChanging({scale:a}){for(let b of(this.commitOrRemove(),this.viewParameters.realScale=a*az.PDF_TO_CSS_UNITS,this.#P))b.onScaleChanging()}onRotationChanging({pagesRotation:a}){this.commitOrRemove(),this.viewParameters.rotation=a} #as({anchorNode:bt}){return bt.nodeType===Node.TEXT_NODE?bt.parentElement:bt} #at(bu){let{currentLayer:bv}=this;if(bv.hasTextLayer(bu))return bv;for(let bw of this.#B.values())if(bw.hasTextLayer(bu))return bw;return null}highlightSelection(a=""){let b=document.getSelection();if(!b||b.isCollapsed)return;let{anchorNode:c,anchorOffset:d,focusNode:e,focusOffset:f}=b,g=b.toString(),h=this.#as(b),i=h.closest(".textLayer"),j=this.getSelectionBoxes(i);if(!j)return;b.empty();let k=this.#at(i),m=this.#ae===l.NONE,n=()=>{k?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:a,boxes:j,anchorNode:c,anchorOffset:d,focusNode:e,focusOffset:f,text:g}),m&&this.showAllEditors("highlight",!0,!0)};if(m){this.switchToMode(l.HIGHLIGHT,n);return}n()} #au(){let bx=document.getSelection();if(!bx||bx.isCollapsed)return;let by=this.#as(bx),bz=by.closest(".textLayer"),bA=this.getSelectionBoxes(bz);bA&&(this.#Y||=new a0(this),this.#Y.show(bz,bA,"ltr"===this.direction))}addToAnnotationStorage(a){a.isEmpty()||!this.#D||this.#D.has(a.id)||this.#D.setValue(a.id,a)} #av(){let bB=document.getSelection();if(!bB||bB.isCollapsed){this.#ag&&(this.#Y?.hide(),this.#ag=null,this.#aw({hasSelectedText:!1}));return}let{anchorNode:bC}=bB;if(bC===this.#ag)return;let bD=this.#as(bB),bE=bD.closest(".textLayer");if(!bE){this.#ag&&(this.#Y?.hide(),this.#ag=null,this.#aw({hasSelectedText:!1}));return}if(this.#Y?.hide(),this.#ag=bC,this.#aw({hasSelectedText:!0}),(this.#ae===l.HIGHLIGHT||this.#ae===l.NONE)&&(this.#ae===l.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#X=this.isShiftKeyDown,!this.isShiftKeyDown)){let bF=this.#ae===l.HIGHLIGHT?this.#at(bE):null;bF?.toggleDrawing();let bG=new AbortController,bH=this.combinedSignal(bG),bI=a=>{("pointerup"!==a.type||0===a.button)&&(bG.abort(),bF?.toggleDrawing(!0),"pointerup"===a.type&&this.#ax("main_toolbar"))};window.addEventListener("pointerup",bI,{signal:bH}),window.addEventListener("blur",bI,{signal:bH})}} #ax(bJ=""){this.#ae===l.HIGHLIGHT?this.highlightSelection(bJ):this.#Q&&this.#au()} #ap(){document.addEventListener("selectionchange",this.#av.bind(this),{signal:this._signal})} #ay(){if(this.#V)return;this.#V=new AbortController;let bK=this.combinedSignal(this.#V);window.addEventListener("focus",this.focus.bind(this),{signal:bK}),window.addEventListener("blur",this.blur.bind(this),{signal:bK})} #az(){this.#V?.abort(),this.#V=null}blur(){if(this.isShiftKeyDown=!1,this.#X&&(this.#X=!1,this.#ax("main_toolbar")),!this.hasSelection)return;let{activeElement:a}=document;for(let b of this.#af)if(b.div.contains(a)){this.#ab=[b,a],b._focusEventsAllowed=!1;break}}focus(){if(!this.#ab)return;let[a,b]=this.#ab;this.#ab=null,b.addEventListener("focusin",()=>{a._focusEventsAllowed=!0},{once:!0,signal:this._signal}),b.focus()} #ar(){if(this.#aa)return;this.#aa=new AbortController;let bL=this.combinedSignal(this.#aa);window.addEventListener("keydown",this.keydown.bind(this),{signal:bL}),window.addEventListener("keyup",this.keyup.bind(this),{signal:bL})} #aA(){this.#aa?.abort(),this.#aa=null} #aB(){if(this.#K)return;this.#K=new AbortController;let bM=this.combinedSignal(this.#K);document.addEventListener("copy",this.copy.bind(this),{signal:bM}),document.addEventListener("cut",this.cut.bind(this),{signal:bM}),document.addEventListener("paste",this.paste.bind(this),{signal:bM})} #aC(){this.#K?.abort(),this.#K=null} #aq(){let bN=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:bN}),document.addEventListener("drop",this.drop.bind(this),{signal:bN})}addEditListeners(){this.#ar(),this.#aB()}removeEditListeners(){this.#aA(),this.#aC()}dragOver(a){for(let{type:b}of a.dataTransfer.items)for(let c of this.#O)if(c.isHandlingMimeForPasting(b)){a.dataTransfer.dropEffect="copy",a.preventDefault();return}}drop(a){for(let b of a.dataTransfer.items)for(let c of this.#O)if(c.isHandlingMimeForPasting(b.type)){c.paste(b,this.currentLayer),a.preventDefault();return}}copy(a){if(a.preventDefault(),this.#z?.commitOrRemove(),!this.hasSelection)return;let b=[];for(let c of this.#af){let d=c.serialize(!0);d&&b.push(d)}0!==b.length&&a.clipboardData.setData("application/pdfjs",JSON.stringify(b))}cut(a){this.copy(a),this.delete()}async paste(a){a.preventDefault();let{clipboardData:b}=a;for(let c of b.items)for(let d of this.#O)if(d.isHandlingMimeForPasting(c.type)){d.paste(c,this.currentLayer);return}let e=b.getData("application/pdfjs");if(!e)return;try{e=JSON.parse(e)}catch(f){x(`paste: "${f.message}".`);return}if(!Array.isArray(e))return;this.unselectAll();let g=this.currentLayer;try{let h=[];for(let i of e){let j=await g.deserialize(i);if(!j)return;h.push(j)}let k=()=>{for(let a of h)this.#aD(a);this.#aE(h)},l=()=>{for(let a of h)a.remove()};this.addCommands({cmd:k,undo:l,mustExec:!0})}catch(m){x(`paste: "${m.message}".`)}}keydown(a){this.isShiftKeyDown||"Shift"!==a.key||(this.isShiftKeyDown=!0),this.#ae===l.NONE||this.isEditorHandlingKeyboard||bs._keyboardManager.exec(this,a)}keyup(a){this.isShiftKeyDown&&"Shift"===a.key&&(this.isShiftKeyDown=!1,this.#X&&(this.#X=!1,this.#ax("main_toolbar")))}onEditingAction({name:a}){switch(a){case"undo":case"redo":case"delete":case"selectAll":this[a]();break;case"highlightSelection":this.highlightSelection("context_menu")}} #aw(bO){let bP=Object.entries(bO).some(([a,b])=>this.#aj[a]!==b);bP&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#aj,bO)}),this.#ae===l.HIGHLIGHT&& !1===bO.hasSelectedEditor&&this.#aF([[m.HIGHLIGHT_FREE,!0]]))} #aF(bQ){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:bQ})}setEditingState(a){a?(this.#ay(),this.#aB(),this.#aw({isEditing:this.#ae!==l.NONE,isEmpty:this.#aG(),hasSomethingToUndo:this.#F.hasSomethingToUndo(),hasSomethingToRedo:this.#F.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#az(),this.#aC(),this.#aw({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(a){if(!this.#O)for(let b of(this.#O=a,this.#O))this.#aF(b.defaultPropertiesToUpdate)}getId(){return this.#Z.id}get currentLayer(){return this.#B.get(this.#L)}getLayer(a){return this.#B.get(a)}get currentPageIndex(){return this.#L}addLayer(a){this.#B.set(a.pageIndex,a),this.#$?a.enable():a.disable()}removeLayer(a){this.#B.delete(a.pageIndex)}async updateMode(a,b=null,c=!1){if(this.#ae!==a&&(!this.#ao||(await this.#ao.promise,this.#ao))){if(this.#ao=Promise.withResolvers(),this.#ae=a,a===l.NONE){this.setEditingState(!1),this.#aH(),this.#ao.resolve();return}for(let d of(this.setEditingState(!0),await this.#aI(),this.unselectAll(),this.#B.values()))d.updateMode(a);if(!b){c&&this.addNewEditorFromKeyboard(),this.#ao.resolve();return}for(let e of this.#A.values())e.annotationElementId===b?(this.setSelected(e),e.enterInEditMode()):e.unselect();this.#ao.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(a){a!==this.#ae&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:a})}updateParams(a,b){if(this.#O){switch(a){case m.CREATE:this.currentLayer.addNewEditor();return;case m.HIGHLIGHT_DEFAULT_COLOR:this.#ac?.updateColor(b);break;case m.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#ai||=new Map).set(a,b),this.showAllEditors("highlight",b)}for(let c of this.#af)c.updateParams(a,b);for(let d of this.#O)d.updateDefaultParams(a,b)}}showAllEditors(a,b,c=!1){for(let d of this.#A.values())d.editorType===a&&d.show(b);let e=this.#ai?.get(m.HIGHLIGHT_SHOW_ALL)?? !0;e!==b&&this.#aF([[m.HIGHLIGHT_SHOW_ALL,b]])}enableWaiting(a=!1){if(this.#_!==a)for(let b of(this.#_=a,this.#B.values()))a?b.disableClick():b.enableClick(),b.div.classList.toggle("waiting",a)}async #aI(){if(!this.#$){this.#$=!0;let bR=[];for(let bS of this.#B.values())bR.push(bS.enable());for(let bT of(await Promise.all(bR),this.#A.values()))bT.enable()}} #aH(){if(this.unselectAll(),this.#$){for(let bU of(this.#$=!1,this.#B.values()))bU.disable();for(let bV of this.#A.values())bV.disable()}}getEditors(a){let b=[];for(let c of this.#A.values())c.pageIndex===a&&b.push(c);return b}getEditor(a){return this.#A.get(a)}addEditor(a){this.#A.set(a.id,a)}removeEditor(a){a.div.contains(document.activeElement)&&(this.#U&&clearTimeout(this.#U),this.#U=setTimeout(()=>{this.focusMainContainer(),this.#U=null},0)),this.#A.delete(a.id),this.unselect(a),a.annotationElementId&&this.#M.has(a.annotationElementId)||this.#D?.remove(a.id)}addDeletedAnnotationElement(a){this.#M.add(a.annotationElementId),this.addChangedExistingAnnotation(a),a.deleted=!0}isDeletedAnnotationElement(a){return this.#M.has(a)}removeDeletedAnnotationElement(a){this.#M.delete(a.annotationElementId),this.removeChangedExistingAnnotation(a),a.deleted=!1} #aD(bW){let bX=this.#B.get(bW.pageIndex);bX?bX.addOrRebuild(bW):(this.addEditor(bW),this.addToAnnotationStorage(bW))}setActiveEditor(a){this.#z!==a&&(this.#z=a,a&&this.#aF(a.propertiesToUpdate))}get #aJ(){let bY=null;for(bY of this.#af);return bY}updateUI(a){this.#aJ===a&&this.#aF(a.propertiesToUpdate)}toggleSelected(a){if(this.#af.has(a)){this.#af.delete(a),a.unselect(),this.#aw({hasSelectedEditor:this.hasSelection});return}this.#af.add(a),a.select(),this.#aF(a.propertiesToUpdate),this.#aw({hasSelectedEditor:!0})}setSelected(a){for(let b of this.#af)b!==a&&b.unselect();this.#af.clear(),this.#af.add(a),a.select(),this.#aF(a.propertiesToUpdate),this.#aw({hasSelectedEditor:!0})}isSelected(a){return this.#af.has(a)}get firstSelectedEditor(){return this.#af.values().next().value}unselect(a){a.unselect(),this.#af.delete(a),this.#aw({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#af.size}get isEnterHandled(){return 1===this.#af.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#F.undo(),this.#aw({hasSomethingToUndo:this.#F.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#aG()})}redo(){this.#F.redo(),this.#aw({hasSomethingToUndo:!0,hasSomethingToRedo:this.#F.hasSomethingToRedo(),isEmpty:this.#aG()})}addCommands(a){this.#F.add(a),this.#aw({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#aG()})} #aG(){if(0===this.#A.size)return!0;if(1===this.#A.size)for(let bZ of this.#A.values())return bZ.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;let a=[...this.#af],b=()=>{for(let b of a)b.remove()},c=()=>{for(let b of a)this.#aD(b)};this.addCommands({cmd:b,undo:c,mustExec:!0})}commitOrRemove(){this.#z?.commitOrRemove()}hasSomethingToControl(){return this.#z||this.hasSelection} #aE(b$){for(let b_ of this.#af)b_.unselect();for(let b0 of(this.#af.clear(),b$))!b0.isEmpty()&&(this.#af.add(b0),b0.select());this.#aw({hasSelectedEditor:this.hasSelection})}selectAll(){for(let a of this.#af)a.commit();this.#aE(this.#A.values())}unselectAll(){if((!this.#z||(this.#z.commitOrRemove(),this.#ae===l.NONE))&&this.hasSelection){for(let a of this.#af)a.unselect();this.#af.clear(),this.#aw({hasSelectedEditor:!1})}}translateSelectedEditors(a,b,c=!1){if(c||this.commitOrRemove(),!this.hasSelection)return;this.#ak[0]+=a,this.#ak[1]+=b;let[d,e]=this.#ak,f=[...this.#af];for(let g of(this.#al&&clearTimeout(this.#al),this.#al=setTimeout(()=>{this.#al=null,this.#ak[0]=this.#ak[1]=0,this.addCommands({cmd:()=>{for(let a of f)this.#A.has(a.id)&&a.translateInPage(d,e)},undo:()=>{for(let a of f)this.#A.has(a.id)&&a.translateInPage(-d,-e)},mustExec:!1})},1e3),f))g.translateInPage(a,b)}setUpDragSession(){if(this.hasSelection)for(let a of(this.disableUserSelect(!0),this.#N=new Map,this.#af))this.#N.set(a,{savedX:a.x,savedY:a.y,savedPageIndex:a.pageIndex,newX:0,newY:0,newPageIndex:-1})}endDragSession(){if(!this.#N)return!1;this.disableUserSelect(!1);let a=this.#N;this.#N=null;let b=!1;for(let[{x:c,y:d,pageIndex:e},f]of a)f.newX=c,f.newY=d,f.newPageIndex=e,b||=c!==f.savedX||d!==f.savedY||e!==f.savedPageIndex;if(!b)return!1;let g=(a,b,c,d)=>{if(this.#A.has(a.id)){let e=this.#B.get(d);e?a._setParentAndPosition(e,b,c):(a.pageIndex=d,a.x=b,a.y=c)}};return this.addCommands({cmd(){for(let[b,{newX:c,newY:d,newPageIndex:e}]of a)g(b,c,d,e)},undo(){for(let[b,{savedX:c,savedY:d,savedPageIndex:e}]of a)g(b,c,d,e)},mustExec:!0}),!0}dragSelectedEditors(a,b){if(this.#N)for(let c of this.#N.keys())c.drag(a,b)}rebuild(a){if(null===a.parent){let b=this.getLayer(a.pageIndex);b?(b.changeParent(a),b.addOrRebuild(a)):(this.addEditor(a),this.addToAnnotationStorage(a),a.rebuild())}else a.parent.addOrRebuild(a)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#af.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(a){return this.#z===a}getActive(){return this.#z}getMode(){return this.#ae}get imageManager(){return B(this,"imageManager",new be)}getSelectionBoxes(a){if(!a)return null;let b=document.getSelection();for(let c=0,d=b.rangeCount;c<d;c++)if(!a.contains(b.getRangeAt(c).commonAncestorContainer))return null;let{x:e,y:f,width:g,height:h}=a.getBoundingClientRect(),i;switch(a.getAttribute("data-main-rotation")){case"90":i=(a,b,c,d)=>({x:(b-f)/h,y:1-(a+c-e)/g,width:d/h,height:c/g});break;case"180":i=(a,b,c,d)=>({x:1-(a+c-e)/g,y:1-(b+d-f)/h,width:c/g,height:d/h});break;case"270":i=(a,b,c,d)=>({x:1-(b+d-f)/h,y:(a-e)/g,width:d/h,height:c/g});break;default:i=(a,b,c,d)=>({x:(a-e)/g,y:(b-f)/h,width:c/g,height:d/h})}let j=[];for(let k=0,l=b.rangeCount;k<l;k++){let m=b.getRangeAt(k);if(!m.collapsed)for(let{x:n,y:o,width:p,height:q}of m.getClientRects())0!==p&&0!==q&&j.push(i(n,o,p,q))}return 0===j.length?null:j}addChangedExistingAnnotation({annotationElementId:a,id:b}){(this.#E||=new Map).set(a,b)}removeChangedExistingAnnotation({annotationElementId:a}){this.#E?.delete(a)}renderAnnotationElement(a){let b=this.#E?.get(a.data.id);if(!b)return;let c=this.#D.getRawValue(b);c&&(this.#ae!==l.NONE||c.hasBeenModified)&&c.renderAnnotationElement(a)}}class b1{#h=null;#aK=!1;#aL=null;#aM=null;#aN=null;#aO=null;#aP=!1;#aQ=null;#f=null;#aR=null;#aS=null;#aT=!1;static #aU=null;static _l10n=null;constructor(a){this.#f=a,this.#aT=a._uiManager.useNewAltTextFlow,b1.#aU||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(a){b1._l10n??=a}async render(){let a=this.#aL=document.createElement("button");a.className="altText",a.tabIndex="0";let b=this.#aM=document.createElement("span");a.append(b),this.#aT?(a.classList.add("new"),a.setAttribute("data-l10n-id",b1.#aU.missing),b.setAttribute("data-l10n-id",b1.#aU["missing-label"])):(a.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),b.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let c=this.#f._uiManager._signal;a.addEventListener("contextmenu",aJ,{signal:c}),a.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:c});let d=a=>{a.preventDefault(),this.#f._uiManager.editAltText(this.#f),this.#aT&&this.#f._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#aV}})};return a.addEventListener("click",d,{capture:!0,signal:c}),a.addEventListener("keydown",b=>{b.target===a&&"Enter"===b.key&&(this.#aP=!0,d(b))},{signal:c}),await this.#aW(),a}get #aV(){return this.#h&&"added"||null===this.#h&&this.guessedText&&"review"||"missing"}finish(){this.#aL&&(this.#aL.focus({focusVisible:this.#aP}),this.#aP=!1)}isEmpty(){return this.#aT?null===this.#h:!this.#h&&!this.#aK}hasData(){return this.#aT?null!==this.#h||!!this.#aR:this.isEmpty()}get guessedText(){return this.#aR}async setGuessedText(a){null===this.#h&&(this.#aR=a,this.#aS=await b1._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:a}),this.#aW())}toggleAltTextBadge(a=!1){if(!this.#aT||this.#h){this.#aQ?.remove(),this.#aQ=null;return}if(!this.#aQ){let b=this.#aQ=document.createElement("div");b.className="noAltTextBadge",this.#f.div.append(b)}this.#aQ.classList.toggle("hidden",!a)}serialize(a){let b=this.#h;return a||this.#aR!==b||(b=this.#aS),{altText:b,decorative:this.#aK,guessedText:this.#aR,textWithDisclaimer:this.#aS}}get data(){return{altText:this.#h,decorative:this.#aK}}set data({altText:a,decorative:b,guessedText:c,textWithDisclaimer:d,cancel:e=!1}){c&&(this.#aR=c,this.#aS=d),(this.#h!==a||this.#aK!==b)&&(e||(this.#h=a,this.#aK=b),this.#aW())}toggle(a=!1){this.#aL&&(!a&&this.#aO&&(clearTimeout(this.#aO),this.#aO=null),this.#aL.disabled=!a)}shown(){this.#f._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#aV}})}destroy(){this.#aL?.remove(),this.#aL=null,this.#aM=null,this.#aN=null,this.#aQ?.remove(),this.#aQ=null}async #aW(){let b2=this.#aL;if(!b2)return;if(this.#aT){if(b2.classList.toggle("done",!!this.#h),b2.setAttribute("data-l10n-id",b1.#aU[this.#aV]),this.#aM?.setAttribute("data-l10n-id",b1.#aU[`${this.#aV}-label`]),!this.#h){this.#aN?.remove();return}}else{if(!this.#h&&!this.#aK){b2.classList.remove("done"),this.#aN?.remove();return}b2.classList.add("done"),b2.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let b3=this.#aN;if(!b3){this.#aN=b3=document.createElement("span"),b3.className="tooltip",b3.setAttribute("role","tooltip"),b3.id=`alt-text-tooltip-${this.#f.id}`;let b4=100,b5=this.#f._uiManager._signal;b5.addEventListener("abort",()=>{clearTimeout(this.#aO),this.#aO=null},{once:!0}),b2.addEventListener("mouseenter",()=>{this.#aO=setTimeout(()=>{this.#aO=null,this.#aN.classList.add("show"),this.#f._reportTelemetry({action:"alt_text_tooltip"})},b4)},{signal:b5}),b2.addEventListener("mouseleave",()=>{this.#aO&&(clearTimeout(this.#aO),this.#aO=null),this.#aN?.classList.remove("show")},{signal:b5})}this.#aK?b3.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(b3.removeAttribute("data-l10n-id"),b3.textContent=this.#h),b3.parentNode||b2.append(b3);let b6=this.#f.getImageForAltText();b6?.setAttribute("aria-describedby",b3.id)}}class b7{#aX=null;#aY=null;#h=null;#aZ=!1;#a$=!1;#a_=null;#a0=null;#a1=null;#a2="";#a3=!1;#a4=null;#a5=!1;#a6=!1;#a7=!1;#a8=null;#a9=0;#ba=0;#bb=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#bc=!1;#bd=b7._zIndex++;static _borderLineWidth=-1;static _colorManager=new br;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){let a=b7.prototype._resizeWithKeyboard,b=bs.TRANSLATE_SMALL,c=bs.TRANSLATE_BIG;return B(this,"_resizerKeyboardManager",new bo([[["ArrowLeft","mac+ArrowLeft"],a,{args:[-b,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],a,{args:[-c,0]}],[["ArrowRight","mac+ArrowRight"],a,{args:[b,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],a,{args:[c,0]}],[["ArrowUp","mac+ArrowUp"],a,{args:[0,-b]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],a,{args:[0,-c]}],[["ArrowDown","mac+ArrowDown"],a,{args:[0,b]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],a,{args:[0,c]}],[["Escape","mac+Escape"],b7.prototype._stopResizingWithKeyboard]]))}constructor(a){this.parent=a.parent,this.id=a.id,this.width=this.height=null,this.pageIndex=a.parent.pageIndex,this.name=a.name,this.div=null,this._uiManager=a.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=a.isCentered,this._structTreeParentId=null;let{rotation:b,rawDims:{pageWidth:c,pageHeight:d,pageX:e,pageY:f}}=this.parent.viewport;this.rotation=b,this.pageRotation=(360+b-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[c,d],this.pageTranslation=[e,f];let[g,h]=this.parentDimensions;this.x=a.x/g,this.y=a.y/h,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return B(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(a){let b=new dy({id:a.parent.getNextId(),parent:a.parent,uiManager:a._uiManager});b.annotationElementId=a.annotationElementId,b.deleted=!0,b._uiManager.addToAnnotationStorage(b)}static initialize(a,b){if(b7._l10n??=a,b7._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),-1!==b7._borderLineWidth)return;let c=getComputedStyle(document.documentElement);b7._borderLineWidth=parseFloat(c.getPropertyValue("--outline-width"))||0}static updateDefaultParams(a,b){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(a){return!1}static paste(a,b){y("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#bc}set _isDraggable(a){this.#bc=a,this.div?.classList.toggle("draggable",a)}get isEnterHandled(){return!0}center(){let[a,b]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*b/(2*a),this.y+=this.width*a/(2*b);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*b/(2*a),this.y-=this.width*a/(2*b);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(a){this._uiManager.addCommands(a)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#bd}setParent(a){null!==a?(this.pageIndex=a.pageIndex,this.pageDimensions=a.pageDimensions):this.#be(),this.parent=a}focusin(a){this._focusEventsAllowed&&(this.#a3?this.#a3=!1:this.parent.setSelected(this))}focusout(a){if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;let b=a.relatedTarget;!b?.closest(`#${this.id}`)&&(a.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(a,b,c,d){let[e,f]=this.parentDimensions;[c,d]=this.screenToPageTranslation(c,d),this.x=(a+c)/e,this.y=(b+d)/f,this.fixAndSetPosition()} #bf([b8,b9],ca,cb){[ca,cb]=this.screenToPageTranslation(ca,cb),this.x+=ca/b8,this.y+=cb/b9,this.fixAndSetPosition()}translate(a,b){this.#bf(this.parentDimensions,a,b)}translateInPage(a,b){this.#a4||=[this.x,this.y],this.#bf(this.pageDimensions,a,b),this.div.scrollIntoView({block:"nearest"})}drag(a,b){this.#a4||=[this.x,this.y];let[c,d]=this.parentDimensions;if(this.x+=a/c,this.y+=b/d,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:e,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,e,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:g,y:h}=this,[i,j]=this.getBaseTranslation();g+=i,h+=j,this.div.style.left=`${(100*g).toFixed(2)}%`,this.div.style.top=`${(100*h).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!this.#a4&&(this.#a4[0]!==this.x||this.#a4[1]!==this.y)}getBaseTranslation(){let[a,b]=this.parentDimensions,{_borderLineWidth:c}=b7,d=c/a,e=c/b;switch(this.rotation){case 90:return[-d,e];case 180:return[d,e];case 270:return[d,-e];default:return[-d,-e]}}get _mustFixPosition(){return!0}fixAndSetPosition(a=this.rotation){let[b,c]=this.pageDimensions,{x:d,y:e,width:f,height:g}=this;if(f*=b,g*=c,d*=b,e*=c,this._mustFixPosition)switch(a){case 0:d=Math.max(0,Math.min(b-f,d)),e=Math.max(0,Math.min(c-g,e));break;case 90:d=Math.max(0,Math.min(b-g,d)),e=Math.min(c,Math.max(f,e));break;case 180:d=Math.min(b,Math.max(f,d)),e=Math.min(c,Math.max(g,e));break;case 270:d=Math.min(b,Math.max(g,d)),e=Math.max(0,Math.min(c-f,e))}this.x=d/=b,this.y=e/=c;let[h,i]=this.getBaseTranslation();d+=h,e+=i;let{style:j}=this.div;j.left=`${(100*d).toFixed(2)}%`,j.top=`${(100*e).toFixed(2)}%`,this.moveInDOM()}static  #bg(cc,cd,ce){switch(ce){case 90:return[cd,-cc];case 180:return[-cc,-cd];case 270:return[-cd,cc];default:return[cc,cd]}}screenToPageTranslation(a,b){return b7.#bg(a,b,this.parentRotation)}pageTranslationToScreen(a,b){return b7.#bg(a,b,360-this.parentRotation)} #bh(cf){switch(cf){case 90:{let[cg,ch]=this.pageDimensions;return[0,-cg/ch,ch/cg,0]}case 180:return[-1,0,0,-1];case 270:{let[ci,cj]=this.pageDimensions;return[0,ci/cj,-cj/ci,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:a,pageDimensions:[b,c]}=this;return[b*a,c*a]}setDims(a,b){let[c,d]=this.parentDimensions;this.div.style.width=`${(100*a/c).toFixed(2)}%`,this.#a$||(this.div.style.height=`${(100*b/d).toFixed(2)}%`)}fixDims(){let{style:a}=this.div,{height:b,width:c}=a,d=c.endsWith("%"),e=!this.#a$&&b.endsWith("%");if(d&&e)return;let[f,g]=this.parentDimensions;d||(a.width=`${(100*parseFloat(c)/f).toFixed(2)}%`),this.#a$||e||(a.height=`${(100*parseFloat(b)/g).toFixed(2)}%`)}getInitialTranslation(){return[0,0]} #bi(){if(this.#a_)return;this.#a_=document.createElement("div"),this.#a_.classList.add("resizers");let ck=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],cl=this._uiManager._signal;for(let cm of ck){let cn=document.createElement("div");this.#a_.append(cn),cn.classList.add("resizer",cm),cn.setAttribute("data-resizer-name",cm),cn.addEventListener("pointerdown",this.#bj.bind(this,cm),{signal:cl}),cn.addEventListener("contextmenu",aJ,{signal:cl}),cn.tabIndex=-1}this.div.prepend(this.#a_)} #bj(co,cp){cp.preventDefault();let{isMac:cq}=N.platform;if(0!==cp.button||cp.ctrlKey&&cq)return;this.#h?.toggle(!1);let cr=this._isDraggable;this._isDraggable=!1;let cs=new AbortController,ct=this._uiManager.combinedSignal(cs);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#bk.bind(this,co),{passive:!0,capture:!0,signal:ct}),window.addEventListener("contextmenu",aJ,{signal:ct});let cu=this.x,cv=this.y,cw=this.width,cx=this.height,cy=this.parent.div.style.cursor,cz=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(cp.target).cursor;let cA=()=>{cs.abort(),this.parent.togglePointerEvents(!0),this.#h?.toggle(!0),this._isDraggable=cr,this.parent.div.style.cursor=cy,this.div.style.cursor=cz,this.#bl(cu,cv,cw,cx)};window.addEventListener("pointerup",cA,{signal:ct}),window.addEventListener("blur",cA,{signal:ct})} #bl(cB,cC,cD,cE){let cF=this.x,cG=this.y,cH=this.width,cI=this.height;(cF!==cB||cG!==cC||cH!==cD||cI!==cE)&&this.addCommands({cmd:()=>{this.width=cH,this.height=cI,this.x=cF,this.y=cG;let[a,b]=this.parentDimensions;this.setDims(a*cH,b*cI),this.fixAndSetPosition()},undo:()=>{this.width=cD,this.height=cE,this.x=cB,this.y=cC;let[a,b]=this.parentDimensions;this.setDims(a*cD,b*cE),this.fixAndSetPosition()},mustExec:!0})} #bk(cJ,cK){var cL,cM;let[cN,cO]=this.parentDimensions,cP=this.x,cQ=this.y,cR=this.width,cS=this.height,cT=b7.MIN_SIZE/cN,cU=b7.MIN_SIZE/cO,cV=a=>Math.round(1e4*a)/1e4,cW=this.#bh(this.rotation),cX=(a,b)=>[cW[0]*a+cW[2]*b,cW[1]*a+cW[3]*b],cY=this.#bh(360-this.rotation),cZ,c$,c_=!1,c0=!1;switch(cJ){case"topLeft":c_=!0,cZ=(a,b)=>[0,0],c$=(a,b)=>[a,b];break;case"topMiddle":cZ=(a,b)=>[a/2,0],c$=(a,b)=>[a/2,b];break;case"topRight":c_=!0,cZ=(a,b)=>[a,0],c$=(a,b)=>[0,b];break;case"middleRight":c0=!0,cZ=(a,b)=>[a,b/2],c$=(a,b)=>[0,b/2];break;case"bottomRight":c_=!0,cZ=(a,b)=>[a,b],c$=(a,b)=>[0,0];break;case"bottomMiddle":cZ=(a,b)=>[a/2,b],c$=(a,b)=>[a/2,0];break;case"bottomLeft":c_=!0,cZ=(a,b)=>[0,b],c$=(a,b)=>[a,0];break;case"middleLeft":c0=!0,cZ=(a,b)=>[0,b/2],c$=(a,b)=>[a,b/2]}let c1=cZ(cR,cS),c2=c$(cR,cS),c3=cX(...c2),c4=cV(cP+c3[0]),c5=cV(cQ+c3[1]),c6=1,c7=1,[c8,c9]=this.screenToPageTranslation(cK.movementX,cK.movementY);if([c8,c9]=(cL=c8/cN,cM=c9/cO,[cY[0]*cL+cY[2]*cM,cY[1]*cL+cY[3]*cM]),c_){let da=Math.hypot(cR,cS);c6=c7=Math.max(Math.min(Math.hypot(c2[0]-c1[0]-c8,c2[1]-c1[1]-c9)/da,1/cR,1/cS),cT/cR,cU/cS)}else c0?c6=Math.max(cT,Math.min(1,Math.abs(c2[0]-c1[0]-c8)))/cR:c7=Math.max(cU,Math.min(1,Math.abs(c2[1]-c1[1]-c9)))/cS;let db=cV(cR*c6),dc=cV(cS*c7);c3=cX(...c$(db,dc));let dd=c4-c3[0],de=c5-c3[1];this.width=db,this.height=dc,this.x=dd,this.y=de,this.setDims(cN*db,cO*dc),this.fixAndSetPosition()}altTextFinish(){this.#h?.finish()}async addEditToolbar(){return this._editToolbar||this.#a6||(this._editToolbar=new aS(this),this.div.append(this._editToolbar.render()),this.#h&&await this._editToolbar.addAltText(this.#h)),this._editToolbar}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#h?.destroy())}addContainer(a){let b=this._editToolbar?.div;b?b.before(a):this.div.append(a)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){!this.#h&&(b1.initialize(b7._l10n),this.#h=new b1(this),this.#aX&&(this.#h.data=this.#aX,this.#aX=null),await this.addEditToolbar())}get altTextData(){return this.#h?.data}set altTextData(a){this.#h&&(this.#h.data=a)}get guessedAltText(){return this.#h?.guessedText}async setGuessedAltText(a){await this.#h?.setGuessedText(a)}serializeAltText(a){return this.#h?.serialize(a)}hasAltText(){return!!this.#h&&!this.#h.isEmpty()}hasAltTextData(){return this.#h?.hasData()?? !1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#aZ?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.#bm();let[a,b]=this.parentDimensions;this.parentRotation%180!=0&&(this.div.style.maxWidth=`${(100*b/a).toFixed(2)}%`,this.div.style.maxHeight=`${(100*a/b).toFixed(2)}%`);let[c,d]=this.getInitialTranslation();return this.translate(c,d),bd(this,this.div,["pointerdown"]),this.div}pointerdown(a){let{isMac:b}=N.platform;if(0!==a.button||a.ctrlKey&&b){a.preventDefault();return}if(this.#a3=!0,this._isDraggable){this.#bn(a);return}this.#bo(a)}get isSelected(){return this._uiManager.isSelected(this)} #bo(df){let{isMac:dg}=N.platform;df.ctrlKey&&!dg||df.shiftKey||df.metaKey&&dg?this.parent.toggleSelected(this):this.parent.setSelected(this)} #bn(dh){let{isSelected:di}=this;this._uiManager.setUpDragSession();let dj=new AbortController,dk=this._uiManager.combinedSignal(dj);if(di){this.div.classList.add("moving"),this.#a9=dh.clientX,this.#ba=dh.clientY;let dl=a=>{let{clientX:b,clientY:c}=a,[d,e]=this.screenToPageTranslation(b-this.#a9,c-this.#ba);this.#a9=b,this.#ba=c,this._uiManager.dragSelectedEditors(d,e)};window.addEventListener("pointermove",dl,{passive:!0,capture:!0,signal:dk})}let dm=()=>{dj.abort(),di&&this.div.classList.remove("moving"),this.#a3=!1,this._uiManager.endDragSession()||this.#bo(dh)};window.addEventListener("pointerup",dm,{signal:dk}),window.addEventListener("blur",dm,{signal:dk})}moveInDOM(){this.#a8&&clearTimeout(this.#a8),this.#a8=setTimeout(()=>{this.#a8=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(a,b,c){a.changeParent(this),this.x=b,this.y=c,this.fixAndSetPosition()}getRect(a,b,c=this.rotation){let d=this.parentScale,[e,f]=this.pageDimensions,[g,h]=this.pageTranslation,i=a/d,j=b/d,k=this.x*e,l=this.y*f,m=this.width*e,n=this.height*f;switch(c){case 0:return[k+i+g,f-l-j-n+h,k+i+m+g,f-l-j+h];case 90:return[k+j+g,f-l+i+h,k+j+n+g,f-l+i+m+h];case 180:return[k-i-m+g,f-l+j+h,k-i+g,f-l+j+n+h];case 270:return[k-j-n+g,f-l-i-m+h,k-j+g,f-l-i+h];default:throw Error("Invalid rotation")}}getRectInCurrentCoords(a,b){let[c,d,e,f]=a,g=e-c,h=f-d;switch(this.rotation){case 0:return[c,b-f,g,h];case 90:return[c,b-d,h,g];case 180:return[e,b-d,g,h];case 270:return[e,b-f,h,g];default:throw Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#a6=!0}disableEditMode(){this.#a6=!1}isInEditMode(){return this.#a6}shouldGetKeyboardEvents(){return this.#a7}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM} #bm(){if(this.#a1||!this.div)return;this.#a1=new AbortController;let dn=this._uiManager.combinedSignal(this.#a1);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:dn}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:dn})}rebuild(){this.#bm()}rotate(a){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(a=!1,b=null){y("An editor must be serializable")}static async deserialize(a,b,c){let d=new this.prototype.constructor({parent:b,id:b.getNextId(),uiManager:c});d.rotation=a.rotation,d.#aX=a.accessibilityData;let[e,f]=d.pageDimensions,[g,h,i,j]=d.getRectInCurrentCoords(a.rect,f);return d.x=g/e,d.y=h/f,d.width=i/e,d.height=j/f,d}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}remove(){if(this.#a1?.abort(),this.#a1=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#a8&&(clearTimeout(this.#a8),this.#a8=null),this.#be(),this.removeEditToolbar(),this.#bb){for(let a of this.#bb.values())clearTimeout(a);this.#bb=null}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#bi(),this.#a_.classList.remove("hidden"),bd(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(a){if(!this.isResizable||a.target!==this.div||"Enter"!==a.key)return;this._uiManager.setSelected(this),this.#a0={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let b=this.#a_.children;if(!this.#aY){this.#aY=Array.from(b);let c=this.#bp.bind(this),d=this.#bq.bind(this),e=this._uiManager._signal;for(let f of this.#aY){let g=f.getAttribute("data-resizer-name");f.setAttribute("role","spinbutton"),f.addEventListener("keydown",c,{signal:e}),f.addEventListener("blur",d,{signal:e}),f.addEventListener("focus",this.#br.bind(this,g),{signal:e}),f.setAttribute("data-l10n-id",b7._l10nResizer[g])}}let h=this.#aY[0],i=0;for(let j of b){if(j===h)break;i++}let k=(360-this.rotation+this.parentRotation)%360/90*(this.#aY.length/4);if(k!==i){if(k<i)for(let l=0;l<i-k;l++)this.#a_.append(this.#a_.firstChild);else if(k>i)for(let m=0;m<k-i;m++)this.#a_.firstChild.before(this.#a_.lastChild);let n=0;for(let o of b){let p=this.#aY[n++],q=p.getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",b7._l10nResizer[q])}}this.#bs(0),this.#a7=!0,this.#a_.firstChild.focus({focusVisible:!0}),a.preventDefault(),a.stopImmediatePropagation()} #bp(dp){b7._resizerKeyboardManager.exec(this,dp)} #bq(dq){this.#a7&&dq.relatedTarget?.parentNode!==this.#a_&&this.#be()} #br(dr){this.#a2=this.#a7?dr:""} #bs(ds){if(this.#aY)for(let dt of this.#aY)dt.tabIndex=ds}_resizeWithKeyboard(a,b){this.#a7&&this.#bk(this.#a2,{movementX:a,movementY:b})} #be(){if(this.#a7=!1,this.#bs(-1),this.#a0){let{savedX:du,savedY:dv,savedWidth:dw,savedHeight:dx}=this.#a0;this.#bl(du,dv,dw,dx),this.#a0=null}}_stopResizingWithKeyboard(){this.#be(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#h?.toggleAltTextBadge(!1)}unselect(){this.#a_?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#h?.toggleAltTextBadge(!0)}updateParams(a,b){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#a5}set isEditing(a){this.#a5=a,this.parent&&(a?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(a,b){this.#a$=!0;let{style:c}=this.div;c.aspectRatio=a/b,c.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(a,b=!1){if(b){this.#bb||=new Map;let{action:c}=a,d=this.#bb.get(c);d&&clearTimeout(d),d=setTimeout(()=>{this._reportTelemetry(a),this.#bb.delete(c),0===this.#bb.size&&(this.#bb=null)},b7._telemetryTimeout),this.#bb.set(c,d);return}a.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:a}})}show(a=this._isVisible){this.div.classList.toggle("hidden",!a),this._isVisible=a}enable(){this.div&&(this.div.tabIndex=0),this.#aZ=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#aZ=!0}renderAnnotationElement(a){let b=a.container.querySelector(".annotationContent");if(b){if("CANVAS"===b.nodeName){let c=b;(b=document.createElement("div")).classList.add("annotationContent",this.editorType),c.before(b)}}else(b=document.createElement("div")).classList.add("annotationContent",this.editorType),a.container.prepend(b);return b}resetAnnotationElement(a){let{firstChild:b}=a.container;b?.nodeName==="DIV"&&b.classList.contains("annotationContent")&&b.remove()}}class dy extends b7{constructor(a){super(a),this.annotationElementId=a.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}class dz{constructor(a){this.h1=a?4294967295&a:3285377520,this.h2=a?4294967295&a:3285377520}update(a){let b,c;if("string"==typeof a){b=new Uint8Array(2*a.length),c=0;for(let d=0,e=a.length;d<e;d++){let f=a.charCodeAt(d);f<=255?b[c++]=f:(b[c++]=f>>>8,b[c++]=255&f)}}else if(ArrayBuffer.isView(a))c=(b=a.slice()).byteLength;else throw Error("Invalid data format, must be a string or TypedArray.");let g=c>>2,h=c-4*g,i=new Uint32Array(b.buffer,0,g),j=0,k=0,l=this.h1,m=this.h2;for(let n=0;n<g;n++)1&n?(l^=j=461845907*(j=(j=3432918353*(j=i[n])&4294901760|11601*j&65535)<<15|j>>>17)&4294901760|13715*j&65535,l=5*(l=l<<13|l>>>19)+3864292196):(m^=k=461845907*(k=(k=3432918353*(k=i[n])&4294901760|11601*k&65535)<<15|k>>>17)&4294901760|13715*k&65535,m=5*(m=m<<13|m>>>19)+3864292196);switch(j=0,h){case 3:j^=b[4*g+2]<<16;case 2:j^=b[4*g+1]<<8;case 1:j^=b[4*g],j=461845907*(j=(j=3432918353*j&4294901760|11601*j&65535)<<15|j>>>17)&4294901760|13715*j&65535,1&g?l^=j:m^=j}this.h1=l,this.h2=m}hexdigest(){let a=this.h1,b=this.h2;return a^=b>>>1,b=4283543511*b&4294901760|((b<<16|(a=3981806797*a&4294901760|36045*a&65535)>>>16)*2950163797&4294901760)>>>16,a^=b>>>1,b=3301882366*b&4294901760|((b<<16|(a=444984403*a&4294901760|60499*a&65535)>>>16)*3120437893&4294901760)>>>16,((a^=b>>>1)>>>0).toString(16).padStart(8,"0")+(b>>>0).toString(16).padStart(8,"0")}}let dA=Object.freeze({map:null,hash:"",transfer:void 0});class dB{#bt=!1;#bu=null;#bv=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(a,b){let c=this.#bv.get(a);return void 0===c?b:Object.assign(b,c)}getRawValue(a){return this.#bv.get(a)}remove(a){if(this.#bv.delete(a),0===this.#bv.size&&this.resetModified(),"function"==typeof this.onAnnotationEditor){for(let b of this.#bv.values())if(b instanceof b7)return;this.onAnnotationEditor(null)}}setValue(a,b){let c=this.#bv.get(a),d=!1;if(void 0!==c)for(let[e,f]of Object.entries(b))c[e]!==f&&(d=!0,c[e]=f);else d=!0,this.#bv.set(a,b);d&&this.#bw(),b instanceof b7&&"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(b.constructor._type)}has(a){return this.#bv.has(a)}getAll(){return this.#bv.size>0?M(this.#bv):null}setAll(a){for(let[b,c]of Object.entries(a))this.setValue(b,c)}get size(){return this.#bv.size} #bw(){this.#bt||(this.#bt=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#bt&&(this.#bt=!1,"function"==typeof this.onResetModified&&this.onResetModified())}get print(){return new dC(this)}get serializable(){if(0===this.#bv.size)return dA;let a=new Map,b=new dz,c=[],d=Object.create(null),e=!1;for(let[f,g]of this.#bv){let h=g instanceof b7?g.serialize(!1,d):g;h&&(a.set(f,h),b.update(`${f}:${JSON.stringify(h)}`),e||=!!h.bitmap)}if(e)for(let i of a.values())i.bitmap&&c.push(i.bitmap);return a.size>0?{map:a,hash:b.hexdigest(),transfer:c}:dA}get editorStats(){let a=null,b=new Map;for(let c of this.#bv.values()){if(!(c instanceof b7))continue;let d=c.telemetryFinalData;if(!d)continue;let{type:e}=d;b.has(e)||b.set(e,Object.getPrototypeOf(c).constructor),a||=Object.create(null);let f=a[e]||=new Map;for(let[g,h]of Object.entries(d)){if("type"===g)continue;let i=f.get(g);i||(i=new Map,f.set(g,i));let j=i.get(h)??0;i.set(h,j+1)}}for(let[k,l]of b)a[k]=l.computeTelemetryFinalData(a[k]);return a}resetModifiedIds(){this.#bu=null}get modifiedIds(){if(this.#bu)return this.#bu;let a=[];for(let b of this.#bv.values())b instanceof b7&&b.annotationElementId&&b.serialize()&&a.push(b.annotationElementId);return this.#bu={ids:new Set(a),hash:a.join(",")}}}class dC extends dB{#bx;constructor(a){super();let{map:b,hash:c,transfer:d}=a.serializable,e=structuredClone(b,d?{transfer:d}:null);this.#bx={map:e,hash:c,transfer:d}}get print(){y("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#bx}get modifiedIds(){return B(this,"modifiedIds",{ids:new Set,hash:""})}}class dD{#by=new Set;constructor({ownerDocument:a=globalThis.document,styleElement:b=null}){this._document=a,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(a){this.nativeFontFaces.add(a),this._document.fonts.add(a)}removeNativeFontFace(a){this.nativeFontFaces.delete(a),this._document.fonts.delete(a)}insertRule(a){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let b=this.styleElement.sheet;b.insertRule(a,b.cssRules.length)}clear(){for(let a of this.nativeFontFaces)this._document.fonts.delete(a);this.nativeFontFaces.clear(),this.#by.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:a,_inspectFont:b}){if(!(!a||this.#by.has(a.loadedName))){if(z(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:c,src:d,style:e}=a,f=new FontFace(c,d,e);this.addNativeFontFace(f);try{await f.load(),this.#by.add(c),b?.(a)}catch{x(`Cannot load system font: ${a.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(f)}return}y("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(a){if(a.attached||a.missingFile&&!a.systemFontInfo)return;if(a.attached=!0,a.systemFontInfo){await this.loadSystemFont(a);return}if(this.isFontLoadingAPISupported){let b=a.createNativeFontFace();if(b){this.addNativeFontFace(b);try{await b.loaded}catch(c){throw x(`Failed to load font '${b.family}': '${c}'.`),a.disableFontFace=!0,c}}return}let d=a.createFontFaceRule();if(d){if(this.insertRule(d),this.isSyncFontLoadingSupported)return;await new Promise(b=>{let c=this._queueLoadingCallback(b);this._prepareFontLoadEvent(a,c)})}}get isFontLoadingAPISupported(){let a=!!this._document?.fonts;return B(this,"isFontLoadingAPISupported",a)}get isSyncFontLoadingSupported(){let a=!1;return g?a=!0:"undefined"!=typeof navigator&&"string"==typeof navigator?.userAgent&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent)&&(a=!0),B(this,"isSyncFontLoadingSupported",a)}_queueLoadingCallback(a){let{loadingRequests:b}=this,c={done:!1,complete:function(){for(z(!c.done,"completeRequest() cannot be called twice."),c.done=!0;b.length>0&&b[0].done;){let a=b.shift();setTimeout(a.callback,0)}},callback:a};return b.push(c),c}get _loadTestFont(){let a=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return B(this,"_loadTestFont",a)}_prepareFontLoadEvent(a,b){var c;function d(a,b){return a.charCodeAt(b)<<24|a.charCodeAt(b+1)<<16|a.charCodeAt(b+2)<<8|255&a.charCodeAt(b+3)}function e(a,b,c,d){let e=a.substring(0,b),f=a.substring(b+c);return e+d+f}let f,g,h=this._document.createElement("canvas");h.width=1,h.height=1;let i=h.getContext("2d"),j=0;function k(a,b){if(++j>30){x("Load test font never loaded."),b();return}i.font="30px "+a,i.fillText(".",0,20);let c=i.getImageData(0,0,1,1);if(c.data[3]>0){b();return}setTimeout(k.bind(null,a,b))}let l=`lt${Date.now()}${this.loadTestFontId++}`,m=this._loadTestFont;m=e(m,976,l.length,l);let n=16,o=d(m,n);for(f=0,g=l.length-3;f<g;f+=4)o=o-1482184792+d(l,f)|0;f<l.length&&(o=o-1482184792+d(l+"XXX",f)|0),m=e(m,n,4,String.fromCharCode((c=o)>>24&255,c>>16&255,c>>8&255,255&c));let p=`url(data:font/opentype;base64,${btoa(m)});`,q=`@font-face {font-family:"${l}";src:${p}}`;this.insertRule(q);let r=this._document.createElement("div");for(let s of(r.style.visibility="hidden",r.style.width=r.style.height="10px",r.style.position="absolute",r.style.top=r.style.left="0px",[a.loadedName,l])){let t=this._document.createElement("span");t.textContent="Hi",t.style.fontFamily=s,r.append(t)}this._document.body.append(r),k(l,()=>{r.remove(),b.complete()})}}class dE{constructor(a,{disableFontFace:b=!1,inspectFont:c=null}){for(let d in this.compiledGlyphs=Object.create(null),a)this[d]=a[d];this.disableFontFace=!0===b,this._inspectFont=c}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let a;if(this.cssFontInfo){let b={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(b.style=`oblique ${this.cssFontInfo.italicAngle}deg`),a=new FontFace(this.cssFontInfo.fontFamily,this.data,b)}else a=new FontFace(this.loadedName,this.data,{});return this._inspectFont?.(this),a}createFontFaceRule(){var a;if(!this.data||this.disableFontFace)return null;let b=`url(data:${this.mimetype};base64,${(a=this.data,Uint8Array.prototype.toBase64?a.toBase64():btoa(K(a)))});`,c;if(this.cssFontInfo){let d=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(d+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),c=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${d}src:${b}}`}else c=`@font-face {font-family:"${this.loadedName}";src:${b}}`;return this._inspectFont?.(this,b),c}getPathGenerator(a,b){if(void 0!==this.compiledGlyphs[b])return this.compiledGlyphs[b];let c;try{c=a.get(this.loadedName+"_path_"+b)}catch(d){x(`getPathGenerator - ignoring character: "${d}".`)}if(!Array.isArray(c)||0===c.length)return this.compiledGlyphs[b]=function(a,b){};let e=[];for(let f=0,g=c.length;f<g;)switch(c[f++]){case ax.BEZIER_CURVE_TO:{let[h,i,j,k,l,m]=c.slice(f,f+6);e.push(a=>a.bezierCurveTo(h,i,j,k,l,m)),f+=6}break;case ax.MOVE_TO:{let[n,o]=c.slice(f,f+2);e.push(a=>a.moveTo(n,o)),f+=2}break;case ax.LINE_TO:{let[p,q]=c.slice(f,f+2);e.push(a=>a.lineTo(p,q)),f+=2}break;case ax.QUADRATIC_CURVE_TO:{let[r,s,t,u]=c.slice(f,f+4);e.push(a=>a.quadraticCurveTo(r,s,t,u)),f+=4}break;case ax.RESTORE:e.push(a=>a.restore());break;case ax.SAVE:e.push(a=>a.save());break;case ax.SCALE:z(2===e.length,"Scale command is only valid at the third position.");break;case ax.TRANSFORM:{let[v,w,y,A,B,C]=c.slice(f,f+6);e.push(a=>a.transform(v,w,y,A,B,C)),f+=6}break;case ax.TRANSLATE:{let[D,E]=c.slice(f,f+2);e.push(a=>a.translate(D,E)),f+=2}}return this.compiledGlyphs[b]=function(a,b){e[0](a),e[1](a),a.scale(b,-b);for(let c=2,d=e.length;c<d;c++)e[c](a)}}}class dF{#bz=!1;constructor({enableHWA:a=!1}){this.#bz=a}create(a,b){if(a<=0||b<=0)throw Error("Invalid canvas size");let c=this._createCanvas(a,b);return{canvas:c,context:c.getContext("2d",{willReadFrequently:!this.#bz})}}reset(a,b,c){if(!a.canvas)throw Error("Canvas is not specified");if(b<=0||c<=0)throw Error("Invalid canvas size");a.canvas.width=b,a.canvas.height=c}destroy(a){if(!a.canvas)throw Error("Canvas is not specified");a.canvas.width=0,a.canvas.height=0,a.canvas=null,a.context=null}_createCanvas(a,b){y("Abstract method `_createCanvas` called.")}}class dG{constructor({baseUrl:a=null,isCompressed:b=!0}){this.baseUrl=a,this.isCompressed=b}async fetch({name:a}){if(!this.baseUrl)throw Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!a)throw Error("CMap name must be specified.");let b=this.baseUrl+a+(this.isCompressed?".bcmap":"");return this._fetch(b).then(a=>({cMapData:a,isCompressed:this.isCompressed})).catch(a=>{throw Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${b}`)})}async _fetch(a){y("Abstract method `_fetch` called.")}}class dH extends dG{async _fetch(a){let b=await aA(a,this.isCompressed?"arraybuffer":"text");return b instanceof ArrayBuffer?new Uint8Array(b):L(b)}}class dI{addFilter(a){return"none"}addHCMFilter(a,b){return"none"}addAlphaFilter(a){return"none"}addLuminosityFilter(a){return"none"}addHighlightHCMFilter(a,b,c,d,e){return"none"}destroy(a=!1){}}class dJ{constructor({baseUrl:a=null}){this.baseUrl=a}async fetch({filename:a}){if(!this.baseUrl)throw Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!a)throw Error("Font filename must be specified.");let b=`${this.baseUrl}${a}`;return this._fetch(b).catch(a=>{throw Error(`Unable to load font data at: ${b}`)})}async _fetch(a){y("Abstract method `_fetch` called.")}}class dK extends dJ{async _fetch(a){let b=await aA(a,"arraybuffer");return new Uint8Array(b)}}if(g){var dL=Promise.withResolvers(),dM=null;let dN=async()=>{let a=await import("fs"),b=await import("http"),c=await import("https"),d=await import("url"),e,f;return new Map(Object.entries({fs:a,http:b,https:c,url:d,canvas:e,path2d:f}))};dN().then(a=>{dM=a,dL.resolve()},a=>{x(`loadPackages: ${a}`),dM=new Map,dL.resolve()})}class dO{static get promise(){return dL.promise}static get(a){return dM?.get(a)}}async function dP(a){let b=dO.get("fs"),c=await b.promises.readFile(a);return new Uint8Array(c)}let dQ={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function dR(a,b){if(!b)return;let c=b[2]-b[0],d=b[3]-b[1],e=new Path2D;e.rect(b[0],b[1],c,d),a.clip(e)}class dS{getPattern(){y("Abstract method `getPattern` called.")}}class dT extends dS{constructor(a){super(),this._type=a[1],this._bbox=a[2],this._colorStops=a[3],this._p0=a[4],this._p1=a[5],this._r0=a[6],this._r1=a[7],this.matrix=null}_createGradient(a){let b;for(let c of("axial"===this._type?b=a.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(b=a.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1)),this._colorStops))b.addColorStop(c[0],c[1]);return b}getPattern(a,b,c,d){let e;if(d===dQ.STROKE||d===dQ.FILL){let f=b.current.getClippedPathBoundingBox(d,aO(a))||[0,0,0,0],g=Math.ceil(f[2]-f[0])||1,h=Math.ceil(f[3]-f[1])||1,i=b.cachedCanvases.getCanvas("pattern",g,h),j=i.context;j.clearRect(0,0,j.canvas.width,j.canvas.height),j.beginPath(),j.rect(0,0,j.canvas.width,j.canvas.height),j.translate(-f[0],-f[1]),c=P.transform(c,[1,0,0,1,f[0],f[1]]),j.transform(...b.baseTransform),this.matrix&&j.transform(...this.matrix),dR(j,this._bbox),j.fillStyle=this._createGradient(j),j.fill(),e=a.createPattern(i.canvas,"no-repeat");let k=new DOMMatrix(c);e.setTransform(k)}else dR(a,this._bbox),e=this._createGradient(a);return e}}function dU(a,b,c,d,e,f,g,h){let i=b.coords,j=b.colors,k=a.data,l=4*a.width,m;i[c+1]>i[d+1]&&(m=c,c=d,d=m,m=f,f=g,g=m),i[d+1]>i[e+1]&&(m=d,d=e,e=m,m=g,g=h,h=m),i[c+1]>i[d+1]&&(m=c,c=d,d=m,m=f,f=g,g=m);let n=(i[c]+b.offsetX)*b.scaleX,o=(i[c+1]+b.offsetY)*b.scaleY,p=(i[d]+b.offsetX)*b.scaleX,q=(i[d+1]+b.offsetY)*b.scaleY,r=(i[e]+b.offsetX)*b.scaleX,s=(i[e+1]+b.offsetY)*b.scaleY;if(o>=s)return;let t=j[f],u=j[f+1],v=j[f+2],w=j[g],x=j[g+1],y=j[g+2],z=j[h],A=j[h+1],B=j[h+2],C=Math.round(o),D=Math.round(s),E,F,G,H,I,J,K,L;for(let M=C;M<=D;M++){if(M<q){let N=M<o?0:(o-M)/(o-q);E=n-(n-p)*N,F=t-(t-w)*N,G=u-(u-x)*N,H=v-(v-y)*N}else{let O;E=p-(p-r)*(O=M>s?1:q===s?0:(q-M)/(q-s)),F=w-(w-z)*O,G=x-(x-A)*O,H=y-(y-B)*O}let P;I=n-(n-r)*(P=M<o?0:M>s?1:(o-M)/(o-s)),J=t-(t-z)*P,K=u-(u-A)*P,L=v-(v-B)*P;let Q=Math.round(Math.min(E,I)),R=Math.round(Math.max(E,I)),S=l*M+4*Q;for(let T=Q;T<=R;T++)(P=(E-T)/(E-I))<0?P=0:P>1&&(P=1),k[S++]=F-(F-J)*P|0,k[S++]=G-(G-K)*P|0,k[S++]=H-(H-L)*P|0,k[S++]=255}}function dV(a,b,c){let d=b.coords,e=b.colors,f,g;switch(b.type){case"lattice":let h=b.verticesPerRow,i=Math.floor(d.length/h)-1,j=h-1;for(f=0;f<i;f++){let k=f*h;for(let l=0;l<j;l++,k++)dU(a,c,d[k],d[k+1],d[k+h],e[k],e[k+1],e[k+h]),dU(a,c,d[k+h+1],d[k+1],d[k+h],e[k+h+1],e[k+1],e[k+h])}break;case"triangles":for(f=0,g=d.length;f<g;f+=3)dU(a,c,d[f],d[f+1],d[f+2],e[f],e[f+1],e[f+2]);break;default:throw Error("illegal figure")}}class dW extends dS{constructor(a){super(),this._coords=a[2],this._colors=a[3],this._figures=a[4],this._bounds=a[5],this._bbox=a[7],this._background=a[8],this.matrix=null}_createMeshCanvas(a,b,c){let d=Math.floor(this._bounds[0]),e=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-d,g=Math.ceil(this._bounds[3])-e,h=Math.min(Math.ceil(Math.abs(f*a[0]*1.1)),3e3),i=Math.min(Math.ceil(Math.abs(g*a[1]*1.1)),3e3),j=f/h,k=g/i,l={coords:this._coords,colors:this._colors,offsetX:-d,offsetY:-e,scaleX:1/j,scaleY:1/k},m=c.getCanvas("mesh",h+4,i+4),n=m.context,o=n.createImageData(h,i);if(b){let p=o.data;for(let q=0,r=p.length;q<r;q+=4)p[q]=b[0],p[q+1]=b[1],p[q+2]=b[2],p[q+3]=255}for(let s of this._figures)dV(o,s,l);n.putImageData(o,2,2);let t=m.canvas;return{canvas:t,offsetX:d-2*j,offsetY:e-2*k,scaleX:j,scaleY:k}}getPattern(a,b,c,d){dR(a,this._bbox);let e;if(d===dQ.SHADING)e=P.singularValueDecompose2dScale(aO(a));else if(e=P.singularValueDecompose2dScale(b.baseTransform),this.matrix){let f=P.singularValueDecompose2dScale(this.matrix);e=[e[0]*f[0],e[1]*f[1]]}let g=this._createMeshCanvas(e,d===dQ.SHADING?null:this._background,b.cachedCanvases);return d!==dQ.SHADING&&(a.setTransform(...b.baseTransform),this.matrix&&a.transform(...this.matrix)),a.translate(g.offsetX,g.offsetY),a.scale(g.scaleX,g.scaleY),a.createPattern(g.canvas,"no-repeat")}}class dX extends dS{getPattern(){return"hotpink"}}let dY={COLORED:1,UNCOLORED:2};class dZ{static MAX_PATTERN_SIZE=3e3;constructor(a,b,c,d,e){this.operatorList=a[2],this.matrix=a[3],this.bbox=a[4],this.xstep=a[5],this.ystep=a[6],this.paintType=a[7],this.tilingType=a[8],this.color=b,this.ctx=c,this.canvasGraphicsFactory=d,this.baseTransform=e}createPatternCanvas(a){let{bbox:b,operatorList:c,paintType:d,tilingType:e,color:f,canvasGraphicsFactory:g}=this,{xstep:h,ystep:i}=this;h=Math.abs(h),i=Math.abs(i),w("TilingType: "+e);let j=b[0],k=b[1],l=b[2],m=b[3],n=l-j,o=m-k,p=P.singularValueDecompose2dScale(this.matrix),q=P.singularValueDecompose2dScale(this.baseTransform),r=p[0]*q[0],s=p[1]*q[1],t=n,u=o,v=!1,x=!1,y=Math.ceil(h*r),z=Math.ceil(i*s);y>=Math.ceil(n*r)?t=h:v=!0,z>=Math.ceil(o*s)?u=i:x=!0;let A=this.getSizeAndScale(t,this.ctx.canvas.width,r),B=this.getSizeAndScale(u,this.ctx.canvas.height,s),C=a.cachedCanvases.getCanvas("pattern",A.size,B.size),D=C.context,E=g.createCanvasGraphics(D);if(E.groupLevel=a.groupLevel,this.setFillAndStrokeStyleToContext(E,d,f),D.translate(-A.scale*j,-B.scale*k),E.transform(A.scale,0,0,B.scale,0,0),D.save(),this.clipBbox(E,j,k,l,m),E.baseTransform=aO(E.ctx),E.executeOperatorList(c),E.endDrawing(),D.restore(),v||x){let F=C.canvas;v&&(t=h),x&&(u=i);let G=this.getSizeAndScale(t,this.ctx.canvas.width,r),H=this.getSizeAndScale(u,this.ctx.canvas.height,s),I=G.size,J=H.size,K=a.cachedCanvases.getCanvas("pattern-workaround",I,J),L=K.context,M=v?Math.floor(n/h):0,N=x?Math.floor(o/i):0;for(let O=0;O<=M;O++)for(let Q=0;Q<=N;Q++)L.drawImage(F,I*O,J*Q,I,J,0,0,I,J);return{canvas:K.canvas,scaleX:G.scale,scaleY:H.scale,offsetX:j,offsetY:k}}return{canvas:C.canvas,scaleX:A.scale,scaleY:B.scale,offsetX:j,offsetY:k}}getSizeAndScale(a,b,c){let d=Math.max(dZ.MAX_PATTERN_SIZE,b),e=Math.ceil(a*c);return e>=d?e=d:c=e/a,{scale:c,size:e}}clipBbox(a,b,c,d,e){a.ctx.rect(b,c,d-b,e-c),a.current.updateRectMinMax(aO(a.ctx),[b,c,d,e]),a.clip(),a.endPath()}setFillAndStrokeStyleToContext(a,b,c){let d=a.ctx,e=a.current;switch(b){case dY.COLORED:let f=this.ctx;d.fillStyle=f.fillStyle,d.strokeStyle=f.strokeStyle,e.fillColor=f.fillStyle,e.strokeColor=f.strokeStyle;break;case dY.UNCOLORED:let g=P.makeHexColor(c[0],c[1],c[2]);d.fillStyle=g,d.strokeStyle=g,e.fillColor=g,e.strokeColor=g;break;default:throw new I(`Unsupported paint type: ${b}`)}}getPattern(a,b,c,d){let e=c;d!==dQ.SHADING&&(e=P.transform(e,b.baseTransform),this.matrix&&(e=P.transform(e,this.matrix)));let f=this.createPatternCanvas(b),g=new DOMMatrix(e);g=(g=g.translate(f.offsetX,f.offsetY)).scale(1/f.scaleX,1/f.scaleY);let h=a.createPattern(f.canvas,"repeat");return h.setTransform(g),h}}function d$({src:a,srcPos:b=0,dest:c,width:d,height:e,nonBlackColor:f=4294967295,inverseDecode:g=!1}){let h=N.isLittleEndian?4278190080:255,[i,j]=g?[f,h]:[h,f],k=d>>3,l=7&d,m=a.length;c=new Uint32Array(c.buffer);let n=0;for(let o=0;o<e;o++){for(let p=b+k;b<p;b++){let q=b<m?a[b]:255;c[n++]=128&q?j:i,c[n++]=64&q?j:i,c[n++]=32&q?j:i,c[n++]=16&q?j:i,c[n++]=8&q?j:i,c[n++]=4&q?j:i,c[n++]=2&q?j:i,c[n++]=1&q?j:i}if(0===l)continue;let r=b<m?a[b++]:255;for(let s=0;s<l;s++)c[n++]=r&1<<7-s?j:i}return{srcPos:b,destPos:n}}function d_(a,b,c,d,e,f,g,h,i,j){let[k,l,m,n,o,p]=aO(a);if(0===l&&0===m){let q=g*k+o,r=Math.round(q),s=h*n+p,t=Math.round(s),u=(g+i)*k+o,v=Math.abs(Math.round(u)-r)||1,w=(h+j)*n+p,x=Math.abs(Math.round(w)-t)||1;return a.setTransform(Math.sign(k),0,0,Math.sign(n),r,t),a.drawImage(b,c,d,e,f,0,0,v,x),a.setTransform(k,l,m,n,o,p),[v,x]}if(0===k&&0===n){let y=h*m+o,z=Math.round(y),A=g*l+p,B=Math.round(A),C=(h+j)*m+o,D=Math.abs(Math.round(C)-z)||1,E=(g+i)*l+p,F=Math.abs(Math.round(E)-B)||1;return a.setTransform(0,Math.sign(l),Math.sign(m),0,z,B),a.drawImage(b,c,d,e,f,0,0,F,D),a.setTransform(k,l,m,n,o,p),[F,D]}return a.drawImage(b,c,d,e,f,g,h,i,j),[Math.hypot(k,l)*i,Math.hypot(m,n)*j]}class d0{constructor(a,b){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=h,this.textMatrixScale=1,this.fontMatrix=i,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=o.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,a,b])}clone(){let a=Object.create(this);return a.clipBox=this.clipBox.slice(),a}setCurrentPoint(a,b){this.x=a,this.y=b}updatePathMinMax(a,b,c){[b,c]=P.applyTransform([b,c],a),this.minX=Math.min(this.minX,b),this.minY=Math.min(this.minY,c),this.maxX=Math.max(this.maxX,b),this.maxY=Math.max(this.maxY,c)}updateRectMinMax(a,b){let c=P.applyTransform(b,a),d=P.applyTransform(b.slice(2),a),e=P.applyTransform([b[0],b[3]],a),f=P.applyTransform([b[2],b[1]],a);this.minX=Math.min(this.minX,c[0],d[0],e[0],f[0]),this.minY=Math.min(this.minY,c[1],d[1],e[1],f[1]),this.maxX=Math.max(this.maxX,c[0],d[0],e[0],f[0]),this.maxY=Math.max(this.maxY,c[1],d[1],e[1],f[1])}updateScalingPathMinMax(a,b){P.scaleMinMax(a,b),this.minX=Math.min(this.minX,b[0]),this.minY=Math.min(this.minY,b[1]),this.maxX=Math.max(this.maxX,b[2]),this.maxY=Math.max(this.maxY,b[3])}updateCurvePathMinMax(a,b,c,d,e,f,g,h,i,j){let k=P.bezierBoundingBox(b,c,d,e,f,g,h,i,j);!j&&this.updateRectMinMax(a,k)}getPathBoundingBox(a=dQ.FILL,b=null){let c=[this.minX,this.minY,this.maxX,this.maxY];if(a===dQ.STROKE){b||y("Stroke bounding box must include transform.");let d=P.singularValueDecompose2dScale(b),e=d[0]*this.lineWidth/2,f=d[1]*this.lineWidth/2;c[0]-=e,c[1]-=f,c[2]+=e,c[3]+=f}return c}updateClipFromPath(){let a=P.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(a||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(a){this.clipBox=a,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(a=dQ.FILL,b=null){return P.intersect(this.clipBox,this.getPathBoundingBox(a,b))}}function d1(a,b){if("undefined"!=typeof ImageData&&b instanceof ImageData){a.putImageData(b,0,0);return}let c=b.height,d=b.width,e=c%16,f=(c-e)/16,g=0===e?f:f+1,h=a.createImageData(d,16),i=0,j,k=b.data,l=h.data,m,n,o,q;if(b.kind===p.GRAYSCALE_1BPP){let r=k.byteLength,s=new Uint32Array(l.buffer,0,l.byteLength>>2),t=s.length,u=d+7>>3,v=4294967295,w=N.isLittleEndian?4278190080:255;for(m=0;m<g;m++){for(n=0,o=m<f?16:e,j=0;n<o;n++){let x=r-i,y=0,z=x>u?d:8*x-7,A=-8&z,B=0,C=0;for(;y<A;y+=8)C=k[i++],s[j++]=128&C?v:w,s[j++]=64&C?v:w,s[j++]=32&C?v:w,s[j++]=16&C?v:w,s[j++]=8&C?v:w,s[j++]=4&C?v:w,s[j++]=2&C?v:w,s[j++]=1&C?v:w;for(;y<z;y++)0===B&&(C=k[i++],B=128),s[j++]=C&B?v:w,B>>=1}for(;j<t;)s[j++]=0;a.putImageData(h,0,16*m)}}else if(b.kind===p.RGBA_32BPP){for(m=0,n=0,q=64*d;m<f;m++)l.set(k.subarray(i,i+q)),i+=q,a.putImageData(h,0,n),n+=16;m<g&&(q=d*e*4,l.set(k.subarray(i,i+q)),a.putImageData(h,0,n))}else if(b.kind===p.RGB_24BPP)for(m=0,q=d*(o=16);m<g;m++){for(m>=f&&(q=d*(o=e)),j=0,n=q;n--;)l[j++]=k[i++],l[j++]=k[i++],l[j++]=k[i++],l[j++]=255;a.putImageData(h,0,16*m)}else throw Error(`bad image kind: ${b.kind}`)}function d2(a,b){if(b.bitmap){a.drawImage(b.bitmap,0,0);return}let c=b.height,d=b.width,e=c%16,f=(c-e)/16,g=0===e?f:f+1,h=a.createImageData(d,16),i=0,j=b.data,k=h.data;for(let l=0;l<g;l++){let m=l<f?16:e;({srcPos:i}=d$({src:j,srcPos:i,dest:k,width:d,height:m,nonBlackColor:0})),a.putImageData(h,0,16*l)}}function d3(a,b){for(let c of["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"])void 0!==a[c]&&(b[c]=a[c]);void 0!==a.setLineDash&&(b.setLineDash(a.getLineDash()),b.lineDashOffset=a.lineDashOffset)}function d4(a){if(a.strokeStyle=a.fillStyle="#000000",a.fillRule="nonzero",a.globalAlpha=1,a.lineWidth=1,a.lineCap="butt",a.lineJoin="miter",a.miterLimit=10,a.globalCompositeOperation="source-over",a.font="10px sans-serif",void 0!==a.setLineDash&&(a.setLineDash([]),a.lineDashOffset=0),!g){let{filter:b}=a;"none"!==b&&""!==b&&(a.filter="none")}}function d5(a,b){if(b)return!0;let c=P.singularValueDecompose2dScale(a);c[0]=Math.fround(c[0]),c[1]=Math.fround(c[1]);let d=Math.fround((globalThis.devicePixelRatio||1)*az.PDF_TO_CSS_UNITS);return c[0]<=d&&c[1]<=d}let d6=["butt","round","square"],d7=["miter","round","bevel"],d8={},d9={};class ea{constructor(a,b,c,d,e,{optionalContentConfig:f,markedContentStack:g=null},h,i){this.ctx=a,this.current=new d0(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=b,this.objs=c,this.canvasFactory=d,this.filterFactory=e,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=g||[],this.optionalContentConfig=f,this.cachedCanvases=new class{constructor(a){this.canvasFactory=a,this.cache=Object.create(null)}getCanvas(a,b,c){let d;return void 0!==this.cache[a]?(d=this.cache[a],this.canvasFactory.reset(d,b,c)):(d=this.canvasFactory.create(b,c),this.cache[a]=d),d}delete(a){delete this.cache[a]}clear(){for(let a in this.cache){let b=this.cache[a];this.canvasFactory.destroy(b),delete this.cache[a]}}}(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=h,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=i,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(a,b=null){return"string"==typeof a?a.startsWith("g_")?this.commonObjs.get(a):this.objs.get(a):b}beginDrawing({transform:a,viewport:b,transparency:c=!1,background:d=null}){let e=this.ctx.canvas.width,f=this.ctx.canvas.height,g=this.ctx.fillStyle;if(this.ctx.fillStyle=d||"#ffffff",this.ctx.fillRect(0,0,e,f),this.ctx.fillStyle=g,c){let h=this.cachedCanvases.getCanvas("transparent",e,f);this.compositeCtx=this.ctx,this.transparentCanvas=h.canvas,this.ctx=h.context,this.ctx.save(),this.ctx.transform(...aO(this.compositeCtx))}this.ctx.save(),d4(this.ctx),a&&(this.ctx.transform(...a),this.outputScaleX=a[0],this.outputScaleY=a[0]),this.ctx.transform(...b.transform),this.viewportScale=b.scale,this.baseTransform=aO(this.ctx)}executeOperatorList(a,b,c,d){let e=a.argsArray,f=a.fnArray,g=b||0,h=e.length;if(h===g)return g;let i=h-g>10&&"function"==typeof c,j=i?Date.now()+15:0,k=0,l=this.commonObjs,m=this.objs,n;for(;;){if(void 0!==d&&g===d.nextBreakPoint)return d.breakIt(g,c),g;if((n=f[g])!==t.dependency)this[n].apply(this,e[g]);else for(let o of e[g]){let p=o.startsWith("g_")?l:m;if(!p.has(o))return p.get(o,c),g}if(++g===h)return g;if(i&& ++k>10){if(Date.now()>j)return c(),g;k=0}}} #bA(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){for(let a of(this.#bA(),this.cachedCanvases.clear(),this.cachedPatterns.clear(),this._cachedBitmapsMap.values())){for(let b of a.values())"undefined"!=typeof HTMLCanvasElement&&b instanceof HTMLCanvasElement&&(b.width=b.height=0);a.clear()}this._cachedBitmapsMap.clear(),this.#bB()} #bB(){if(this.pageColors){let eb=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==eb){let ec=this.ctx.filter;this.ctx.filter=eb,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=ec}}}_scaleImage(a,b){let c=a.width??a.displayWidth,d=a.height??a.displayHeight,e=Math.max(Math.hypot(b[0],b[1]),1),f=Math.max(Math.hypot(b[2],b[3]),1),g=c,h=d,i="prescale1",j,k;for(;e>2&&g>1||f>2&&h>1;){let l=g,m=h;e>2&&g>1&&(l=g>=16384?Math.floor(g/2)-1||1:Math.ceil(g/2),e/=g/l),f>2&&h>1&&(m=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h)/2,f/=h/m),(k=(j=this.cachedCanvases.getCanvas(i,l,m)).context).clearRect(0,0,l,m),k.drawImage(a,0,0,g,h,0,0,l,m),a=j.canvas,g=l,h=m,i="prescale1"===i?"prescale2":"prescale1"}return{img:a,paintWidth:g,paintHeight:h}}_createMaskCanvas(a){let b=this.ctx,{width:c,height:d}=a,e=this.current.fillColor,f=this.current.patternFill,g=aO(b),h,i,j,k;if((a.bitmap||a.data)&&a.count>1){let l=a.bitmap||a.data.buffer;i=JSON.stringify(f?g:[g.slice(0,4),e]),(h=this._cachedBitmapsMap.get(l))||(h=new Map,this._cachedBitmapsMap.set(l,h));let m=h.get(i);if(m&&!f){let n=Math.round(Math.min(g[0],g[2])+g[4]),o=Math.round(Math.min(g[1],g[3])+g[5]);return{canvas:m,offsetX:n,offsetY:o}}j=m}j||(k=this.cachedCanvases.getCanvas("maskCanvas",c,d),d2(k.context,a));let p=P.transform(g,[1/c,0,0,-1/d,0,0]);p=P.transform(p,[1,0,0,1,0,-d]);let[q,r,s,t]=P.getAxialAlignedBoundingBox([0,0,c,d],p),u=this.cachedCanvases.getCanvas("fillCanvas",Math.round(s-q)||1,Math.round(t-r)||1),v=u.context,w=q,x=r;v.translate(-w,-x),v.transform(...p),!j&&(j=(j=this._scaleImage(k.canvas,aP(v))).img,h&&f&&h.set(i,j)),v.imageSmoothingEnabled=d5(aO(v),a.interpolate),d_(v,j,0,0,j.width,j.height,0,0,c,d),v.globalCompositeOperation="source-in";let y=P.transform(aP(v),[1,0,0,1,-w,-x]);return v.fillStyle=f?e.getPattern(b,this,y,dQ.FILL):e,v.fillRect(0,0,c,d),h&&!f&&(this.cachedCanvases.delete("fillCanvas"),h.set(i,u.canvas)),{canvas:u.canvas,offsetX:Math.round(w),offsetY:Math.round(x)}}setLineWidth(a){a!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=a,this.ctx.lineWidth=a}setLineCap(a){this.ctx.lineCap=d6[a]}setLineJoin(a){this.ctx.lineJoin=d7[a]}setMiterLimit(a){this.ctx.miterLimit=a}setDash(a,b){let c=this.ctx;void 0!==c.setLineDash&&(c.setLineDash(a),c.lineDashOffset=b)}setRenderingIntent(a){}setFlatness(a){}setGState(a){for(let[b,c]of a)switch(b){case"LW":this.setLineWidth(c);break;case"LC":this.setLineCap(c);break;case"LJ":this.setLineJoin(c);break;case"ML":this.setMiterLimit(c);break;case"D":this.setDash(c[0],c[1]);break;case"RI":this.setRenderingIntent(c);break;case"FL":this.setFlatness(c);break;case"Font":this.setFont(c[0],c[1]);break;case"CA":this.current.strokeAlpha=c;break;case"ca":this.current.fillAlpha=c,this.ctx.globalAlpha=c;break;case"BM":this.ctx.globalCompositeOperation=c;break;case"SMask":this.current.activeSMask=c?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(c)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let a=this.inSMaskMode;this.current.activeSMask&&!a?this.beginSMaskMode():!this.current.activeSMask&&a&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw Error("beginSMaskMode called while already in smask mode");let a=this.ctx.canvas.width,b=this.ctx.canvas.height,c="smaskGroupAt"+this.groupLevel,d=this.cachedCanvases.getCanvas(c,a,b);this.suspendedCtx=this.ctx,this.ctx=d.context;let e=this.ctx;e.setTransform(...aO(this.suspendedCtx)),d3(this.suspendedCtx,e),function(a,b){if(a._removeMirroring)throw Error("Context is already forwarding operations.");a.__originalSave=a.save,a.__originalRestore=a.restore,a.__originalRotate=a.rotate,a.__originalScale=a.scale,a.__originalTranslate=a.translate,a.__originalTransform=a.transform,a.__originalSetTransform=a.setTransform,a.__originalResetTransform=a.resetTransform,a.__originalClip=a.clip,a.__originalMoveTo=a.moveTo,a.__originalLineTo=a.lineTo,a.__originalBezierCurveTo=a.bezierCurveTo,a.__originalRect=a.rect,a.__originalClosePath=a.closePath,a.__originalBeginPath=a.beginPath,a._removeMirroring=()=>{a.save=a.__originalSave,a.restore=a.__originalRestore,a.rotate=a.__originalRotate,a.scale=a.__originalScale,a.translate=a.__originalTranslate,a.transform=a.__originalTransform,a.setTransform=a.__originalSetTransform,a.resetTransform=a.__originalResetTransform,a.clip=a.__originalClip,a.moveTo=a.__originalMoveTo,a.lineTo=a.__originalLineTo,a.bezierCurveTo=a.__originalBezierCurveTo,a.rect=a.__originalRect,a.closePath=a.__originalClosePath,a.beginPath=a.__originalBeginPath,delete a._removeMirroring},a.save=function(){b.save(),this.__originalSave()},a.restore=function(){b.restore(),this.__originalRestore()},a.translate=function(a,c){b.translate(a,c),this.__originalTranslate(a,c)},a.scale=function(a,c){b.scale(a,c),this.__originalScale(a,c)},a.transform=function(a,c,d,e,f,g){b.transform(a,c,d,e,f,g),this.__originalTransform(a,c,d,e,f,g)},a.setTransform=function(a,c,d,e,f,g){b.setTransform(a,c,d,e,f,g),this.__originalSetTransform(a,c,d,e,f,g)},a.resetTransform=function(){b.resetTransform(),this.__originalResetTransform()},a.rotate=function(a){b.rotate(a),this.__originalRotate(a)},a.clip=function(a){b.clip(a),this.__originalClip(a)},a.moveTo=function(a,c){b.moveTo(a,c),this.__originalMoveTo(a,c)},a.lineTo=function(a,c){b.lineTo(a,c),this.__originalLineTo(a,c)},a.bezierCurveTo=function(a,c,d,e,f,g){b.bezierCurveTo(a,c,d,e,f,g),this.__originalBezierCurveTo(a,c,d,e,f,g)},a.rect=function(a,c,d,e){b.rect(a,c,d,e),this.__originalRect(a,c,d,e)},a.closePath=function(){b.closePath(),this.__originalClosePath()},a.beginPath=function(){b.beginPath(),this.__originalBeginPath()}}(e,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),d3(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(a){if(!this.current.activeSMask)return;a?(a[0]=Math.floor(a[0]),a[1]=Math.floor(a[1]),a[2]=Math.ceil(a[2]),a[3]=Math.ceil(a[3])):a=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let b=this.current.activeSMask,c=this.suspendedCtx;this.composeSMask(c,b,this.ctx,a),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(a,b,c,d){let e=d[0],f=d[1],g=d[2]-e,h=d[3]-f;0!==g&&0!==h&&(this.genericComposeSMask(b.context,c,g,h,b.subtype,b.backdrop,b.transferMap,e,f,b.offsetX,b.offsetY),a.save(),a.globalAlpha=1,a.globalCompositeOperation="source-over",a.setTransform(1,0,0,1,0,0),a.drawImage(c.canvas,0,0),a.restore())}genericComposeSMask(a,b,c,d,e,f,g,h,i,j,k){let l=a.canvas,m=h-j,n=i-k;if(f){let o=P.makeHexColor(...f);if(m<0||n<0||m+c>l.width||n+d>l.height){let p=this.cachedCanvases.getCanvas("maskExtension",c,d),q=p.context;q.drawImage(l,-m,-n),q.globalCompositeOperation="destination-atop",q.fillStyle=o,q.fillRect(0,0,c,d),q.globalCompositeOperation="source-over",l=p.canvas,m=n=0}else{a.save(),a.globalAlpha=1,a.setTransform(1,0,0,1,0,0);let r=new Path2D;r.rect(m,n,c,d),a.clip(r),a.globalCompositeOperation="destination-atop",a.fillStyle=o,a.fillRect(m,n,c,d),a.restore()}}b.save(),b.globalAlpha=1,b.setTransform(1,0,0,1,0,0),"Alpha"===e&&g?b.filter=this.filterFactory.addAlphaFilter(g):"Luminosity"===e&&(b.filter=this.filterFactory.addLuminosityFilter(g));let s=new Path2D;s.rect(h,i,c,d),b.clip(s),b.globalCompositeOperation="destination-in",b.drawImage(l,m,n,c,d,h,i,c,d),b.restore()}save(){this.inSMaskMode?(d3(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let a=this.current;this.stateStack.push(a),this.current=a.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),d3(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(a,b,c,d,e,f){this.ctx.transform(a,b,c,d,e,f),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(a,b,c){let d=this.ctx,e=this.current,f=e.x,g=e.y,h,i,j=aO(d),k=0===j[0]&&0===j[3]||0===j[1]&&0===j[2],l=k?c.slice(0):null;for(let m=0,n=0,o=a.length;m<o;m++)switch(0|a[m]){case t.rectangle:f=b[n++],g=b[n++];let p=b[n++],q=b[n++],r=f+p,s=g+q;d.moveTo(f,g),0===p||0===q?d.lineTo(r,s):(d.lineTo(r,g),d.lineTo(r,s),d.lineTo(f,s)),k||e.updateRectMinMax(j,[f,g,r,s]),d.closePath();break;case t.moveTo:f=b[n++],g=b[n++],d.moveTo(f,g),k||e.updatePathMinMax(j,f,g);break;case t.lineTo:f=b[n++],g=b[n++],d.lineTo(f,g),k||e.updatePathMinMax(j,f,g);break;case t.curveTo:h=f,i=g,f=b[n+4],g=b[n+5],d.bezierCurveTo(b[n],b[n+1],b[n+2],b[n+3],f,g),e.updateCurvePathMinMax(j,h,i,b[n],b[n+1],b[n+2],b[n+3],f,g,l),n+=6;break;case t.curveTo2:h=f,i=g,d.bezierCurveTo(f,g,b[n],b[n+1],b[n+2],b[n+3]),e.updateCurvePathMinMax(j,h,i,f,g,b[n],b[n+1],b[n+2],b[n+3],l),f=b[n+2],g=b[n+3],n+=4;break;case t.curveTo3:h=f,i=g,f=b[n+2],g=b[n+3],d.bezierCurveTo(b[n],b[n+1],f,g,f,g),e.updateCurvePathMinMax(j,h,i,b[n],b[n+1],f,g,f,g,l),n+=4;break;case t.closePath:d.closePath()}k&&e.updateScalingPathMinMax(j,l),e.setCurrentPoint(f,g)}closePath(){this.ctx.closePath()}stroke(a=!0){let b=this.ctx,c=this.current.strokeColor;b.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"==typeof c&&c?.getPattern?(b.save(),b.strokeStyle=c.getPattern(b,this,aP(b),dQ.STROKE),this.rescaleAndStroke(!1),b.restore()):this.rescaleAndStroke(!0)),a&&this.consumePath(this.current.getClippedPathBoundingBox()),b.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(a=!0){let b=this.ctx,c=this.current.fillColor,d=this.current.patternFill,e=!1;d&&(b.save(),b.fillStyle=c.getPattern(b,this,aP(b),dQ.FILL),e=!0);let f=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==f&&(this.pendingEOFill?(b.fill("evenodd"),this.pendingEOFill=!1):b.fill()),e&&b.restore(),a&&this.consumePath(f)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=d8}eoClip(){this.pendingClip=d9}beginText(){this.current.textMatrix=h,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let a=this.pendingTextPaths,b=this.ctx;if(void 0===a){b.beginPath();return}for(let c of(b.save(),b.beginPath(),a))b.setTransform(...c.transform),b.translate(c.x,c.y),c.addToPath(b,c.fontSize);b.restore(),b.clip(),b.beginPath(),delete this.pendingTextPaths}setCharSpacing(a){this.current.charSpacing=a}setWordSpacing(a){this.current.wordSpacing=a}setHScale(a){this.current.textHScale=a/100}setLeading(a){this.current.leading=-a}setFont(a,b){let c=this.commonObjs.get(a),d=this.current;if(!c)throw Error(`Can't find font for ${a}`);if(d.fontMatrix=c.fontMatrix||i,(0===d.fontMatrix[0]||0===d.fontMatrix[3])&&x("Invalid font matrix for font "+a),b<0?(b=-b,d.fontDirection=-1):d.fontDirection=1,this.current.font=c,this.current.fontSize=b,c.isType3Font)return;let e=c.loadedName||"sans-serif",f=c.systemFontInfo?.css||`"${e}", ${c.fallbackName}`,g="normal";c.black?g="900":c.bold&&(g="bold");let h=c.italic?"italic":"normal",j=b;b<16?j=16:b>100&&(j=100),this.current.fontSizeScale=b/j,this.ctx.font=`${h} ${g} ${j}px ${f}`}setTextRenderingMode(a){this.current.textRenderingMode=a}setTextRise(a){this.current.textRise=a}moveText(a,b){this.current.x=this.current.lineX+=a,this.current.y=this.current.lineY+=b}setLeadingMoveText(a,b){this.setLeading(-b),this.moveText(a,b)}setTextMatrix(a,b,c,d,e,f){this.current.textMatrix=[a,b,c,d,e,f],this.current.textMatrixScale=Math.hypot(a,b),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(a,b,c,d){let e=this.ctx,f=this.current,g=f.font,h=f.textRenderingMode,i=f.fontSize/f.fontSizeScale,j=h&o.FILL_STROKE_MASK,k=!!(h&o.ADD_TO_PATH_FLAG),l=f.patternFill&&!g.missingFile,m;if((g.disableFontFace||k||l)&&(m=g.getPathGenerator(this.commonObjs,a)),g.disableFontFace||l?(e.save(),e.translate(b,c),e.beginPath(),m(e,i),d&&e.setTransform(...d),(j===o.FILL||j===o.FILL_STROKE)&&e.fill(),(j===o.STROKE||j===o.FILL_STROKE)&&e.stroke(),e.restore()):((j===o.FILL||j===o.FILL_STROKE)&&e.fillText(a,b,c),(j===o.STROKE||j===o.FILL_STROKE)&&e.strokeText(a,b,c)),k){let n=this.pendingTextPaths||=[];n.push({transform:aO(e),x:b,y:c,fontSize:i,addToPath:m})}}get isFontSubpixelAAEnabled(){let{context:a}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);a.scale(1.5,1),a.fillText("I",0,10);let b=a.getImageData(0,0,10,10).data,c=!1;for(let d=3;d<b.length;d+=4)if(b[d]>0&&b[d]<255){c=!0;break}return B(this,"isFontSubpixelAAEnabled",c)}showText(a){let b=this.current,c=b.font;if(c.isType3Font)return this.showType3Text(a);let d=b.fontSize;if(0===d)return;let e=this.ctx,f=b.fontSizeScale,g=b.charSpacing,h=b.wordSpacing,i=b.fontDirection,j=b.textHScale*i,k=a.length,l=c.vertical,m=l?1:-1,n=c.defaultVMetrics,p=d*b.fontMatrix[0],q=b.textRenderingMode===o.FILL&&!c.disableFontFace&&!b.patternFill;e.save(),e.transform(...b.textMatrix),e.translate(b.x,b.y+b.textRise),i>0?e.scale(j,-1):e.scale(j,1);let r;if(b.patternFill){e.save();let s=b.fillColor.getPattern(e,this,aP(e),dQ.FILL);r=aO(e),e.restore(),e.fillStyle=s}let t=b.lineWidth,u=b.textMatrixScale;if(0===u||0===t){let v=b.textRenderingMode&o.FILL_STROKE_MASK;(v===o.STROKE||v===o.FILL_STROKE)&&(t=this.getSinglePixelWidth())}else t/=u;if(1!==f&&(e.scale(f,f),t/=f),e.lineWidth=t,c.isInvalidPDFjsFont){let w=[],x=0;for(let y of a)w.push(y.unicode),x+=y.width;e.fillText(w.join(""),0,0),b.x+=x*p*j,e.restore(),this.compose();return}let z=0,A;for(A=0;A<k;++A){let B=a[A];if("number"==typeof B){z+=m*B*d/1e3;continue}let C=!1,D=(B.isSpace?h:0)+g,E=B.fontChar,F=B.accent,G,H,I=B.width;if(l){let J=B.vmetric||n,K=-(B.vmetric?J[1]:.5*I)*p,L=J[2]*p;I=J?-J[0]:I,G=K/f,H=(z+L)/f}else G=z/f,H=0;if(c.remeasure&&I>0){let M=1e3*e.measureText(E).width/d*f;if(I<M&&this.isFontSubpixelAAEnabled){let N=I/M;C=!0,e.save(),e.scale(N,1),G/=N}else I!==M&&(G+=(I-M)/2e3*d/f)}if(this.contentVisible&&(B.isInFont||c.missingFile)){if(q&&!F)e.fillText(E,G,H);else if(this.paintChar(E,G,H,r),F){let O=G+d*F.offset.x/f,P=H-d*F.offset.y/f;this.paintChar(F.fontChar,O,P,r)}}let Q=l?I*p-D*i:I*p+D*i;z+=Q,C&&e.restore()}l?b.y-=z:b.x+=z*j,e.restore(),this.compose()}showType3Text(a){let b=this.ctx,c=this.current,d=c.font,e=c.fontSize,f=c.fontDirection,g=d.vertical?1:-1,h=c.charSpacing,j=c.wordSpacing,k=c.textHScale*f,l=c.fontMatrix||i,m=a.length,n=c.textRenderingMode===o.INVISIBLE,p,q,r,s;if(!n&&0!==e){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,b.save(),b.transform(...c.textMatrix),b.translate(c.x,c.y),b.scale(k,f),p=0;p<m;++p){if("number"==typeof(q=a[p])){s=g*q*e/1e3,this.ctx.translate(s,0),c.x+=s*k;continue}let t=(q.isSpace?j:0)+h,u=d.charProcOperatorList[q.operatorListId];if(!u){x(`Type3 character "${q.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=q,this.save(),b.scale(e,e),b.transform(...l),this.executeOperatorList(u),this.restore());let v=P.applyTransform([q.width,0],l);r=v[0]*e+t,b.translate(r,0),c.x+=r*k}b.restore(),this.processingType3=null}}setCharWidth(a,b){}setCharWidthAndBounds(a,b,c,d,e,f){this.ctx.rect(c,d,e-c,f-d),this.ctx.clip(),this.endPath()}getColorN_Pattern(a){let b;if("TilingPattern"===a[0]){let c=a[1],d=this.baseTransform||aO(this.ctx),e={createCanvasGraphics:a=>new ea(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};b=new dZ(a,c,this.ctx,e,d)}else b=this._getPattern(a[1],a[2]);return b}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(a,b,c){this.ctx.strokeStyle=this.current.strokeColor=P.makeHexColor(a,b,c)}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent"}setFillRGBColor(a,b,c){this.ctx.fillStyle=this.current.fillColor=P.makeHexColor(a,b,c),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(a,b=null){let c;return this.cachedPatterns.has(a)?c=this.cachedPatterns.get(a):(c=function(a){switch(a[0]){case"RadialAxial":return new dT(a);case"Mesh":return new dW(a);case"Dummy":return new dX}throw Error(`Unknown IR type: ${a[0]}`)}(this.getObject(a)),this.cachedPatterns.set(a,c)),b&&(c.matrix=b),c}shadingFill(a){if(!this.contentVisible)return;let b=this.ctx;this.save();let c=this._getPattern(a);b.fillStyle=c.getPattern(b,this,aP(b),dQ.SHADING);let d=aP(b);if(d){let{width:e,height:f}=b.canvas,[g,h,i,j]=P.getAxialAlignedBoundingBox([0,0,e,f],d);this.ctx.fillRect(g,h,i-g,j-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){y("Should not call beginInlineImage")}beginImageData(){y("Should not call beginImageData")}paintFormXObjectBegin(a,b){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),a&&this.transform(...a),this.baseTransform=aO(this.ctx),b)){let c=b[2]-b[0],d=b[3]-b[1];this.ctx.rect(b[0],b[1],c,d),this.current.updateRectMinMax(aO(this.ctx),b),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(a){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let b=this.ctx;a.isolated||w("TODO: Support non-isolated groups."),a.knockout&&x("Knockout groups not supported.");let c=aO(b);if(a.matrix&&b.transform(...a.matrix),!a.bbox)throw Error("Bounding box is required.");let d=P.getAxialAlignedBoundingBox(a.bbox,aO(b)),e=[0,0,b.canvas.width,b.canvas.height];d=P.intersect(d,e)||[0,0,0,0];let f=Math.floor(d[0]),g=Math.floor(d[1]),h=Math.max(Math.ceil(d[2])-f,1),i=Math.max(Math.ceil(d[3])-g,1);this.current.startNewPathAndClipBox([0,0,h,i]);let j="groupAt"+this.groupLevel;a.smask&&(j+="_smask_"+(this.smaskCounter++)%2);let k=this.cachedCanvases.getCanvas(j,h,i),l=k.context;l.translate(-f,-g),l.transform(...c),a.smask?this.smaskStack.push({canvas:k.canvas,context:l,offsetX:f,offsetY:g,subtype:a.smask.subtype,backdrop:a.smask.backdrop,transferMap:a.smask.transferMap||null,startTransformInverse:null}):(b.setTransform(1,0,0,1,0,0),b.translate(f,g),b.save()),d3(b,l),this.ctx=l,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(b),this.groupLevel++}endGroup(a){if(!this.contentVisible)return;this.groupLevel--;let b=this.ctx,c=this.groupStack.pop();if(this.ctx=c,this.ctx.imageSmoothingEnabled=!1,a.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let d=aO(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...d);let e=P.getAxialAlignedBoundingBox([0,0,b.canvas.width,b.canvas.height],d);this.ctx.drawImage(b.canvas,0,0),this.ctx.restore(),this.compose(e)}}beginAnnotation(a,b,c,d,e){if(this.#bA(),d4(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),b){let f=b[2]-b[0],g=b[3]-b[1];if(e&&this.annotationCanvasMap){c=c.slice(),c[4]-=b[0],c[5]-=b[1],(b=b.slice())[0]=b[1]=0,b[2]=f,b[3]=g;let[h,i]=P.singularValueDecompose2dScale(aO(this.ctx)),{viewportScale:j}=this,k=Math.ceil(f*this.outputScaleX*j),l=Math.ceil(g*this.outputScaleY*j);this.annotationCanvas=this.canvasFactory.create(k,l);let{canvas:m,context:n}=this.annotationCanvas;this.annotationCanvasMap.set(a,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=n,this.ctx.save(),this.ctx.setTransform(h,0,0,-i,0,g*i),d4(this.ctx)}else d4(this.ctx),this.endPath(),this.ctx.rect(b[0],b[1],f,g),this.ctx.clip(),this.ctx.beginPath()}this.current=new d0(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...c),this.transform(...d)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#bB(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(a){if(!this.contentVisible)return;let b=a.count;(a=this.getObject(a.data,a)).count=b;let c=this.ctx,d=this.processingType3;if(d&&(void 0===d.compiled&&(d.compiled=function(a){let{width:b,height:c}=a;if(b>1e3||c>1e3)return null;let d=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),e=b+1,f=new Uint8Array(e*(c+1)),g,h,i,j=b+7& -8,k=new Uint8Array(j*c),l=0;for(let m of a.data){let n=128;for(;n>0;)k[l++]=m&n?0:255,n>>=1}let o=0;for(0!==k[l=0]&&(f[0]=1,++o),h=1;h<b;h++)k[l]!==k[l+1]&&(f[h]=k[l]?2:1,++o),l++;for(0!==k[l]&&(f[h]=2,++o),g=1;g<c;g++){l=g*j,i=g*e,k[l-j]!==k[l]&&(f[i]=k[l]?1:8,++o);let p=(k[l]?4:0)+(k[l-j]?8:0);for(h=1;h<b;h++)d[p=(p>>2)+(k[l+1]?4:0)+(k[l-j+1]?8:0)]&&(f[i+h]=d[p],++o),l++;if(k[l-j]!==k[l]&&(f[i+h]=k[l]?2:4,++o),o>1e3)return null}for(l=j*(c-1),i=g*e,0!==k[l]&&(f[i]=8,++o),h=1;h<b;h++)k[l]!==k[l+1]&&(f[i+h]=k[l]?4:8,++o),l++;if(0!==k[l]&&(f[i+h]=4,++o),o>1e3)return null;let q=new Int32Array([0,e,-1,0,-e,0,0,0,1]),r=new Path2D;for(g=0;o&&g<=c;g++){let s=g*e,t=s+b;for(;s<t&&!f[s];)s++;if(s===t)continue;r.moveTo(s%e,g);let u=s,v=f[s];do{let w=q[v];do s+=w;while(!f[s])let x=f[s];5!==x&&10!==x?(v=x,f[s]=0):(v=x&51*v>>4,f[s]&=v>>2|v<<2),r.lineTo(s%e,s/e|0),!f[s]&& --o}while(u!==s)--g}k=null,f=null;let y=function(a){a.save(),a.scale(1/b,-1/c),a.translate(0,-c),a.fill(r),a.beginPath(),a.restore()};return y}(a)),d.compiled)){d.compiled(c);return}let e=this._createMaskCanvas(a),f=e.canvas;c.save(),c.setTransform(1,0,0,1,0,0),c.drawImage(f,e.offsetX,e.offsetY),c.restore(),this.compose()}paintImageMaskXObjectRepeat(a,b,c=0,d=0,e,f){if(!this.contentVisible)return;a=this.getObject(a.data,a);let g=this.ctx;g.save();let h=aO(g);g.transform(b,c,d,e,0,0);let i=this._createMaskCanvas(a);g.setTransform(1,0,0,1,i.offsetX-h[4],i.offsetY-h[5]);for(let j=0,k=f.length;j<k;j+=2){let l=P.transform(h,[b,c,d,e,f[j],f[j+1]]),[m,n]=P.applyTransform([0,0],l);g.drawImage(i.canvas,m,n)}g.restore(),this.compose()}paintImageMaskXObjectGroup(a){if(!this.contentVisible)return;let b=this.ctx,c=this.current.fillColor,d=this.current.patternFill;for(let e of a){let{data:f,width:g,height:h,transform:i}=e,j=this.cachedCanvases.getCanvas("maskCanvas",g,h),k=j.context;k.save();let l=this.getObject(f,e);d2(k,l),k.globalCompositeOperation="source-in",k.fillStyle=d?c.getPattern(k,this,aP(b),dQ.FILL):c,k.fillRect(0,0,g,h),k.restore(),b.save(),b.transform(...i),b.scale(1,-1),d_(b,j.canvas,0,0,g,h,0,-1,1,1),b.restore()}this.compose()}paintImageXObject(a){if(!this.contentVisible)return;let b=this.getObject(a);if(!b){x("Dependent image isn't ready yet");return}this.paintInlineImageXObject(b)}paintImageXObjectRepeat(a,b,c,d){if(!this.contentVisible)return;let e=this.getObject(a);if(!e){x("Dependent image isn't ready yet");return}let f=e.width,g=e.height,h=[];for(let i=0,j=d.length;i<j;i+=2)h.push({transform:[b,0,0,c,d[i],d[i+1]],x:0,y:0,w:f,h:g});this.paintInlineImageXObjectGroup(e,h)}applyTransferMapsToCanvas(a){return"none"!==this.current.transferMaps&&(a.filter=this.current.transferMaps,a.drawImage(a.canvas,0,0),a.filter="none"),a.canvas}applyTransferMapsToBitmap(a){if("none"===this.current.transferMaps)return a.bitmap;let{bitmap:b,width:c,height:d}=a,e=this.cachedCanvases.getCanvas("inlineImage",c,d),f=e.context;return f.filter=this.current.transferMaps,f.drawImage(b,0,0),f.filter="none",e.canvas}paintInlineImageXObject(a){if(!this.contentVisible)return;let b=a.width,c=a.height,d=this.ctx;if(this.save(),!g){let{filter:e}=d;"none"!==e&&""!==e&&(d.filter="none")}d.scale(1/b,-1/c);let f;if(a.bitmap)f=this.applyTransferMapsToBitmap(a);else if("function"==typeof HTMLElement&&a instanceof HTMLElement||!a.data)f=a;else{let h=this.cachedCanvases.getCanvas("inlineImage",b,c),i=h.context;d1(i,a),f=this.applyTransferMapsToCanvas(i)}let j=this._scaleImage(f,aP(d));d.imageSmoothingEnabled=d5(aO(d),a.interpolate),d_(d,j.img,0,0,j.paintWidth,j.paintHeight,0,-c,b,c),this.compose(),this.restore()}paintInlineImageXObjectGroup(a,b){if(!this.contentVisible)return;let c=this.ctx,d;if(a.bitmap)d=a.bitmap;else{let e=a.width,f=a.height,g=this.cachedCanvases.getCanvas("inlineImage",e,f),h=g.context;d1(h,a),d=this.applyTransferMapsToCanvas(h)}for(let i of b)c.save(),c.transform(...i.transform),c.scale(1,-1),d_(c,d,i.x,i.y,i.w,i.h,0,-1,1,1),c.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(a){}markPointProps(a,b){}beginMarkedContent(a){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(a,b){"OC"===a?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(b)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(a){let b=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(a);let c=this.ctx;this.pendingClip&&(b||(this.pendingClip===d9?c.clip("evenodd"):c.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),c.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let a=aO(this.ctx);if(0===a[1]&&0===a[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(a[0]),Math.abs(a[3]));else{let b=Math.abs(a[0]*a[3]-a[2]*a[1]),c=Math.hypot(a[0],a[2]),d=Math.hypot(a[1],a[3]);this._cachedGetSinglePixelWidth=Math.max(c,d)/b}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){let{lineWidth:a}=this.current,{a:b,b:c,c:d,d:e}=this.ctx.getTransform(),f,g;if(0===c&&0===d){let h=Math.abs(b),i=Math.abs(e);if(h===i){if(0===a)f=g=1/h;else{let j=h*a;f=g=j<1?1/j:1}}else if(0===a)f=1/h,g=1/i;else{let k=h*a,l=i*a;f=k<1?1/k:1,g=l<1?1/l:1}}else{let m=Math.abs(b*e-c*d),n=Math.hypot(b,c),o=Math.hypot(d,e);if(0===a)f=o/m,g=n/m;else{let p=a*m;f=o>p?o/p:1,g=n>p?n/p:1}}this._cachedScaleForStroking[0]=f,this._cachedScaleForStroking[1]=g}return this._cachedScaleForStroking}rescaleAndStroke(a){let{ctx:b}=this,{lineWidth:c}=this.current,[d,e]=this.getScaleForStroking();if(b.lineWidth=c||1,1===d&&1===e){b.stroke();return}let f=b.getLineDash();if(a&&b.save(),b.scale(d,e),f.length>0){let g=Math.max(d,e);b.setLineDash(f.map(a=>a/g)),b.lineDashOffset/=g}b.stroke(),a&&b.restore()}isContentVisible(){for(let a=this.markedContentStack.length-1;a>=0;a--)if(!this.markedContentStack[a].visible)return!1;return!0}}for(let ed in t)void 0!==ea.prototype[ed]&&(ea.prototype[t[ed]]=ea.prototype[ed]);class ee{static #bC=null;static #bD="";static get workerPort(){return this.#bC}static set workerPort(a){if(!("undefined"!=typeof Worker&&a instanceof Worker)&&null!==a)throw Error("Invalid `workerPort` type.");this.#bC=a}static get workerSrc(){return this.#bD}static set workerSrc(a){if("string"!=typeof a)throw Error("Invalid `workerSrc` type.");this.#bD=a}}let ef={UNKNOWN:0,DATA:1,ERROR:2},eg={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function eh(a){switch(a instanceof Error||"object"==typeof a&&null!==a||y('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),a.name){case"AbortException":return new J(a.message);case"MissingPDFException":return new G(a.message);case"PasswordException":return new D(a.message,a.code);case"UnexpectedResponseException":return new H(a.message,a.status);case"UnknownErrorException":return new E(a.message,a.details);default:return new E(a.message,a.toString())}}class ei{#bE=new AbortController;constructor(a,b,c){this.sourceName=a,this.targetName=b,this.comObj=c,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),c.addEventListener("message",this.#bF.bind(this),{signal:this.#bE.signal})} #bF({data:ej}){if(ej.targetName!==this.sourceName)return;if(ej.stream){this.#bG(ej);return}if(ej.callback){let ek=ej.callbackId,el=this.callbackCapabilities[ek];if(!el)throw Error(`Cannot resolve callback ${ek}`);if(delete this.callbackCapabilities[ek],ej.callback===ef.DATA)el.resolve(ej.data);else if(ej.callback===ef.ERROR)el.reject(eh(ej.reason));else throw Error("Unexpected callback case");return}let em=this.actionHandler[ej.action];if(!em)throw Error(`Unknown action from worker: ${ej.action}`);if(ej.callbackId){let en=this.sourceName,eo=ej.sourceName,ep=this.comObj;new Promise(function(a){a(em(ej.data))}).then(function(a){ep.postMessage({sourceName:en,targetName:eo,callback:ef.DATA,callbackId:ej.callbackId,data:a})},function(a){ep.postMessage({sourceName:en,targetName:eo,callback:ef.ERROR,callbackId:ej.callbackId,reason:eh(a)})});return}if(ej.streamId){this.#bH(ej);return}em(ej.data)}on(a,b){let c=this.actionHandler;if(c[a])throw Error(`There is already an actionName called "${a}"`);c[a]=b}send(a,b,c){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:a,data:b},c)}sendWithPromise(a,b,c){let d=this.callbackId++,e=Promise.withResolvers();this.callbackCapabilities[d]=e;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:a,callbackId:d,data:b},c)}catch(f){e.reject(f)}return e.promise}sendWithStream(a,b,c,d){let e=this.streamId++,f=this.sourceName,g=this.targetName,h=this.comObj;return new ReadableStream({start:c=>{let i=Promise.withResolvers();return this.streamControllers[e]={controller:c,startCall:i,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:f,targetName:g,action:a,streamId:e,data:b,desiredSize:c.desiredSize},d),i.promise},pull:a=>{let b=Promise.withResolvers();return this.streamControllers[e].pullCall=b,h.postMessage({sourceName:f,targetName:g,stream:eg.PULL,streamId:e,desiredSize:a.desiredSize}),b.promise},cancel:a=>{z(a instanceof Error,"cancel must have a valid reason");let b=Promise.withResolvers();return this.streamControllers[e].cancelCall=b,this.streamControllers[e].isClosed=!0,h.postMessage({sourceName:f,targetName:g,stream:eg.CANCEL,streamId:e,reason:eh(a)}),b.promise}},c)} #bH(eq){let er=eq.streamId,es=this.sourceName,et=eq.sourceName,eu=this.comObj,ev=this,ew=this.actionHandler[eq.action],ex={enqueue(a,b=1,c){if(this.isCancelled)return;let d=this.desiredSize;this.desiredSize-=b,d>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),eu.postMessage({sourceName:es,targetName:et,stream:eg.ENQUEUE,streamId:er,chunk:a},c)},close(){!this.isCancelled&&(this.isCancelled=!0,eu.postMessage({sourceName:es,targetName:et,stream:eg.CLOSE,streamId:er}),delete ev.streamSinks[er])},error(a){z(a instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,eu.postMessage({sourceName:es,targetName:et,stream:eg.ERROR,streamId:er,reason:eh(a)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:eq.desiredSize,ready:null};ex.sinkCapability.resolve(),ex.ready=ex.sinkCapability.promise,this.streamSinks[er]=ex,new Promise(function(a){a(ew(eq.data,ex))}).then(function(){eu.postMessage({sourceName:es,targetName:et,stream:eg.START_COMPLETE,streamId:er,success:!0})},function(a){eu.postMessage({sourceName:es,targetName:et,stream:eg.START_COMPLETE,streamId:er,reason:eh(a)})})} #bG(ey){let ez=ey.streamId,eA=this.sourceName,eB=ey.sourceName,eC=this.comObj,eD=this.streamControllers[ez],eE=this.streamSinks[ez];switch(ey.stream){case eg.START_COMPLETE:ey.success?eD.startCall.resolve():eD.startCall.reject(eh(ey.reason));break;case eg.PULL_COMPLETE:ey.success?eD.pullCall.resolve():eD.pullCall.reject(eh(ey.reason));break;case eg.PULL:if(!eE){eC.postMessage({sourceName:eA,targetName:eB,stream:eg.PULL_COMPLETE,streamId:ez,success:!0});break}eE.desiredSize<=0&&ey.desiredSize>0&&eE.sinkCapability.resolve(),eE.desiredSize=ey.desiredSize,new Promise(function(a){a(eE.onPull?.())}).then(function(){eC.postMessage({sourceName:eA,targetName:eB,stream:eg.PULL_COMPLETE,streamId:ez,success:!0})},function(a){eC.postMessage({sourceName:eA,targetName:eB,stream:eg.PULL_COMPLETE,streamId:ez,reason:eh(a)})});break;case eg.ENQUEUE:if(z(eD,"enqueue should have stream controller"),eD.isClosed)break;eD.controller.enqueue(ey.chunk);break;case eg.CLOSE:if(z(eD,"close should have stream controller"),eD.isClosed)break;eD.isClosed=!0,eD.controller.close(),this.#bI(eD,ez);break;case eg.ERROR:z(eD,"error should have stream controller"),eD.controller.error(eh(ey.reason)),this.#bI(eD,ez);break;case eg.CANCEL_COMPLETE:ey.success?eD.cancelCall.resolve():eD.cancelCall.reject(eh(ey.reason)),this.#bI(eD,ez);break;case eg.CANCEL:if(!eE)break;new Promise(function(a){a(eE.onCancel?.(eh(ey.reason)))}).then(function(){eC.postMessage({sourceName:eA,targetName:eB,stream:eg.CANCEL_COMPLETE,streamId:ez,success:!0})},function(a){eC.postMessage({sourceName:eA,targetName:eB,stream:eg.CANCEL_COMPLETE,streamId:ez,reason:eh(a)})}),eE.sinkCapability.reject(eh(ey.reason)),eE.isCancelled=!0,delete this.streamSinks[ez];break;default:throw Error("Unexpected stream case")}}async #bI(eF,eG){await Promise.allSettled([eF.startCall?.promise,eF.pullCall?.promise,eF.cancelCall?.promise]),delete this.streamControllers[eG]}destroy(){this.#bE?.abort(),this.#bE=null}}class eH{#bJ;#bK;constructor({parsedData:a,rawData:b}){this.#bJ=a,this.#bK=b}getRaw(){return this.#bK}get(a){return this.#bJ.get(a)??null}getAll(){return M(this.#bJ)}has(a){return this.#bJ.has(a)}}let eI=Symbol("INTERNAL");class eJ{#bL=!1;#bM=!1;#bN=!1;#bO=!0;constructor(a,{name:b,intent:c,usage:d,rbGroups:e}){this.#bL=!!(a&j.DISPLAY),this.#bM=!!(a&j.PRINT),this.name=b,this.intent=c,this.usage=d,this.rbGroups=e}get visible(){if(this.#bN)return this.#bO;if(!this.#bO)return!1;let{print:a,view:b}=this.usage;return this.#bL?b?.viewState!=="OFF":!this.#bM||a?.printState!=="OFF"}_setVisible(a,b,c=!1){a!==eI&&y("Internal method `_setVisible` called."),this.#bN=c,this.#bO=b}}class eK{#bP=null;#bQ=new Map;#bR=null;#bS=null;constructor(a,b=j.DISPLAY){if(this.renderingIntent=b,this.name=null,this.creator=null,null===a)return;for(let c of(this.name=a.name,this.creator=a.creator,this.#bS=a.order,a.groups))this.#bQ.set(c.id,new eJ(b,c));if("OFF"===a.baseState)for(let d of this.#bQ.values())d._setVisible(eI,!1);for(let e of a.on)this.#bQ.get(e)._setVisible(eI,!0);for(let f of a.off)this.#bQ.get(f)._setVisible(eI,!1);this.#bR=this.getHash()} #bT(eL){let eM=eL.length;if(eM<2)return!0;let eN=eL[0];for(let eO=1;eO<eM;eO++){let eP=eL[eO],eQ;if(Array.isArray(eP))eQ=this.#bT(eP);else{if(!this.#bQ.has(eP))return x(`Optional content group not found: ${eP}`),!0;eQ=this.#bQ.get(eP).visible}switch(eN){case"And":if(!eQ)return!1;break;case"Or":if(eQ)return!0;break;case"Not":return!eQ;default:return!0}}return"And"===eN}isVisible(a){if(0===this.#bQ.size)return!0;if(!a)return w("Optional content group not defined."),!0;if("OCG"===a.type)return this.#bQ.has(a.id)?this.#bQ.get(a.id).visible:(x(`Optional content group not found: ${a.id}`),!0);if("OCMD"===a.type){if(a.expression)return this.#bT(a.expression);if(a.policy&&"AnyOn"!==a.policy){if("AllOn"===a.policy){for(let b of a.ids){if(!this.#bQ.has(b)){x(`Optional content group not found: ${b}`);break}if(!this.#bQ.get(b).visible)return!1}return!0}if("AnyOff"===a.policy){for(let c of a.ids){if(!this.#bQ.has(c))return x(`Optional content group not found: ${c}`),!0;if(!this.#bQ.get(c).visible)return!0}return!1}else if("AllOff"===a.policy){for(let d of a.ids){if(!this.#bQ.has(d)){x(`Optional content group not found: ${d}`);break}if(this.#bQ.get(d).visible)return!1}return!0}}else{for(let e of a.ids){if(!this.#bQ.has(e))return x(`Optional content group not found: ${e}`),!0;if(this.#bQ.get(e).visible)return!0}return!1}return x(`Unknown optional content policy ${a.policy}.`),!0}return x(`Unknown group type ${a.type}.`),!0}setVisibility(a,b=!0,c=!0){let d=this.#bQ.get(a);if(!d){x(`Optional content group not found: ${a}`);return}if(c&&b&&d.rbGroups.length)for(let e of d.rbGroups)for(let f of e)f!==a&&this.#bQ.get(f)?._setVisible(eI,!1,!0);d._setVisible(eI,!!b,!0),this.#bP=null}setOCGState({state:a,preserveRB:b}){let c;for(let d of a){switch(d){case"ON":case"OFF":case"Toggle":c=d;continue}let e=this.#bQ.get(d);if(e)switch(c){case"ON":this.setVisibility(d,!0,b);break;case"OFF":this.setVisibility(d,!1,b);break;case"Toggle":this.setVisibility(d,!e.visible,b)}}this.#bP=null}get hasInitialVisibility(){return null===this.#bR||this.getHash()===this.#bR}getOrder(){return this.#bQ.size?this.#bS?this.#bS.slice():[...this.#bQ.keys()]:null}getGroups(){return this.#bQ.size>0?M(this.#bQ):null}getGroup(a){return this.#bQ.get(a)||null}getHash(){if(null!==this.#bP)return this.#bP;let a=new dz;for(let[b,c]of this.#bQ)a.update(`${b}:${c.visible}`);return this.#bP=a.hexdigest()}}class eR{constructor(a,{disableRange:b=!1,disableStream:c=!1}){z(a,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:d,initialData:e,progressiveDone:f,contentDispositionFilename:g}=a;if(this._queuedChunks=[],this._progressiveDone=f,this._contentDispositionFilename=g,e?.length>0){let h=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;this._queuedChunks.push(h)}this._pdfDataRangeTransport=a,this._isStreamingSupported=!c,this._isRangeSupported=!b,this._contentLength=d,this._fullRequestReader=null,this._rangeReaders=[],a.addRangeListener((a,b)=>{this._onReceiveData({begin:a,chunk:b})}),a.addProgressListener((a,b)=>{this._onProgress({loaded:a,total:b})}),a.addProgressiveReadListener(a=>{this._onReceiveData({chunk:a})}),a.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),a.transportReady()}_onReceiveData({begin:a,chunk:b}){let c=b instanceof Uint8Array&&b.byteLength===b.buffer.byteLength?b.buffer:new Uint8Array(b).buffer;if(void 0===a)this._fullRequestReader?this._fullRequestReader._enqueue(c):this._queuedChunks.push(c);else{let d=this._rangeReaders.some(function(b){return b._begin===a&&(b._enqueue(c),!0)});z(d,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(a){void 0===a.total?this._rangeReaders[0]?.onProgress?.({loaded:a.loaded}):this._fullRequestReader?.onProgress?.({loaded:a.loaded,total:a.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(a){let b=this._rangeReaders.indexOf(a);b>=0&&this._rangeReaders.splice(b,1)}getFullReader(){z(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let a=this._queuedChunks;return this._queuedChunks=null,new eS(this,a,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(a,b){if(b<=this._progressiveDataLength)return null;let c=new eT(this,a,b);return this._pdfDataRangeTransport.requestDataRange(a,b),this._rangeReaders.push(c),c}cancelAllRequests(a){for(let b of(this._fullRequestReader?.cancel(a),this._rangeReaders.slice(0)))b.cancel(a);this._pdfDataRangeTransport.abort()}}class eS{constructor(a,b,c=!1,d=null){for(let e of(this._stream=a,this._done=c||!1,this._filename=aE(d)?d:null,this._queuedChunks=b||[],this._loaded=0,this._queuedChunks))this._loaded+=e.byteLength;this._requests=[],this._headersReady=Promise.resolve(),a._fullRequestReader=this,this.onProgress=null}_enqueue(a){if(!this._done){if(this._requests.length>0){let b=this._requests.shift();b.resolve({value:a,done:!1})}else this._queuedChunks.push(a);this._loaded+=a.byteLength}}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0){let a=this._queuedChunks.shift();return{value:a,done:!1}}if(this._done)return{value:void 0,done:!0};let b=Promise.withResolvers();return this._requests.push(b),b.promise}cancel(a){for(let b of(this._done=!0,this._requests))b.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){!this._done&&(this._done=!0)}}class eT{constructor(a,b,c){this._stream=a,this._begin=b,this._end=c,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(a){if(!this._done){if(0===this._requests.length)this._queuedChunk=a;else{let b=this._requests.shift();for(let c of(b.resolve({value:a,done:!1}),this._requests))c.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let a=this._queuedChunk;return this._queuedChunk=null,{value:a,done:!1}}if(this._done)return{value:void 0,done:!0};let b=Promise.withResolvers();return this._requests.push(b),b.promise}cancel(a){for(let b of(this._done=!0,this._requests))b.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function eU(a,b){let c=new Headers;if(!a||!b||"object"!=typeof b)return c;for(let d in b){let e=b[d];void 0!==e&&c.append(d,e)}return c}function eV({responseHeaders:a,isHttp:b,rangeChunkSize:c,disableRange:d}){let e={allowRangeRequests:!1,suggestedLength:void 0},f=parseInt(a.get("Content-Length"),10);if(!Number.isInteger(f)||(e.suggestedLength=f,f<=2*c||d||!b||"bytes"!==a.get("Accept-Ranges")))return e;let g=a.get("Content-Encoding")||"identity";return"identity"!==g||(e.allowRangeRequests=!0),e}function eW(a){let b=a.get("Content-Disposition");if(b){let c=function(a){let b=!0,c=g("filename\\*","i").exec(a);if(c){let d=j(c=c[1]);return d=unescape(d),d=k(d),d=l(d),i(d)}if(c=function(a){let b=[],c,d=g("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(c=d.exec(a));){let[,e,f,h]=c;if((e=parseInt(e,10))in b){if(0===e)break;continue}b[e]=[f,h]}let i=[];for(let l=0;l<b.length&&(l in b);++l){let[m,n]=b[l];n=j(n),m&&(n=unescape(n),0===l&&(n=k(n))),i.push(n)}return i.join("")}(a)){let e=l(c);return i(e)}if(c=g("filename","i").exec(a)){let f=j(c=c[1]);return f=l(f),i(f)}function g(a,b){return RegExp("(?:^|;)\\s*"+a+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',b)}function h(a,c){if(a){if(!/^[\x00-\xFF]+$/.test(c))return c;try{let d=new TextDecoder(a,{fatal:!0}),e=L(c);c=d.decode(e),b=!1}catch{}}return c}function i(a){return b&&/[\x80-\xff]/.test(a)&&(a=h("utf-8",a),b&&(a=h("iso-8859-1",a))),a}function j(a){if(a.startsWith('"')){let b=a.slice(1).split('\\"');for(let c=0;c<b.length;++c){let d=b[c].indexOf('"');-1!==d&&(b[c]=b[c].slice(0,d),b.length=c+1),b[c]=b[c].replaceAll(/\\(.)/g,"$1")}a=b.join('"')}return a}function k(a){let b=a.indexOf("'");if(-1===b)return a;let c=a.slice(0,b),d=a.slice(b+1),e=d.replace(/^[^']*'/,"");return h(c,e)}function l(a){return!a.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(a)?a:a.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(a,b,c,d){if("q"===c||"Q"===c)return h(b,d=(d=d.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,function(a,b){return String.fromCharCode(parseInt(b,16))}));try{d=atob(d)}catch{}return h(b,d)})}return""}(b);if(c.includes("%"))try{c=decodeURIComponent(c)}catch{}if(aE(c))return c}return null}function eX(a,b){return 404===a||0===a&&b.startsWith("file:")?new G('Missing PDF "'+b+'".'):new H(`Unexpected server response (${a}) while retrieving PDF "${b}".`,a)}function eY(a){return 200===a||206===a}function eZ(a,b,c){return{method:"GET",headers:a,signal:c.signal,mode:"cors",credentials:b?"include":"same-origin",redirect:"follow"}}function e$(a){return a instanceof Uint8Array?a.buffer:a instanceof ArrayBuffer?a:(x(`getArrayBuffer - unexpected data format: ${a}`),new Uint8Array(a).buffer)}class e_{constructor(a){this.source=a,this.isHttp=/^https?:/i.test(a.url),this.headers=eU(this.isHttp,a.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return z(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new e0(this),this._fullRequestReader}getRangeReader(a,b){if(b<=this._progressiveDataLength)return null;let c=new e1(this,a,b);return this._rangeRequestReaders.push(c),c}cancelAllRequests(a){for(let b of(this._fullRequestReader?.cancel(a),this._rangeRequestReaders.slice(0)))b.cancel(a)}}class e0{constructor(a){this._stream=a,this._reader=null,this._loaded=0,this._filename=null;let b=a.source;this._withCredentials=b.withCredentials||!1,this._contentLength=b.length,this._headersCapability=Promise.withResolvers(),this._disableRange=b.disableRange||!1,this._rangeChunkSize=b.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!b.disableStream,this._isRangeSupported=!b.disableRange;let c=new Headers(a.headers),d=b.url;fetch(d,eZ(c,this._withCredentials,this._abortController)).then(b=>{if(!eY(b.status))throw eX(b.status,d);this._reader=b.body.getReader(),this._headersCapability.resolve();let c=b.headers,{allowRangeRequests:e,suggestedLength:f}=eV({responseHeaders:c,isHttp:a.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=e,this._contentLength=f||this._contentLength,this._filename=eW(c),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new J("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:a,done:b}=await this._reader.read();return b?{value:a,done:b}:(this._loaded+=a.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:e$(a),done:!1})}cancel(a){this._reader?.cancel(a),this._abortController.abort()}}class e1{constructor(a,b,c){this._stream=a,this._reader=null,this._loaded=0;let d=a.source;this._withCredentials=d.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!d.disableStream,this._abortController=new AbortController;let e=new Headers(a.headers);e.append("Range",`bytes=${b}-${c-1}`);let f=d.url;fetch(f,eZ(e,this._withCredentials,this._abortController)).then(a=>{if(!eY(a.status))throw eX(a.status,f);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:a,done:b}=await this._reader.read();return b?{value:a,done:b}:(this._loaded+=a.byteLength,this.onProgress?.({loaded:this._loaded}),{value:e$(a),done:!1})}cancel(a){this._reader?.cancel(a),this._abortController.abort()}}class e2{constructor(a){this._source=a,this._manager=new class{constructor({url:a,httpHeaders:b,withCredentials:c}){this.url=a,this.isHttp=/^https?:/i.test(a),this.headers=eU(this.isHttp,b),this.withCredentials=c||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(a,b,c){let d={begin:a,end:b};for(let e in c)d[e]=c[e];return this.request(d)}requestFull(a){return this.request(a)}request(a){let b=new XMLHttpRequest,c=this.currXhrId++,d=this.pendingRequests[c]={xhr:b};for(let[e,f]of(b.open("GET",this.url),b.withCredentials=this.withCredentials,this.headers))b.setRequestHeader(e,f);return this.isHttp&&"begin"in a&&"end"in a?(b.setRequestHeader("Range",`bytes=${a.begin}-${a.end-1}`),d.expectedStatus=206):d.expectedStatus=200,b.responseType="arraybuffer",a.onError&&(b.onerror=function(c){a.onError(b.status)}),b.onreadystatechange=this.onStateChange.bind(this,c),b.onprogress=this.onProgress.bind(this,c),d.onHeadersReceived=a.onHeadersReceived,d.onDone=a.onDone,d.onError=a.onError,d.onProgress=a.onProgress,b.send(null),c}onProgress(a,b){let c=this.pendingRequests[a];c&&c.onProgress?.(b)}onStateChange(a,b){let c=this.pendingRequests[a];if(!c)return;let d=c.xhr;if(d.readyState>=2&&c.onHeadersReceived&&(c.onHeadersReceived(),delete c.onHeadersReceived),4!==d.readyState||!(a in this.pendingRequests))return;if(delete this.pendingRequests[a],0===d.status&&this.isHttp){c.onError?.(d.status);return}let e=d.status||200,f=200===e&&206===c.expectedStatus;if(!f&&e!==c.expectedStatus){c.onError?.(d.status);return}let g=function(a){let b=a.response;return"string"!=typeof b?b:L(b).buffer}(d);if(206===e){let h=d.getResponseHeader("Content-Range"),i=/bytes (\d+)-(\d+)\/(\d+)/.exec(h);c.onDone({begin:parseInt(i[1],10),chunk:g})}else g?c.onDone({begin:0,chunk:g}):c.onError?.(d.status)}getRequestXhr(a){return this.pendingRequests[a].xhr}isPendingRequest(a){return a in this.pendingRequests}abortRequest(a){let b=this.pendingRequests[a].xhr;delete this.pendingRequests[a],b.abort()}}(a),this._rangeChunkSize=a.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(a){let b=this._rangeRequestReaders.indexOf(a);b>=0&&this._rangeRequestReaders.splice(b,1)}getFullReader(){return z(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new e3(this._manager,this._source),this._fullRequestReader}getRangeReader(a,b){let c=new e4(this._manager,a,b);return c.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(c),c}cancelAllRequests(a){for(let b of(this._fullRequestReader?.cancel(a),this._rangeRequestReaders.slice(0)))b.cancel(a)}}class e3{constructor(a,b){this._manager=a;let c={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=b.url,this._fullRequestId=a.requestFull(c),this._headersCapability=Promise.withResolvers(),this._disableRange=b.disableRange||!1,this._contentLength=b.length,this._rangeChunkSize=b.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let a=this._fullRequestId,b=this._manager.getRequestXhr(a),c=new Headers(b.getAllResponseHeaders().trim().split(/[\r\n]+/).map(a=>{let[b,...c]=a.split(": ");return[b,c.join(": ")]})),{allowRangeRequests:d,suggestedLength:e}=eV({responseHeaders:c,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});d&&(this._isRangeSupported=!0),this._contentLength=e||this._contentLength,this._filename=eW(c),this._isRangeSupported&&this._manager.abortRequest(a),this._headersCapability.resolve()}_onDone(a){if(a){if(this._requests.length>0){let b=this._requests.shift();b.resolve({value:a.chunk,done:!1})}else this._cachedChunks.push(a.chunk)}if(this._done=!0,!(this._cachedChunks.length>0)){for(let c of this._requests)c.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(a){for(let b of(this._storedError=eX(a,this._url),this._headersCapability.reject(this._storedError),this._requests))b.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(a){this.onProgress?.({loaded:a.loaded,total:a.lengthComputable?a.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0){let a=this._cachedChunks.shift();return{value:a,done:!1}}if(this._done)return{value:void 0,done:!0};let b=Promise.withResolvers();return this._requests.push(b),b.promise}cancel(a){for(let b of(this._done=!0,this._headersCapability.reject(a),this._requests))b.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class e4{constructor(a,b,c){this._manager=a;let d={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=a.url,this._requestId=a.requestRange(b,c,d),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(a){let b=a.chunk;if(this._requests.length>0){let c=this._requests.shift();c.resolve({value:b,done:!1})}else this._queuedChunk=b;for(let d of(this._done=!0,this._requests))d.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(a){for(let b of(this._storedError=eX(a,this._url),this._requests))b.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(a){this.isStreamingSupported||this.onProgress?.({loaded:a.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){let a=this._queuedChunk;return this._queuedChunk=null,{value:a,done:!1}}if(this._done)return{value:void 0,done:!0};let b=Promise.withResolvers();return this._requests.push(b),b.promise}cancel(a){for(let b of(this._done=!0,this._requests))b.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}let e5=/^[a-z][a-z0-9\-+.]+:/i;function e6(a,b,c){if("http:"===a.protocol){let d=dO.get("http");return d.request(a,{headers:b},c)}let e=dO.get("https");return e.request(a,{headers:b},c)}class e7{constructor(a){this.source=a,this.url=function(a){if(e5.test(a))return new URL(a);let b=dO.get("url");return new URL(b.pathToFileURL(a))}(a.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.headers=eU(this.isHttp,a.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return z(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new fc(this):new fa(this),this._fullRequestReader}getRangeReader(a,b){if(b<=this._progressiveDataLength)return null;let c=this.isFsUrl?new fd(this,a,b):new fb(this,a,b);return this._rangeRequestReaders.push(c),c}cancelAllRequests(a){for(let b of(this._fullRequestReader?.cancel(a),this._rangeRequestReaders.slice(0)))b.cancel(a)}}class e8{constructor(a){this._url=a.url,this._done=!1,this._storedError=null,this.onProgress=null;let b=a.source;this._contentLength=b.length,this._loaded=0,this._filename=null,this._disableRange=b.disableRange||!1,this._rangeChunkSize=b.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!b.disableStream,this._isRangeSupported=!b.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let a=this._readableStream.read();if(null===a)return this._readCapability=Promise.withResolvers(),this.read();this._loaded+=a.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength});let b=new Uint8Array(a).buffer;return{value:b,done:!1}}cancel(a){if(!this._readableStream){this._error(a);return}this._readableStream.destroy(a)}_error(a){this._storedError=a,this._readCapability.resolve()}_setReadableStream(a){this._readableStream=a,a.on("readable",()=>{this._readCapability.resolve()}),a.on("end",()=>{a.destroy(),this._done=!0,this._readCapability.resolve()}),a.on("error",a=>{this._error(a)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new J("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class e9{constructor(a){this._url=a.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let b=a.source;this._isStreamingSupported=!b.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let a=this._readableStream.read();if(null===a)return this._readCapability=Promise.withResolvers(),this.read();this._loaded+=a.length,this.onProgress?.({loaded:this._loaded});let b=new Uint8Array(a).buffer;return{value:b,done:!1}}cancel(a){if(!this._readableStream){this._error(a);return}this._readableStream.destroy(a)}_error(a){this._storedError=a,this._readCapability.resolve()}_setReadableStream(a){this._readableStream=a,a.on("readable",()=>{this._readCapability.resolve()}),a.on("end",()=>{a.destroy(),this._done=!0,this._readCapability.resolve()}),a.on("error",a=>{this._error(a)}),this._storedError&&this._readableStream.destroy(this._storedError)}}class fa extends e8{constructor(a){super(a);let b=Object.fromEntries(a.headers),c=b=>{if(404===b.statusCode){let c=new G(`Missing PDF "${this._url}".`);this._storedError=c,this._headersCapability.reject(c);return}this._headersCapability.resolve(),this._setReadableStream(b);let d=new Headers(this._readableStream.headers),{allowRangeRequests:e,suggestedLength:f}=eV({responseHeaders:d,isHttp:a.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=e,this._contentLength=f||this._contentLength,this._filename=eW(d)};this._request=e6(this._url,b,c),this._request.on("error",a=>{this._storedError=a,this._headersCapability.reject(a)}),this._request.end()}}class fb extends e9{constructor(a,b,c){super(a);let d=Object.fromEntries(a.headers);d.Range=`bytes=${b}-${c-1}`;let e=a=>{if(404===a.statusCode){let b=new G(`Missing PDF "${this._url}".`);this._storedError=b;return}this._setReadableStream(a)};this._request=e6(this._url,d,e),this._request.on("error",a=>{this._storedError=a}),this._request.end()}}class fc extends e8{constructor(a){super(a);let b=dO.get("fs");b.promises.lstat(this._url).then(a=>{this._contentLength=a.size,this._setReadableStream(b.createReadStream(this._url)),this._headersCapability.resolve()},a=>{"ENOENT"===a.code&&(a=new G(`Missing PDF "${this._url}".`)),this._storedError=a,this._headersCapability.reject(a)})}}class fd extends e9{constructor(a,b,c){super(a);let d=dO.get("fs");this._setReadableStream(d.createReadStream(this._url,{start:b,end:c-1}))}}let fe=30;class ff{#bU=Promise.withResolvers();#am=null;#bV=!1;#bW=!!globalThis.FontInspector?.enabled;#bX=null;#bY=null;#bZ=0;#b$=0;#b_=null;#b0=null;#b1=0;#b2=0;#b3=Object.create(null);#b4=[];#b5=null;#b6=[];#b7=new WeakMap;#b8=null;static #b9=new Map;static #ca=new Map;static #cb=new WeakMap;static #cc=null;static #cd=new Set;constructor({textContentSource:a,container:b,viewport:c}){if(a instanceof ReadableStream)this.#b5=a;else if("object"==typeof a)this.#b5=new ReadableStream({start(b){b.enqueue(a),b.close()}});else throw Error('No "textContentSource" parameter specified.');this.#am=this.#b0=b,this.#b2=c.scale*(globalThis.devicePixelRatio||1),this.#b1=c.rotation,this.#bY={div:null,properties:null,ctx:null};let{pageWidth:d,pageHeight:e,pageX:f,pageY:g}=c.rawDims;this.#b8=[1,0,0,-1,-f,g+e],this.#b$=d,this.#bZ=e,ff.#ce(),aQ(b,c),this.#bU.promise.finally(()=>{ff.#cd.delete(this),this.#bY=null,this.#b3=null}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:a,isFirefox:b}=N.platform;return B(this,"fontFamilyMap",new Map([["sans-serif",`${a&&b?"Calibri, ":""}sans-serif`],["monospace",`${a&&b?"Lucida Console, ":""}monospace`]]))}render(){let a=()=>{this.#b_.read().then(({value:b,done:c})=>{if(c){this.#bU.resolve();return}this.#bX??=b.lang,Object.assign(this.#b3,b.styles),this.#cf(b.items),a()},this.#bU.reject)};return this.#b_=this.#b5.getReader(),ff.#cd.add(this),a(),this.#bU.promise}update({viewport:a,onBefore:b=null}){let c=a.scale*(globalThis.devicePixelRatio||1),d=a.rotation;if(d!==this.#b1&&(b?.(),this.#b1=d,aQ(this.#b0,{rotation:d})),c!==this.#b2){b?.(),this.#b2=c;let e={div:null,properties:null,ctx:ff.#cg(this.#bX)};for(let f of this.#b6)e.properties=this.#b7.get(f),e.div=f,this.#ch(e)}}cancel(){let a=new J("TextLayer task cancelled.");this.#b_?.cancel(a).catch(()=>{}),this.#b_=null,this.#bU.reject(a)}get textDivs(){return this.#b6}get textContentItemsStr(){return this.#b4} #cf(fg){if(this.#bV)return;this.#bY.ctx??=ff.#cg(this.#bX);let fh=this.#b6,fi=this.#b4;for(let fj of fg){if(fh.length>1e5){x("Ignoring additional textDivs for performance reasons."),this.#bV=!0;return}if(void 0===fj.str){if("beginMarkedContentProps"===fj.type||"beginMarkedContent"===fj.type){let fk=this.#am;this.#am=document.createElement("span"),this.#am.classList.add("markedContent"),null!==fj.id&&this.#am.setAttribute("id",`${fj.id}`),fk.append(this.#am)}else"endMarkedContent"===fj.type&&(this.#am=this.#am.parentNode);continue}fi.push(fj.str),this.#ci(fj)}} #ci(fl){let fm=document.createElement("span"),fn={angle:0,canvasWidth:0,hasText:""!==fl.str,hasEOL:fl.hasEOL,fontSize:0};this.#b6.push(fm);let fo=P.transform(this.#b8,fl.transform),fp=Math.atan2(fo[1],fo[0]),fq=this.#b3[fl.fontName];fq.vertical&&(fp+=Math.PI/2);let fr=this.#bW&&fq.fontSubstitution||fq.fontFamily;fr=ff.fontFamilyMap.get(fr)||fr;let fs=Math.hypot(fo[2],fo[3]),ft=fs*ff.#cj(fr,this.#bX),fu,fv;0===fp?(fu=fo[4],fv=fo[5]-ft):(fu=fo[4]+ft*Math.sin(fp),fv=fo[5]-ft*Math.cos(fp));let fw="calc(var(--scale-factor)*",fx=fm.style;this.#am===this.#b0?(fx.left=`${(100*fu/this.#b$).toFixed(2)}%`,fx.top=`${(100*fv/this.#bZ).toFixed(2)}%`):(fx.left=`${fw}${fu.toFixed(2)}px)`,fx.top=`${fw}${fv.toFixed(2)}px)`),fx.fontSize=`${fw}${(ff.#cc*fs).toFixed(2)}px)`,fx.fontFamily=fr,fn.fontSize=fs,fm.setAttribute("role","presentation"),fm.textContent=fl.str,fm.dir=fl.dir,this.#bW&&(fm.dataset.fontName=fq.fontSubstitutionLoadedName||fl.fontName),0!==fp&&(fn.angle=fp*(180/Math.PI));let fy=!1;if(fl.str.length>1)fy=!0;else if(" "!==fl.str&&fl.transform[0]!==fl.transform[3]){let fz=Math.abs(fl.transform[0]),fA=Math.abs(fl.transform[3]);fz!==fA&&Math.max(fz,fA)/Math.min(fz,fA)>1.5&&(fy=!0)}if(fy&&(fn.canvasWidth=fq.vertical?fl.height:fl.width),this.#b7.set(fm,fn),this.#bY.div=fm,this.#bY.properties=fn,this.#ch(this.#bY),fn.hasText&&this.#am.append(fm),fn.hasEOL){let fB=document.createElement("br");fB.setAttribute("role","presentation"),this.#am.append(fB)}} #ch(fC){let{div:fD,properties:fE,ctx:fF}=fC,{style:fG}=fD,fH="";if(ff.#cc>1&&(fH=`scale(${1/ff.#cc})`),0!==fE.canvasWidth&&fE.hasText){let{fontFamily:fI}=fG,{canvasWidth:fJ,fontSize:fK}=fE;ff.#ck(fF,fK*this.#b2,fI);let{width:fL}=fF.measureText(fD.textContent);fL>0&&(fH=`scaleX(${fJ*this.#b2/fL}) ${fH}`)}0!==fE.angle&&(fH=`rotate(${fE.angle}deg) ${fH}`),fH.length>0&&(fG.transform=fH)}static cleanup(){if(!(this.#cd.size>0)){for(let{canvas:a}of(this.#b9.clear(),this.#ca.values()))a.remove();this.#ca.clear()}}static  #cg(fM=null){let fN=this.#ca.get(fM||="");if(!fN){let fO=document.createElement("canvas");fO.className="hiddenCanvasElement",fO.lang=fM,document.body.append(fO),fN=fO.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#ca.set(fM,fN),this.#cb.set(fN,{size:0,family:""})}return fN}static  #ck(fP,fQ,fR){let fS=this.#cb.get(fP);(fQ!==fS.size||fR!==fS.family)&&(fP.font=`${fQ}px ${fR}`,fS.size=fQ,fS.family=fR)}static  #ce(){if(null!==this.#cc)return;let fT=document.createElement("div");fT.style.opacity=0,fT.style.lineHeight=1,fT.style.fontSize="1px",fT.style.position="absolute",fT.textContent="X",document.body.append(fT),this.#cc=fT.getBoundingClientRect().height,fT.remove()}static  #cj(fU,fV){let fW=this.#b9.get(fU);if(fW)return fW;let fX=this.#cg(fV);fX.canvas.width=fX.canvas.height=fe,this.#ck(fX,fe,fU);let fY=fX.measureText(""),fZ=fY.fontBoundingBoxAscent,f$=Math.abs(fY.fontBoundingBoxDescent);if(fZ){let f_=fZ/(fZ+f$);return this.#b9.set(fU,f_),fX.canvas.width=fX.canvas.height=0,f_}fX.strokeStyle="red",fX.clearRect(0,0,fe,fe),fX.strokeText("g",0,0);let f0=fX.getImageData(0,0,fe,fe).data;f$=0;for(let f1=f0.length-1-3;f1>=0;f1-=4)if(f0[f1]>0){f$=Math.ceil(f1/4/fe);break}fX.clearRect(0,0,fe,fe),fX.strokeText("A",0,fe),f0=fX.getImageData(0,0,fe,fe).data,fZ=0;for(let f2=0,f3=f0.length;f2<f3;f2+=4)if(f0[f2]>0){fZ=fe-Math.floor(f2/4/fe);break}fX.canvas.width=fX.canvas.height=0;let f4=fZ?fZ/(fZ+f$):.8;return this.#b9.set(fU,f4),f4}}class f5{static textContent(a){let b=[],c={items:b,styles:Object.create(null)};function d(a){if(!a)return;let c=null,e=a.name;if("#text"===e)c=a.value;else{if(!f5.shouldBuildText(e))return;a?.attributes?.textContent?c=a.attributes.textContent:a.value&&(c=a.value)}if(null!==c&&b.push({str:c}),a.children)for(let f of a.children)d(f)}return d(a),c}static shouldBuildText(a){return!("textarea"===a||"input"===a||"option"===a||"select"===a)}}let f6=g?class extends dF{_createCanvas(a,b){let c=dO.get("canvas");return c.createCanvas(a,b)}}:class extends dF{constructor({ownerDocument:a=globalThis.document,enableHWA:b=!1}){super({enableHWA:b}),this._document=a}_createCanvas(a,b){let c=this._document.createElement("canvas");return c.width=a,c.height=b,c}},f7=g?class extends dG{async _fetch(a){return dP(a)}}:dH,f8=g?class extends dI{}:class extends dI{#cl;#cm;#cn;#co;#cp;#cq;#u=0;constructor({docId:a,ownerDocument:b=globalThis.document}){super(),this.#co=a,this.#cp=b}get #v(){return this.#cm||=new Map}get #cr(){return this.#cq||=new Map}get #cs(){if(!this.#cn){let a=this.#cp.createElement("div"),{style:b}=a;b.visibility="hidden",b.contain="strict",b.width=b.height=0,b.position="absolute",b.top=b.left=0,b.zIndex=-1;let c=this.#cp.createElementNS(ay,"svg");c.setAttribute("width",0),c.setAttribute("height",0),this.#cn=this.#cp.createElementNS(ay,"defs"),a.append(c),c.append(this.#cn),this.#cp.body.append(a)}return this.#cn} #ct(d){if(1===d.length){let e=d[0],f=Array(256);for(let g=0;g<256;g++)f[g]=e[g]/255;let h=f.join(",");return[h,h,h]}let[i,j,k]=d,l=Array(256),m=Array(256),n=Array(256);for(let o=0;o<256;o++)l[o]=i[o]/255,m[o]=j[o]/255,n[o]=k[o]/255;return[l.join(","),m.join(","),n.join(",")]} #cu(p){if(void 0===this.#cl){this.#cl="";let q=this.#cp.URL;q!==this.#cp.baseURI&&(aD(q)?x('#createUrl: ignore "data:"-URL for performance reasons.'):this.#cl=q.split("#",1)[0])}return`url(${this.#cl}#${p})`}addFilter(a){if(!a)return"none";let b=this.#v.get(a);if(b)return b;let[c,d,e]=this.#ct(a),f=1===a.length?c:`${c}${d}${e}`;if(b=this.#v.get(f))return this.#v.set(a,b),b;let g=`g_${this.#co}_transfer_map_${this.#u++}`,h=this.#cu(g);this.#v.set(a,h),this.#v.set(f,h);let i=this.#cv(g);return this.#cw(c,d,e,i),h}addHCMFilter(a,b){let c=`${a}-${b}`,d="base",e=this.#cr.get(d);if(e?.key===c||(e?(e.filter?.remove(),e.key=c,e.url="none",e.filter=null):(e={key:c,url:"none",filter:null},this.#cr.set(d,e)),!a||!b))return e.url;let f=this.#cx(a);a=P.makeHexColor(...f);let g=this.#cx(b);if(b=P.makeHexColor(...g),this.#cs.style.color="","#000000"===a&&"#ffffff"===b||a===b)return e.url;let h=Array(256);for(let i=0;i<=255;i++){let j=i/255;h[i]=j<=.03928?j/12.92:((j+.055)/1.055)**2.4}let k=h.join(","),l=`g_${this.#co}_hcm_filter`,m=e.filter=this.#cv(l);this.#cw(k,k,k,m),this.#cy(m);let n=(a,b)=>{let c=f[a]/255,d=g[a]/255,e=Array(b+1);for(let h=0;h<=b;h++)e[h]=c+h/b*(d-c);return e.join(",")};return this.#cw(n(0,5),n(1,5),n(2,5),m),e.url=this.#cu(l),e.url}addAlphaFilter(a){let b=this.#v.get(a);if(b)return b;let[c]=this.#ct([a]),d=`alpha_${c}`;if(b=this.#v.get(d))return this.#v.set(a,b),b;let e=`g_${this.#co}_alpha_map_${this.#u++}`,f=this.#cu(e);this.#v.set(a,f),this.#v.set(d,f);let g=this.#cv(e);return this.#cz(c,g),f}addLuminosityFilter(a){let b=this.#v.get(a||"luminosity");if(b)return b;let c,d;if(a?([c]=this.#ct([a]),d=`luminosity_${c}`):d="luminosity",b=this.#v.get(d))return this.#v.set(a,b),b;let e=`g_${this.#co}_luminosity_map_${this.#u++}`,f=this.#cu(e);this.#v.set(a,f),this.#v.set(d,f);let g=this.#cv(e);return this.#cA(g),a&&this.#cz(c,g),f}addHighlightHCMFilter(a,b,c,d,e){let f=`${b}-${c}-${d}-${e}`,g=this.#cr.get(a);if(g?.key===f||(g?(g.filter?.remove(),g.key=f,g.url="none",g.filter=null):(g={key:f,url:"none",filter:null},this.#cr.set(a,g)),!b||!c))return g.url;let[h,i]=[b,c].map(this.#cx.bind(this)),j=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),k=Math.round(.2126*i[0]+.7152*i[1]+.0722*i[2]),[l,m]=[d,e].map(this.#cx.bind(this));k<j&&([j,k,l,m]=[k,j,m,l]),this.#cs.style.color="";let n=(a,b,c)=>{let d=Array(256),e=(k-j)/c,f=a/255,g=(b-a)/(255*c),h=0;for(let i=0;i<=c;i++){let l=Math.round(j+i*e),m=f+i*g;for(let n=h;n<=l;n++)d[n]=m;h=l+1}for(let o=h;o<256;o++)d[o]=d[h-1];return d.join(",")},o=`g_${this.#co}_hcm_${a}_filter`,p=g.filter=this.#cv(o);return this.#cy(p),this.#cw(n(l[0],m[0],5),n(l[1],m[1],5),n(l[2],m[2],5),p),g.url=this.#cu(o),g.url}destroy(a=!1){(!a||0===this.#cr.size)&&(this.#cn&&(this.#cn.parentNode.parentNode.remove(),this.#cn=null),this.#cm&&(this.#cm.clear(),this.#cm=null),this.#u=0)} #cA(r){let s=this.#cp.createElementNS(ay,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),r.append(s)} #cy(t){let u=this.#cp.createElementNS(ay,"feColorMatrix");u.setAttribute("type","matrix"),u.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(u)} #cv(v){let w=this.#cp.createElementNS(ay,"filter");return w.setAttribute("color-interpolation-filters","sRGB"),w.setAttribute("id",v),this.#cs.append(w),w} #cB(y,z,A){let B=this.#cp.createElementNS(ay,z);B.setAttribute("type","discrete"),B.setAttribute("tableValues",A),y.append(B)} #cw(C,D,E,F){let G=this.#cp.createElementNS(ay,"feComponentTransfer");F.append(G),this.#cB(G,"feFuncR",C),this.#cB(G,"feFuncG",D),this.#cB(G,"feFuncB",E)} #cz(H,I){let J=this.#cp.createElementNS(ay,"feComponentTransfer");I.append(J),this.#cB(J,"feFuncA",H)} #cx(K){return this.#cs.style.color=K,aN(getComputedStyle(this.#cs).getPropertyValue("color"))}},f9=g?class extends dJ{async _fetch(a){return dP(a)}}:dK;function ga(a={}){var b;"string"==typeof a||a instanceof URL?a={url:a}:(a instanceof ArrayBuffer||ArrayBuffer.isView(a))&&(a={data:a});let c=new ge,{docId:d}=c,e=a.url?gb(a.url):null,f=a.data?gc(a.data):null,h=a.httpHeaders||null,i=!0===a.withCredentials,j=a.password??null,k=a.range instanceof gf?a.range:null,l=Number.isInteger(a.rangeChunkSize)&&a.rangeChunkSize>0?a.rangeChunkSize:65536,m=a.worker instanceof gm?a.worker:null,n=a.verbosity,o="string"!=typeof a.docBaseUrl||aD(a.docBaseUrl)?null:a.docBaseUrl,p="string"==typeof a.cMapUrl?a.cMapUrl:null,q=!1!==a.cMapPacked,r=a.CMapReaderFactory||f7,s="string"==typeof a.standardFontDataUrl?a.standardFontDataUrl:null,t=a.StandardFontDataFactory||f9,u=!0!==a.stopAtErrors,w=Number.isInteger(a.maxImageSize)&&a.maxImageSize> -1?a.maxImageSize:-1,x=!1!==a.isEvalSupported,y="boolean"==typeof a.isOffscreenCanvasSupported?a.isOffscreenCanvasSupported:!g,z="boolean"==typeof a.isChrome?a.isChrome:!N.platform.isFirefox&&"undefined"!=typeof window&&!!window?.chrome,A=Number.isInteger(a.canvasMaxAreaInBytes)?a.canvasMaxAreaInBytes:-1,B="boolean"==typeof a.disableFontFace?a.disableFontFace:g,C=!0===a.fontExtraProperties,D=!0===a.enableXfa,E=a.ownerDocument||globalThis.document,F=!0===a.disableRange,G=!0===a.disableStream,H=!0===a.disableAutoFetch,I=!0===a.pdfBug,J=a.CanvasFactory||f6,K=a.FilterFactory||f8,L=!0===a.enableHWA,M=k?k.length:a.length??NaN,O="boolean"==typeof a.useSystemFonts?a.useSystemFonts:!g&&!B,P="boolean"==typeof a.useWorkerFetch?a.useWorkerFetch:r===dH&&t===dK&&p&&s&&aI(p,document.baseURI)&&aI(s,document.baseURI);a.canvasFactory&&aK("`canvasFactory`-instance option, please use `CanvasFactory` instead."),a.filterFactory&&aK("`filterFactory`-instance option, please use `FilterFactory` instead."),Number.isInteger(b=n)&&(v=b);let Q={canvasFactory:new J({ownerDocument:E,enableHWA:L}),filterFactory:new K({docId:d,ownerDocument:E}),cMapReaderFactory:P?null:new r({baseUrl:p,isCompressed:q}),standardFontDataFactory:P?null:new t({baseUrl:s})};if(!m){let R={verbosity:n,port:ee.workerPort};m=R.port?gm.fromPort(R):new gm(R),c._worker=m}let S={docId:d,apiVersion:"4.8.69",data:f,password:j,disableAutoFetch:H,rangeChunkSize:l,length:M,docBaseUrl:o,enableXfa:D,evaluatorOptions:{maxImageSize:w,disableFontFace:B,ignoreErrors:u,isEvalSupported:x,isOffscreenCanvasSupported:y,isChrome:z,canvasMaxAreaInBytes:A,fontExtraProperties:C,useSystemFonts:O,cMapUrl:P?p:null,standardFontDataUrl:P?s:null}},T={disableFontFace:B,fontExtraProperties:C,ownerDocument:E,pdfBug:I,styleElement:null,loadingParams:{disableAutoFetch:H,enableXfa:D}};return m.promise.then(function(){if(c.destroyed)throw Error("Loading aborted");if(m.destroyed)throw Error("Worker was destroyed");let a=m.messageHandler.sendWithPromise("GetDocRequest",S,f?[f.buffer]:null),b;if(k)b=new eR(k,{disableRange:F,disableStream:G});else if(!f){if(!e)throw Error("getDocument - no `url` parameter provided.");let j;if(g){let n="undefined"!=typeof fetch&&"undefined"!=typeof Response&&"body"in Response.prototype;j=n&&aI(e)?e_:e7}else j=aI(e)?e_:e2;b=new j({url:e,length:M,httpHeaders:h,withCredentials:i,rangeChunkSize:l,disableRange:F,disableStream:G})}return a.then(a=>{if(c.destroyed)throw Error("Loading aborted");if(m.destroyed)throw Error("Worker was destroyed");let e=new ei(d,a,m.port),f=new gn(e,c,b,T,Q);c._transport=f,e.send("Ready",null)})}).catch(c._capability.reject),c}function gb(a){if(a instanceof URL)return a.href;try{return new URL(a,window.location).href}catch{if(g&&"string"==typeof a)return a}throw Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function gc(a){if(g&& void 0!==e&&a instanceof e)throw Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength)return a;if("string"==typeof a)return L(a);if(a instanceof ArrayBuffer||ArrayBuffer.isView(a)||"object"==typeof a&&!isNaN(a?.length))return new Uint8Array(a);throw Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function gd(a){return"object"==typeof a&&Number.isInteger(a?.num)&&a.num>=0&&Number.isInteger(a?.gen)&&a.gen>=0}class ge{static #co=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${ge.#co++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(a){throw this._worker?.port&&delete this._worker._pendingDestroy,a}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}class gf{constructor(a,b,c=!1,d=null){this.length=a,this.initialData=b,this.progressiveDone=c,this.contentDispositionFilename=d,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(a){this._rangeListeners.push(a)}addProgressListener(a){this._progressListeners.push(a)}addProgressiveReadListener(a){this._progressiveReadListeners.push(a)}addProgressiveDoneListener(a){this._progressiveDoneListeners.push(a)}onDataRange(a,b){for(let c of this._rangeListeners)c(a,b)}onDataProgress(a,b){this._readyCapability.promise.then(()=>{for(let c of this._progressListeners)c(a,b)})}onDataProgressiveRead(a){this._readyCapability.promise.then(()=>{for(let b of this._progressiveReadListeners)b(a)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let a of this._progressiveDoneListeners)a()})}transportReady(){this._readyCapability.resolve()}requestDataRange(a,b){y("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class gg{constructor(a,b){this._pdfInfo=a,this._transport=b}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return B(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(a){return this._transport.getPage(a)}getPageIndex(a){return this._transport.getPageIndex(a)}getDestinations(){return this._transport.getDestinations()}getDestination(a){return this._transport.getDestination(a)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:a="display"}={}){let{renderingIntent:b}=this._transport.getRenderingIntent(a);return this._transport.getOptionalContentConfig(b)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(a=!1){return this._transport.startCleanup(a||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(a){return this._transport.cachedPageNumber(a)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class gh{#cC=null;#cD=!1;constructor(a,b,c,d=!1){this._pageIndex=a,this._pageInfo=b,this._transport=c,this._stats=d?new aH:null,this._pdfBug=d,this.commonObjs=c.commonObjs,this.objs=new gt,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:a,rotation:b=this.rotate,offsetX:c=0,offsetY:d=0,dontFlip:e=!1}={}){return new aB({viewBox:this.view,scale:a,rotation:b,offsetX:c,offsetY:d,dontFlip:e})}getAnnotations({intent:a="display"}={}){let{renderingIntent:b}=this._transport.getRenderingIntent(a);return this._transport.getAnnotations(this._pageIndex,b)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return B(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:a,viewport:b,intent:c="display",annotationMode:d=k.ENABLE,transform:e=null,background:f=null,optionalContentConfigPromise:g=null,annotationCanvasMap:h=null,pageColors:i=null,printAnnotationStorage:l=null,isEditing:m=!1}){this._stats?.time("Overall");let n=this._transport.getRenderingIntent(c,d,l,m),{renderingIntent:o,cacheKey:p}=n;this.#cD=!1,this.#cE(),g||=this._transport.getOptionalContentConfig(o);let q=this._intentStates.get(p);q||(q=Object.create(null),this._intentStates.set(p,q)),q.streamReaderCancelTimeout&&(clearTimeout(q.streamReaderCancelTimeout),q.streamReaderCancelTimeout=null);let r=!!(o&j.PRINT);q.displayReadyCapability||(q.displayReadyCapability=Promise.withResolvers(),q.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(n));let s=a=>{q.renderTasks.delete(t),(this._maybeCleanupAfterRender||r)&&(this.#cD=!0),this.#cF(!r),a?(t.capability.reject(a),this._abortOperatorList({intentState:q,reason:a instanceof Error?a:Error(a)})):t.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},t=new gv({callback:s,params:{canvasContext:a,viewport:b,transform:e,background:f},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:q.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!r,pdfBug:this._pdfBug,pageColors:i});(q.renderTasks||=new Set).add(t);let u=t.task;return Promise.all([q.displayReadyCapability.promise,g]).then(([a,b])=>{if(this.destroyed){s();return}if(this._stats?.time("Rendering"),!(b.renderingIntent&o))throw Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");t.initializeGraphics({transparency:a,optionalContentConfig:b}),t.operatorListChanged()}).catch(s),u}getOperatorList({intent:a="display",annotationMode:b=k.ENABLE,printAnnotationStorage:c=null,isEditing:d=!1}={}){let e=this._transport.getRenderingIntent(a,b,c,d,!0),f=this._intentStates.get(e.cacheKey);f||(f=Object.create(null),this._intentStates.set(e.cacheKey,f));let g;return f.opListReadCapability||((g=Object.create(null)).operatorListChanged=function(){f.operatorList.lastChunk&&(f.opListReadCapability.resolve(f.operatorList),f.renderTasks.delete(g))},f.opListReadCapability=Promise.withResolvers(),(f.renderTasks||=new Set).add(g),f.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(e)),f.opListReadCapability.promise}streamTextContent({includeMarkedContent:a=!1,disableNormalization:b=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===a,disableNormalization:!0===b},{highWaterMark:100,size:a=>a.items.length})}getTextContent(a={}){if(this._transport._htmlForXfa)return this.getXfa().then(a=>f5.textContent(a));let b=this.streamTextContent(a);return new Promise(function(a,c){function d(){e.read().then(function({value:b,done:c}){if(c){a(f);return}f.lang??=b.lang,Object.assign(f.styles,b.styles),f.items.push(...b.items),d()},c)}let e=b.getReader(),f={items:[],styles:Object.create(null),lang:null};d()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let a=[];for(let b of this._intentStates.values())if(this._abortOperatorList({intentState:b,reason:Error("Page was destroyed."),force:!0}),!b.opListReadCapability)for(let c of b.renderTasks)a.push(c.completed),c.cancel();return this.objs.clear(),this.#cD=!1,this.#cE(),Promise.all(a)}cleanup(a=!1){this.#cD=!0;let b=this.#cF(!1);return a&&b&&(this._stats&&=new aH),b} #cF(gi=!1){if(this.#cE(),!this.#cD||this.destroyed)return!1;if(gi)return this.#cC=setTimeout(()=>{this.#cC=null,this.#cF(!1)},5e3),!1;for(let{renderTasks:gj,operatorList:gk}of this._intentStates.values())if(gj.size>0||!gk.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#cD=!1,!0} #cE(){this.#cC&&(clearTimeout(this.#cC),this.#cC=null)}_startRenderPage(a,b){let c=this._intentStates.get(b);c&&(this._stats?.timeEnd("Page Request"),c.displayReadyCapability?.resolve(a))}_renderPageChunk(a,b){for(let c=0,d=a.length;c<d;c++)b.operatorList.fnArray.push(a.fnArray[c]),b.operatorList.argsArray.push(a.argsArray[c]);for(let e of(b.operatorList.lastChunk=a.lastChunk,b.operatorList.separateAnnots=a.separateAnnots,b.renderTasks))e.operatorListChanged();a.lastChunk&&this.#cF(!0)}_pumpOperatorList({renderingIntent:a,cacheKey:b,annotationStorageSerializable:c,modifiedIds:d}){let{map:e,transfer:f}=c,g=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:a,cacheKey:b,annotationStorage:e,modifiedIds:d},f),h=g.getReader(),i=this._intentStates.get(b);i.streamReader=h;let j=()=>{h.read().then(({value:a,done:b})=>{if(b){i.streamReader=null;return}!this._transport.destroyed&&(this._renderPageChunk(a,i),j())},a=>{if(i.streamReader=null,!this._transport.destroyed){if(i.operatorList){for(let b of(i.operatorList.lastChunk=!0,i.renderTasks))b.operatorListChanged();this.#cF(!0)}if(i.displayReadyCapability)i.displayReadyCapability.reject(a);else if(i.opListReadCapability)i.opListReadCapability.reject(a);else throw a}})};j()}_abortOperatorList({intentState:a,reason:b,force:c=!1}){if(a.streamReader){if(a.streamReaderCancelTimeout&&(clearTimeout(a.streamReaderCancelTimeout),a.streamReaderCancelTimeout=null),!c){if(a.renderTasks.size>0)return;if(b instanceof aC){let d=100;b.extraDelay>0&&b.extraDelay<1e3&&(d+=b.extraDelay),a.streamReaderCancelTimeout=setTimeout(()=>{a.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:a,reason:b,force:!0})},d);return}}if(a.streamReader.cancel(new J(b.message)).catch(()=>{}),a.streamReader=null,!this._transport.destroyed){for(let[e,f]of this._intentStates)if(f===a){this._intentStates.delete(e);break}this.cleanup()}}}get stats(){return this._stats}}class gl{#cG=new Map;#cH=Promise.resolve();postMessage(a,b){let c={data:structuredClone(a,b?{transfer:b}:null)};this.#cH.then(()=>{for(let[a]of this.#cG)a.call(this,c)})}addEventListener(a,b,c=null){let d=null;if(c?.signal instanceof AbortSignal){let{signal:e}=c;if(e.aborted){x("LoopbackPort - cannot use an `aborted` signal.");return}let f=()=>this.removeEventListener(a,b);d=()=>e.removeEventListener("abort",f),e.addEventListener("abort",f)}this.#cG.set(b,d)}removeEventListener(a,b){let c=this.#cG.get(b);c?.(),this.#cG.delete(b)}terminate(){for(let[,a]of this.#cG)a?.();this.#cG.clear()}}class gm{static #cI=0;static #cJ=!1;static #cK;static{g&&(this.#cJ=!0,ee.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(a,b)=>{let c;try{if(!(c=new URL(a)).origin||"null"===c.origin)return!1}catch{return!1}let d=new URL(b,c);return c.origin===d.origin},this._createCDNWrapper=a=>{let b=`await import("${a}");`;return URL.createObjectURL(new Blob([b],{type:"text/javascript"}))}}constructor({name:a=null,port:b=null,verbosity:c=v}={}){if(this.name=a,this.destroyed=!1,this.verbosity=c,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,b){if(gm.#cK?.has(b))throw Error("Cannot use more than one PDFWorker per port.");(gm.#cK||=new WeakMap).set(b,this),this._initializeFromPort(b);return}this._initialize()}get promise(){return g?Promise.all([dO.promise,this._readyCapability.promise]):this._readyCapability.promise} #cL(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(a){this._port=a,this._messageHandler=new ei("main","worker",a),this._messageHandler.on("ready",function(){}),this.#cL()}_initialize(){if(gm.#cJ||gm.#cM){this._setupFakeWorker();return}let{workerSrc:a}=gm;try{gm._isSameOrigin(window.location.href,a)||(a=gm._createCDNWrapper(new URL(a,window.location).href));let b=new Worker(a,{type:"module"}),c=new ei("main","worker",b),d=()=>{e.abort(),c.destroy(),b.terminate(),this.destroyed?this._readyCapability.reject(Error("Worker was destroyed")):this._setupFakeWorker()},e=new AbortController;b.addEventListener("error",()=>{this._webWorker||d()},{signal:e.signal}),c.on("test",a=>{if(e.abort(),this.destroyed||!a){d();return}this._messageHandler=c,this._port=b,this._webWorker=b,this.#cL()}),c.on("ready",a=>{if(e.abort(),this.destroyed){d();return}try{f()}catch{this._setupFakeWorker()}});let f=()=>{let a=new Uint8Array;c.send("test",a,[a.buffer])};f();return}catch{w("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){gm.#cJ||(x("Setting up fake worker."),gm.#cJ=!0),gm._setupFakeWorkerGlobal.then(a=>{if(this.destroyed){this._readyCapability.reject(Error("Worker was destroyed"));return}let b=new gl;this._port=b;let c=`fake${gm.#cI++}`,d=new ei(c+"_worker",c,b);a.setup(d,b),this._messageHandler=new ei(c,c+"_worker",b),this.#cL()}).catch(a=>{this._readyCapability.reject(Error(`Setting up fake worker failed: "${a.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),gm.#cK?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(a){if(!a?.port)throw Error("PDFWorker.fromPort - invalid method signature.");let b=this.#cK?.get(a.port);if(b){if(b._pendingDestroy)throw Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return b}return new gm(a)}static get workerSrc(){if(ee.workerSrc)return ee.workerSrc;throw Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get #cM(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){let a=async()=>{if(this.#cM)return this.#cM;let a=await import(this.workerSrc);return a.WorkerMessageHandler};return B(this,"_setupFakeWorkerGlobal",a())}}class gn{#cN=new Map;#cO=new Map;#cP=new Map;#cQ=new Map;#cR=null;constructor(a,b,c,d,e){this.messageHandler=a,this.loadingTask=b,this.commonObjs=new gt,this.fontLoader=new dD({ownerDocument:d.ownerDocument,styleElement:d.styleElement}),this.loadingParams=d.loadingParams,this._params=d,this.canvasFactory=e.canvasFactory,this.filterFactory=e.filterFactory,this.cMapReaderFactory=e.cMapReaderFactory,this.standardFontDataFactory=e.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=c,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()} #cS(go,gp=null){let gq=this.#cN.get(go);if(gq)return gq;let gr=this.messageHandler.sendWithPromise(go,gp);return this.#cN.set(go,gr),gr}get annotationStorage(){return B(this,"annotationStorage",new dB)}getRenderingIntent(a,b=k.ENABLE,c=null,d=!1,e=!1){let f=j.DISPLAY,g=dA;switch(a){case"any":f=j.ANY;break;case"display":break;case"print":f=j.PRINT;break;default:x(`getRenderingIntent - invalid intent: ${a}`)}let h=f&j.PRINT&&c instanceof dC?c:this.annotationStorage;switch(b){case k.DISABLE:f+=j.ANNOTATIONS_DISABLE;break;case k.ENABLE:break;case k.ENABLE_FORMS:f+=j.ANNOTATIONS_FORMS;break;case k.ENABLE_STORAGE:f+=j.ANNOTATIONS_STORAGE,g=h.serializable;break;default:x(`getRenderingIntent - invalid annotationMode: ${b}`)}d&&(f+=j.IS_EDITING),e&&(f+=j.OPLIST);let{ids:i,hash:l}=h.modifiedIds,m=[f,g.hash,l];return{renderingIntent:f,cacheKey:m.join("_"),annotationStorageSerializable:g,modifiedIds:i}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#cR?.reject(Error("Worker was destroyed during onPassword callback"));let a=[];for(let b of this.#cO.values())a.push(b._destroy());this.#cO.clear(),this.#cP.clear(),this.#cQ.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let c=this.messageHandler.sendWithPromise("Terminate",null);return a.push(c),Promise.all(a).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#cN.clear(),this.filterFactory.destroy(),ff.cleanup(),this._networkStream?.cancelAllRequests(new J("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:a,loadingTask:b}=this;a.on("GetReader",(a,b)=>{z(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=a=>{this._lastProgress={loaded:a.loaded,total:a.total}},b.onPull=()=>{this._fullReader.read().then(function({value:a,done:c}){if(c){b.close();return}z(a instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),b.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{b.error(a)})},b.onCancel=a=>{this._fullReader.cancel(a),b.ready.catch(a=>{if(!this.destroyed)throw a})}}),a.on("ReaderHeadersReady",async a=>{await this._fullReader.headersReady;let{isStreamingSupported:c,isRangeSupported:d,contentLength:e}=this._fullReader;return c&&d||(this._lastProgress&&b.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{b.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:c,isRangeSupported:d,contentLength:e}}),a.on("GetRangeReader",(a,b)=>{z(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let c=this._networkStream.getRangeReader(a.begin,a.end);if(!c){b.close();return}b.onPull=()=>{c.read().then(function({value:a,done:c}){if(c){b.close();return}z(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),b.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{b.error(a)})},b.onCancel=a=>{c.cancel(a),b.ready.catch(a=>{if(!this.destroyed)throw a})}}),a.on("GetDoc",({pdfInfo:a})=>{this._numPages=a.numPages,this._htmlForXfa=a.htmlForXfa,delete a.htmlForXfa,b._capability.resolve(new gg(a,this))}),a.on("DocException",function(a){let c;switch(a.name){case"PasswordException":c=new D(a.message,a.code);break;case"InvalidPDFException":c=new F(a.message);break;case"MissingPDFException":c=new G(a.message);break;case"UnexpectedResponseException":c=new H(a.message,a.status);break;case"UnknownErrorException":c=new E(a.message,a.details);break;default:y("DocException - expected a valid Error.")}b._capability.reject(c)}),a.on("PasswordRequest",a=>{if(this.#cR=Promise.withResolvers(),b.onPassword){let c=a=>{a instanceof Error?this.#cR.reject(a):this.#cR.resolve({password:a})};try{b.onPassword(c,a.code)}catch(d){this.#cR.reject(d)}}else this.#cR.reject(new D(a.message,a.code));return this.#cR.promise}),a.on("DataLoaded",a=>{b.onProgress?.({loaded:a.length,total:a.length}),this.downloadInfoCapability.resolve(a)}),a.on("StartRenderPage",a=>{if(this.destroyed)return;let b=this.#cO.get(a.pageIndex);b._startRenderPage(a.transparency,a.cacheKey)}),a.on("commonobj",([b,c,d])=>{if(this.destroyed||this.commonObjs.has(b))return null;switch(c){case"Font":let{disableFontFace:e,fontExtraProperties:f,pdfBug:g}=this._params;if("error"in d){let h=d.error;x(`Error during font loading: ${h}`),this.commonObjs.resolve(b,h);break}let i=g&&globalThis.FontInspector?.enabled?(a,b)=>globalThis.FontInspector.fontAdded(a,b):null,j=new dE(d,{disableFontFace:e,inspectFont:i});this.fontLoader.bind(j).catch(()=>a.sendWithPromise("FontFallback",{id:b})).finally(()=>{!f&&j.data&&(j.data=null),this.commonObjs.resolve(b,j)});break;case"CopyLocalImage":let{imageRef:k}=d;for(let l of(z(k,"The imageRef must be defined."),this.#cO.values()))for(let[,m]of l.objs)if(m?.ref===k){if(!m.dataLen)return null;return this.commonObjs.resolve(b,structuredClone(m)),m.dataLen}break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(b,d);break;default:throw Error(`Got unknown common object type ${c}`)}return null}),a.on("obj",([a,b,c,d])=>{if(this.destroyed)return;let e=this.#cO.get(b);if(!e.objs.has(a)){if(0===e._intentStates.size){d?.bitmap?.close();return}switch(c){case"Image":e.objs.resolve(a,d),d?.dataLen>1e7&&(e._maybeCleanupAfterRender=!0);break;case"Pattern":e.objs.resolve(a,d);break;default:throw Error(`Got unknown object type ${c}`)}}}),a.on("DocProgress",a=>{!this.destroyed&&b.onProgress?.({loaded:a.loaded,total:a.total})}),a.on("FetchBuiltInCMap",async a=>{if(this.destroyed)throw Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(a)}),a.on("FetchStandardFontData",async a=>{if(this.destroyed)throw Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(a)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&x("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:a,transfer:b}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:a,filename:this._fullReader?.filename??null},b).finally(()=>{this.annotationStorage.resetModified()})}getPage(a){if(!Number.isInteger(a)||a<=0||a>this._numPages)return Promise.reject(Error("Invalid page request."));let b=a-1,c=this.#cP.get(b);if(c)return c;let d=this.messageHandler.sendWithPromise("GetPage",{pageIndex:b}).then(c=>{if(this.destroyed)throw Error("Transport destroyed");c.refStr&&this.#cQ.set(c.refStr,a);let d=new gh(b,c,this,this._params.pdfBug);return this.#cO.set(b,d),d});return this.#cP.set(b,d),d}getPageIndex(a){return gd(a)?this.messageHandler.sendWithPromise("GetPageIndex",{num:a.num,gen:a.gen}):Promise.reject(Error("Invalid pageIndex request."))}getAnnotations(a,b){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:a,intent:b})}getFieldObjects(){return this.#cS("GetFieldObjects")}hasJSActions(){return this.#cS("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(a){return"string"!=typeof a?Promise.reject(Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:a})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#cS("GetDocJSActions")}getPageJSActions(a){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:a})}getStructTree(a){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:a})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(a){return this.#cS("GetOptionalContentConfig").then(b=>new eK(b,a))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let a="GetMetadata",b=this.#cN.get(a);if(b)return b;let c=this.messageHandler.sendWithPromise(a,null).then(a=>({info:a[0],metadata:a[1]?new eH(a[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#cN.set(a,c),c}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(a=!1){if(!this.destroyed){for(let b of(await this.messageHandler.sendWithPromise("Cleanup",null),this.#cO.values())){let c=b.cleanup();if(!c)throw Error(`startCleanup: Page ${b.pageNumber} is currently rendering.`)}this.commonObjs.clear(),a||this.fontLoader.clear(),this.#cN.clear(),this.filterFactory.destroy(!0),ff.cleanup()}}cachedPageNumber(a){if(!gd(a))return null;let b=0===a.gen?`${a.num}R`:`${a.num}R${a.gen}`;return this.#cQ.get(b)??null}}let gs=Symbol("INITIAL_DATA");class gt{#cT=Object.create(null); #cU(gu){return this.#cT[gu]||={...Promise.withResolvers(),data:gs}}get(a,b=null){if(b){let c=this.#cU(a);return c.promise.then(()=>b(c.data)),null}let d=this.#cT[a];if(!d||d.data===gs)throw Error(`Requesting object that isn't resolved yet ${a}.`);return d.data}has(a){let b=this.#cT[a];return!!b&&b.data!==gs}resolve(a,b=null){let c=this.#cU(a);c.data=b,c.resolve()}clear(){for(let a in this.#cT){let{data:b}=this.#cT[a];b?.bitmap?.close()}this.#cT=Object.create(null)}*[Symbol.iterator](){for(let a in this.#cT){let{data:b}=this.#cT[a];b!==gs&&(yield[a,b])}}}class gv{#cV=null;static #cW=new WeakSet;constructor({callback:a,params:b,objs:c,commonObjs:d,annotationCanvasMap:e,operatorList:f,pageIndex:g,canvasFactory:h,filterFactory:i,useRequestAnimationFrame:j=!1,pdfBug:k=!1,pageColors:l=null}){this.callback=a,this.params=b,this.objs=c,this.commonObjs=d,this.annotationCanvasMap=e,this.operatorListIdx=null,this.operatorList=f,this._pageIndex=g,this.canvasFactory=h,this.filterFactory=i,this._pdfBug=k,this.pageColors=l,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===j&&"undefined"!=typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new class{#cX=null;constructor(a){this.#cX=a,this.onContinue=null}get promise(){return this.#cX.capability.promise}cancel(a=0){this.#cX.cancel(null,a)}get separateAnnots(){let{separateAnnots:a}=this.#cX.operatorList;if(!a)return!1;let{annotationCanvasMap:b}=this.#cX;return a.form||a.canvas&&b?.size>0}}(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=b.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:a=!1,optionalContentConfig:b}){if(this.cancelled)return;if(this._canvas){if(gv.#cW.has(this._canvas))throw Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");gv.#cW.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:c,viewport:d,transform:e,background:f}=this.params;this.gfx=new ea(c,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:b},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:e,viewport:d,transparency:a,background:f}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(a=null,b=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#cV&&(window.cancelAnimationFrame(this.#cV),this.#cV=null),gv.#cW.delete(this._canvas),this.callback(a||new aC(`Rendering cancelled, page ${this._pageIndex+1}`,b))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#cV=window.requestAnimationFrame(()=>{this.#cV=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){!this.cancelled&&(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),gv.#cW.delete(this._canvas),this.callback())))}}let gw="4.8.69",gx="3634dab10";function gy(a){return Math.floor(255*Math.max(0,Math.min(1,a))).toString(16).padStart(2,"0")}function gz(a){return Math.max(0,Math.min(255,255*a))}class gA{static CMYK_G([a,b,c,d]){return["G",1-Math.min(1,.3*a+.59*c+.11*b+d)]}static G_CMYK([a]){return["CMYK",0,0,0,1-a]}static G_RGB([a]){return["RGB",a,a,a]}static G_rgb([a]){return[a=gz(a),a,a]}static G_HTML([a]){let b=gy(a);return`#${b}${b}${b}`}static RGB_G([a,b,c]){return["G",.3*a+.59*b+.11*c]}static RGB_rgb(a){return a.map(gz)}static RGB_HTML(a){return`#${a.map(gy).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([a,b,c,d]){return["RGB",1-Math.min(1,a+d),1-Math.min(1,c+d),1-Math.min(1,b+d)]}static CMYK_rgb([a,b,c,d]){return[gz(1-Math.min(1,a+d)),gz(1-Math.min(1,c+d)),gz(1-Math.min(1,b+d))]}static CMYK_HTML(a){let b=this.CMYK_RGB(a).slice(1);return this.RGB_HTML(b)}static RGB_CMYK([a,b,c]){let d=1-a,e=1-b,f=1-c;return["CMYK",d,e,f,Math.min(d,e,f)]}}class gB{create(a,b,c=!1){if(a<=0||b<=0)throw Error("Invalid SVG dimensions");let d=this._createSVG("svg:svg");return d.setAttribute("version","1.1"),c||(d.setAttribute("width",`${a}px`),d.setAttribute("height",`${b}px`)),d.setAttribute("preserveAspectRatio","none"),d.setAttribute("viewBox",`0 0 ${a} ${b}`),d}createElement(a){if("string"!=typeof a)throw Error("Invalid SVG element type");return this._createSVG(a)}_createSVG(a){y("Abstract method `_createSVG` called.")}}class gC extends gB{_createSVG(a){return document.createElementNS(ay,a)}}class gD{static setupStorage(a,b,c,d,e){let f=d.getValue(b,{value:null});switch(c.name){case"textarea":if(null!==f.value&&(a.textContent=f.value),"print"===e)break;a.addEventListener("input",a=>{d.setValue(b,{value:a.target.value})});break;case"input":if("radio"===c.attributes.type||"checkbox"===c.attributes.type){if(f.value===c.attributes.xfaOn?a.setAttribute("checked",!0):f.value===c.attributes.xfaOff&&a.removeAttribute("checked"),"print"===e)break;a.addEventListener("change",a=>{d.setValue(b,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(null!==f.value&&a.setAttribute("value",f.value),"print"===e)break;a.addEventListener("input",a=>{d.setValue(b,{value:a.target.value})})}break;case"select":if(null!==f.value)for(let g of(a.setAttribute("value",f.value),c.children))g.attributes.value===f.value?g.attributes.selected=!0:g.attributes.hasOwnProperty("selected")&&delete g.attributes.selected;a.addEventListener("input",a=>{let c=a.target.options,e=-1===c.selectedIndex?"":c[c.selectedIndex].value;d.setValue(b,{value:e})})}}static setAttributes({html:a,element:b,storage:c=null,intent:d,linkService:e}){let{attributes:f}=b,g=a instanceof HTMLAnchorElement;for(let[h,i]of("radio"===f.type&&(f.name=`${f.name}-${d}`),Object.entries(f)))if(null!=i)switch(h){case"class":i.length&&a.setAttribute(h,i.join(" "));break;case"dataId":break;case"id":a.setAttribute("data-element-id",i);break;case"style":Object.assign(a.style,i);break;case"textContent":a.textContent=i;break;default:g&&("href"===h||"newWindow"===h)||a.setAttribute(h,i)}g&&e.addLinkAttributes(a,f.href,f.newWindow),c&&f.dataId&&this.setupStorage(a,f.dataId,b,c)}static render(a){let b=a.annotationStorage,c=a.linkService,d=a.xfaHtml,e=a.intent||"display",f=document.createElement(d.name);d.attributes&&this.setAttributes({html:f,element:d,intent:e,linkService:c});let g="richText"!==e,h=a.div;if(h.append(f),a.viewport){let i=`matrix(${a.viewport.transform.join(",")})`;h.style.transform=i}g&&h.setAttribute("class","xfaLayer xfaFont");let j=[];if(0===d.children.length){if(d.value){let k=document.createTextNode(d.value);f.append(k),g&&f5.shouldBuildText(d.name)&&j.push(k)}return{textDivs:j}}let l=[[d,-1,f]];for(;l.length>0;){let[m,n,o]=l.at(-1);if(n+1===m.children.length){l.pop();continue}let p=m.children[++l.at(-1)[1]];if(null===p)continue;let{name:q}=p;if("#text"===q){let r=document.createTextNode(p.value);j.push(r),o.append(r);continue}let s=p?.attributes?.xmlns?document.createElementNS(p.attributes.xmlns,q):document.createElement(q);if(o.append(s),p.attributes&&this.setAttributes({html:s,element:p,storage:b,intent:e,linkService:c}),p.children?.length>0)l.push([p,-1,s]);else if(p.value){let t=document.createTextNode(p.value);g&&f5.shouldBuildText(q)&&j.push(t),s.append(t)}}for(let u of h.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))u.setAttribute("readOnly",!0);return{textDivs:j}}static update(a){let b=`matrix(${a.viewport.transform.join(",")})`;a.div.style.transform=b,a.div.hidden=!1}}let gE=new WeakSet;function gF(a){return{width:a[2]-a[0],height:a[3]-a[1]}}class gG{static create(a){let b=a.data.annotationType;switch(b){case q.LINK:return new gS(a);case q.TEXT:return new gY(a);case q.WIDGET:let c=a.data.fieldType;switch(c){case"Tx":return new g$(a);case"Btn":if(a.data.radioButton)return new g1(a);if(a.data.checkBox)return new g0(a);return new g2(a);case"Ch":return new g3(a);case"Sig":return new g_(a)}return new gZ(a);case q.POPUP:return new g4(a);case q.FREETEXT:return new hq(a);case q.LINE:return new hr(a);case q.SQUARE:return new hs(a);case q.CIRCLE:return new ht(a);case q.POLYLINE:return new hu(a);case q.CARET:return new hw(a);case q.INK:return new hx(a);case q.POLYGON:return new hv(a);case q.HIGHLIGHT:return new hy(a);case q.UNDERLINE:return new hz(a);case q.SQUIGGLY:return new hA(a);case q.STRIKEOUT:return new hB(a);case q.STAMP:return new hC(a);case q.FILEATTACHMENT:return new hD(a);default:return new gH(a)}}}class gH{#cY=null;#cZ=!1;#c$=null;constructor(a,{isRenderable:b=!1,ignoreBorder:c=!1,createQuadrilaterals:d=!1}={}){this.isRenderable=b,this.data=a.data,this.layer=a.layer,this.linkService=a.linkService,this.downloadManager=a.downloadManager,this.imageResourcesPath=a.imageResourcesPath,this.renderForms=a.renderForms,this.svgFactory=a.svgFactory,this.annotationStorage=a.annotationStorage,this.enableScripting=a.enableScripting,this.hasJSActions=a.hasJSActions,this._fieldObjects=a.fieldObjects,this.parent=a.parent,b&&(this.container=this._createContainer(c)),d&&this._createQuadrilaterals()}static _hasPopupData({titleObj:a,contentsObj:b,richText:c}){return!!(a?.str||b?.str||c?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return gH._hasPopupData(this.data)}updateEdited(a){if(!this.container)return;this.#cY||={rect:this.data.rect.slice(0)};let{rect:b}=a;b&&this.#c_(b),this.#c$?.popup.updateEdited(a)}resetEdited(){this.#cY&&(this.#c_(this.#cY.rect),this.#c$?.popup.resetEdited(),this.#cY=null)} #c_(gI){let{container:{style:gJ},data:{rect:gK,rotation:gL},parent:{viewport:{rawDims:{pageWidth:gM,pageHeight:gN,pageX:gO,pageY:gP}}}}=this;gK?.splice(0,4,...gI);let{width:gQ,height:gR}=gF(gI);gJ.left=`${100*(gI[0]-gO)/gM}%`,gJ.top=`${100*(gN-gI[3]+gP)/gN}%`,0===gL?(gJ.width=`${100*gQ/gM}%`,gJ.height=`${100*gR/gN}%`):this.setRotation(gL)}_createContainer(a){let{data:b,parent:{page:c,viewport:d}}=this,e=document.createElement("section");e.setAttribute("data-annotation-id",b.id),this instanceof gZ||(e.tabIndex=1e3);let{style:f}=e;if(f.zIndex=this.parent.zIndex++,b.alternativeText&&(e.title=b.alternativeText),b.noRotate&&e.classList.add("norotate"),!b.rect||this instanceof g4){let{rotation:g}=b;return b.hasOwnCanvas||0===g||this.setRotation(g,e),e}let{width:h,height:i}=gF(b.rect);if(!a&&b.borderStyle.width>0){f.borderWidth=`${b.borderStyle.width}px`;let j=b.borderStyle.horizontalCornerRadius,k=b.borderStyle.verticalCornerRadius;if(j>0||k>0){let l=`calc(${j}px * var(--scale-factor)) / calc(${k}px * var(--scale-factor))`;f.borderRadius=l}else if(this instanceof g1){let m=`calc(${h}px * var(--scale-factor)) / calc(${i}px * var(--scale-factor))`;f.borderRadius=m}switch(b.borderStyle.style){case r.SOLID:f.borderStyle="solid";break;case r.DASHED:f.borderStyle="dashed";break;case r.BEVELED:x("Unimplemented border style: beveled");break;case r.INSET:x("Unimplemented border style: inset");break;case r.UNDERLINE:f.borderBottomStyle="solid"}let n=b.borderColor||null;n?(this.#cZ=!0,f.borderColor=P.makeHexColor(0|n[0],0|n[1],0|n[2])):f.borderWidth=0}let o=P.normalizeRect([b.rect[0],c.view[3]-b.rect[1]+c.view[1],b.rect[2],c.view[3]-b.rect[3]+c.view[1]]),{pageWidth:p,pageHeight:q,pageX:s,pageY:t}=d.rawDims;f.left=`${100*(o[0]-s)/p}%`,f.top=`${100*(o[1]-t)/q}%`;let{rotation:u}=b;return b.hasOwnCanvas||0===u?(f.width=`${100*h/p}%`,f.height=`${100*i/q}%`):this.setRotation(u,e),e}setRotation(a,b=this.container){if(!this.data.rect)return;let{pageWidth:c,pageHeight:d}=this.parent.viewport.rawDims,{width:e,height:f}=gF(this.data.rect),g,h;a%180==0?(g=100*e/c,h=100*f/d):(g=100*f/c,h=100*e/d),b.style.width=`${g}%`,b.style.height=`${h}%`,b.setAttribute("data-main-rotation",(360-a)%360)}get _commonActions(){let a=(a,b,c)=>{let d=c.detail[a],e=d[0],f=d.slice(1);c.target.style[b]=gA[`${e}_HTML`](f),this.annotationStorage.setValue(this.data.id,{[b]:gA[`${e}_rgb`](f)})};return B(this,"_commonActions",{display:a=>{let{display:b}=a.detail,c=b%2==1;this.container.style.visibility=c?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:c,noPrint:1===b||2===b})},print:a=>{this.annotationStorage.setValue(this.data.id,{noPrint:!a.detail.print})},hidden:a=>{let{hidden:b}=a.detail;this.container.style.visibility=b?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:b,noView:b})},focus(a){setTimeout(()=>a.target.focus({preventScroll:!1}),0)},userName(a){a.target.title=a.detail.userName},readonly(a){a.target.disabled=a.detail.readonly},required:a=>{this._setRequired(a.target,a.detail.required)},bgColor(b){a("bgColor","backgroundColor",b)},fillColor(b){a("fillColor","backgroundColor",b)},fgColor(b){a("fgColor","color",b)},textColor(b){a("textColor","color",b)},borderColor(b){a("borderColor","borderColor",b)},strokeColor(b){a("strokeColor","borderColor",b)},rotation:a=>{let b=a.detail.rotation;this.setRotation(b),this.annotationStorage.setValue(this.data.id,{rotation:b})}})}_dispatchEventFromSandbox(a,b){let c=this._commonActions;for(let d of Object.keys(b.detail)){let e=a[d]||c[d];e?.(b)}}_setDefaultPropertiesFromJS(a){if(!this.enableScripting)return;let b=this.annotationStorage.getRawValue(this.data.id);if(!b)return;let c=this._commonActions;for(let[d,e]of Object.entries(b)){let f=c[d];if(f){let g={detail:{[d]:e},target:a};f(g),delete b[d]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:a}=this.data;if(!a)return;let[b,c,d,e]=this.data.rect.map(a=>Math.fround(a));if(8===a.length){let[f,g,h,i]=a.subarray(2,6);if(d===f&&e===g&&b===h&&c===i)return}let{style:j}=this.container,k;if(this.#cZ){let{borderColor:l,borderWidth:m}=j;j.borderWidth=0,k=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${l}" stroke-width="${m}">`],this.container.classList.add("hasBorder")}let n=d-b,o=e-c,{svgFactory:p}=this,q=p.createElement("svg");q.classList.add("quadrilateralsContainer"),q.setAttribute("width",0),q.setAttribute("height",0);let r=p.createElement("defs");q.append(r);let s=p.createElement("clipPath"),t=`clippath_${this.data.id}`;s.setAttribute("id",t),s.setAttribute("clipPathUnits","objectBoundingBox"),r.append(s);for(let u=2,v=a.length;u<v;u+=8){let w=a[u],x=a[u+1],y=a[u+2],z=a[u+3],A=p.createElement("rect"),B=(y-b)/n,C=(e-x)/o,D=(w-y)/n,E=(x-z)/o;A.setAttribute("x",B),A.setAttribute("y",C),A.setAttribute("width",D),A.setAttribute("height",E),s.append(A),k?.push(`<rect vector-effect="non-scaling-stroke" x="${B}" y="${C}" width="${D}" height="${E}"/>`)}this.#cZ&&(k.push("</g></svg>')"),j.backgroundImage=k.join("")),this.container.append(q),this.container.style.clipPath=`url(#${t})`}_createPopup(){let{data:a}=this,b=this.#c$=new g4({data:{color:a.color,titleObj:a.titleObj,modificationDate:a.modificationDate,contentsObj:a.contentsObj,richText:a.richText,parentRect:a.rect,borderStyle:0,id:`popup_${a.id}`,rotation:a.rotation},parent:this.parent,elements:[this]});this.parent.div.append(b.render())}render(){y("Abstract method `AnnotationElement.render` called")}_getElementsByName(a,b=null){let c=[];if(this._fieldObjects){let d=this._fieldObjects[a];if(d)for(let{page:e,id:f,exportValues:g}of d){if(-1===e||f===b)continue;let h="string"==typeof g?g:null,i=document.querySelector(`[data-element-id="${f}"]`);if(i&&!gE.has(i)){x(`_getElementsByName - element not allowed: ${f}`);continue}c.push({id:f,exportValue:h,domElement:i})}return c}for(let j of document.getElementsByName(a)){let{exportValue:k}=j,l=j.getAttribute("data-element-id");l!==b&&gE.has(j)&&c.push({id:l,exportValue:k,domElement:j})}return c}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let a=this.getElementsToTriggerPopup();if(Array.isArray(a))for(let b of a)b.classList.add("highlightArea");else a.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:a,data:{id:b}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:a,editId:b})})}}class gS extends gH{constructor(a,b=null){super(a,{isRenderable:!0,ignoreBorder:!!b?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=a.data.isTooltipOnly}render(){let{data:a,linkService:b}=this,c=document.createElement("a");c.setAttribute("data-element-id",a.id);let d=!1;return a.url?(b.addLinkAttributes(c,a.url,a.newWindow),d=!0):a.action?(this._bindNamedAction(c,a.action),d=!0):a.attachment?(this.#c0(c,a.attachment,a.attachmentDest),d=!0):a.setOCGState?(this.#c1(c,a.setOCGState),d=!0):a.dest?(this._bindLink(c,a.dest),d=!0):(a.actions&&(a.actions.Action||a.actions["Mouse Up"]||a.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(c,a),d=!0),a.resetForm?(this._bindResetFormAction(c,a.resetForm),d=!0):this.isTooltipOnly&&!d&&(this._bindLink(c,""),d=!0)),this.container.classList.add("linkAnnotation"),d&&this.container.append(c),this.container} #c2(){this.container.setAttribute("data-internal-link","")}_bindLink(a,b){a.href=this.linkService.getDestinationHash(b),a.onclick=()=>(b&&this.linkService.goToDestination(b),!1),(b||""===b)&&this.#c2()}_bindNamedAction(a,b){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeNamedAction(b),!1),this.#c2()} #c0(gT,gU,gV=null){gT.href=this.linkService.getAnchorUrl(""),gU.description&&(gT.title=gU.description),gT.onclick=()=>(this.downloadManager?.openOrDownloadData(gU.content,gU.filename,gV),!1),this.#c2()} #c1(gW,gX){gW.href=this.linkService.getAnchorUrl(""),gW.onclick=()=>(this.linkService.executeSetOCGState(gX),!1),this.#c2()}_bindJSAction(a,b){a.href=this.linkService.getAnchorUrl("");let c=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let d of Object.keys(b.actions)){let e=c.get(d);e&&(a[e]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b.id,name:d}}),!1))}a.onclick||(a.onclick=()=>!1),this.#c2()}_bindResetFormAction(a,b){let c=a.onclick;if(c||(a.href=this.linkService.getAnchorUrl("")),this.#c2(),!this._fieldObjects){x('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),c||(a.onclick=()=>!1);return}a.onclick=()=>{c?.();let{fields:a,refs:d,include:e}=b,f=[];if(0!==a.length||0!==d.length){let g=new Set(d);for(let h of a){let i=this._fieldObjects[h]||[];for(let{id:j}of i)g.add(j)}for(let k of Object.values(this._fieldObjects))for(let l of k)g.has(l.id)===e&&f.push(l)}else for(let m of Object.values(this._fieldObjects))f.push(...m);let n=this.annotationStorage,o=[];for(let p of f){let{id:q}=p;switch(o.push(q),p.type){case"text":{let r=p.defaultValue||"";n.setValue(q,{value:r});break}case"checkbox":case"radiobutton":{let s=p.defaultValue===p.exportValues;n.setValue(q,{value:s});break}case"combobox":case"listbox":{let t=p.defaultValue||"";n.setValue(q,{value:t});break}default:continue}let u=document.querySelector(`[data-element-id="${q}"]`);if(u){if(!gE.has(u)){x(`_bindResetFormAction - element not allowed: ${q}`);continue}u.dispatchEvent(new Event("resetform"))}}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:o,name:"ResetForm"}}),!1}}}class gY extends gH{constructor(a){super(a,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let a=document.createElement("img");return a.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",a.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),a.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(a),this.container}}class gZ extends gH{render(){return this.container}showElementAndHideCanvas(a){this.data.hasOwnCanvas&&(a.previousSibling?.nodeName==="CANVAS"&&(a.previousSibling.hidden=!0),a.hidden=!1)}_getKeyModifier(a){return N.platform.isMac?a.metaKey:a.ctrlKey}_setEventListener(a,b,c,d,e){c.includes("mouse")?a.addEventListener(c,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:d,value:e(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):a.addEventListener(c,a=>{if("blur"===c){if(!b.focused||!a.relatedTarget)return;b.focused=!1}else if("focus"===c){if(b.focused)return;b.focused=!0}e&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:d,value:e(a)}})})}_setEventListeners(a,b,c,d){for(let[e,f]of c)("Action"===f||this.data.actions?.[f])&&(("Focus"===f||"Blur"===f)&&(b||={focused:!1}),this._setEventListener(a,b,e,f,d),"Focus"!==f||this.data.actions?.Blur?"Blur"!==f||this.data.actions?.Focus||this._setEventListener(a,b,"focus","Focus",null):this._setEventListener(a,b,"blur","Blur",null))}_setBackgroundColor(a){let b=this.data.backgroundColor||null;a.style.backgroundColor=null===b?"transparent":P.makeHexColor(b[0],b[1],b[2])}_setTextStyle(a){let{fontColor:b}=this.data.defaultAppearanceData,c=this.data.defaultAppearanceData.fontSize||9,d=a.style,e,f=a=>Math.round(10*a)/10;if(this.data.multiLine){let g=Math.abs(this.data.rect[3]-this.data.rect[1]-2),h=Math.round(g/(1.35*c))||1,i=g/h;e=Math.min(c,f(i/1.35))}else{let j=Math.abs(this.data.rect[3]-this.data.rect[1]-2);e=Math.min(c,f(j/1.35))}d.fontSize=`calc(${e}px * var(--scale-factor))`,d.color=P.makeHexColor(b[0],b[1],b[2]),null!==this.data.textAlignment&&(d.textAlign=["left","center","right"][this.data.textAlignment])}_setRequired(a,b){b?a.setAttribute("required",!0):a.removeAttribute("required"),a.setAttribute("aria-required",b)}}class g$ extends gZ{constructor(a){let b=a.renderForms||a.data.hasOwnCanvas|| !a.data.hasAppearance&&!!a.data.fieldValue;super(a,{isRenderable:b})}setPropertyOnSiblings(a,b,c,d){let e=this.annotationStorage;for(let f of this._getElementsByName(a.name,a.id))f.domElement&&(f.domElement[b]=c),e.setValue(f.id,{[d]:c})}render(){let a=this.annotationStorage,b=this.data.id;this.container.classList.add("textWidgetAnnotation");let c=null;if(this.renderForms){let d=a.getValue(b,{value:this.data.fieldValue}),e=d.value||"",f=a.getValue(b,{charLimit:this.data.maxLen}).charLimit;f&&e.length>f&&(e=e.slice(0,f));let g=d.formattedValue||this.data.textContent?.join("\n")||null;g&&this.data.comb&&(g=g.replaceAll(/\s+/g,""));let h={userValue:e,formattedValue:g,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?((c=document.createElement("textarea")).textContent=g??e,this.data.doNotScroll&&(c.style.overflowY="hidden")):((c=document.createElement("input")).type="text",c.setAttribute("value",g??e),this.data.doNotScroll&&(c.style.overflowX="hidden")),this.data.hasOwnCanvas&&(c.hidden=!0),gE.add(c),c.setAttribute("data-element-id",b),c.disabled=this.data.readOnly,c.name=this.data.fieldName,c.tabIndex=1e3,this._setRequired(c,this.data.required),f&&(c.maxLength=f),c.addEventListener("input",d=>{a.setValue(b,{value:d.target.value}),this.setPropertyOnSiblings(c,"value",d.target.value,"value"),h.formattedValue=null}),c.addEventListener("resetform",a=>{let b=this.data.defaultFieldValue??"";c.value=h.userValue=b,h.formattedValue=null});let i=a=>{let{formattedValue:b}=h;null!=b&&(a.target.value=b),a.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){c.addEventListener("focus",a=>{if(h.focused)return;let{target:b}=a;h.userValue&&(b.value=h.userValue),h.lastCommittedValue=b.value,h.commitKey=1,this.data.actions?.Focus||(h.focused=!0)}),c.addEventListener("updatefromsandbox",c=>{this.showElementAndHideCanvas(c.target);let d={value(c){h.userValue=c.detail.value??"",a.setValue(b,{value:h.userValue.toString()}),c.target.value=h.userValue},formattedValue(c){let{formattedValue:d}=c.detail;h.formattedValue=d,null!=d&&c.target!==document.activeElement&&(c.target.value=d),a.setValue(b,{formattedValue:d})},selRange(a){a.target.setSelectionRange(...a.detail.selRange)},charLimit:c=>{let{charLimit:d}=c.detail,{target:e}=c;if(0===d){e.removeAttribute("maxLength");return}e.setAttribute("maxLength",d);let f=h.userValue;f&&!(f.length<=d)&&(f=f.slice(0,d),e.value=h.userValue=f,a.setValue(b,{value:f}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:f,willCommit:!0,commitKey:1,selStart:e.selectionStart,selEnd:e.selectionEnd}}))}};this._dispatchEventFromSandbox(d,c)}),c.addEventListener("keydown",a=>{h.commitKey=1;let c=-1;if("Escape"===a.key?c=0:"Enter"!==a.key||this.data.multiLine?"Tab"===a.key&&(h.commitKey=3):c=2,-1===c)return;let{value:d}=a.target;h.lastCommittedValue!==d&&(h.lastCommittedValue=d,h.userValue=d,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:d,willCommit:!0,commitKey:c,selStart:a.target.selectionStart,selEnd:a.target.selectionEnd}}))});let j=i;i=null,c.addEventListener("blur",a=>{if(!h.focused||!a.relatedTarget)return;this.data.actions?.Blur||(h.focused=!1);let{value:c}=a.target;h.userValue=c,h.lastCommittedValue!==c&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:c,willCommit:!0,commitKey:h.commitKey,selStart:a.target.selectionStart,selEnd:a.target.selectionEnd}}),j(a)}),this.data.actions?.Keystroke&&c.addEventListener("beforeinput",a=>{h.lastCommittedValue=null;let{data:c,target:d}=a,{value:e,selectionStart:f,selectionEnd:g}=d,i=f,j=g;switch(a.inputType){case"deleteWordBackward":{let k=e.substring(0,f).match(/\w*[^\w]*$/);k&&(i-=k[0].length);break}case"deleteWordForward":{let l=e.substring(f).match(/^[^\w]*\w*/);l&&(j+=l[0].length);break}case"deleteContentBackward":f===g&&(i-=1);break;case"deleteContentForward":f===g&&(j+=1)}a.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:e,change:c||"",willCommit:!1,selStart:i,selEnd:j}})}),this._setEventListeners(c,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.value)}if(i&&c.addEventListener("blur",i),this.data.comb){let k=this.data.rect[2]-this.data.rect[0],l=k/f;c.classList.add("comb"),c.style.letterSpacing=`calc(${l}px * var(--scale-factor) - 1ch)`}}else(c=document.createElement("div")).textContent=this.data.fieldValue,c.style.verticalAlign="middle",c.style.display="table-cell",this.data.hasOwnCanvas&&(c.hidden=!0);return this._setTextStyle(c),this._setBackgroundColor(c),this._setDefaultPropertiesFromJS(c),this.container.append(c),this.container}}class g_ extends gZ{constructor(a){super(a,{isRenderable:!!a.data.hasOwnCanvas})}}class g0 extends gZ{constructor(a){super(a,{isRenderable:a.renderForms})}render(){let a=this.annotationStorage,b=this.data,c=b.id,d=a.getValue(c,{value:b.exportValue===b.fieldValue}).value;"string"==typeof d&&(d="Off"!==d,a.setValue(c,{value:d})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let e=document.createElement("input");return gE.add(e),e.setAttribute("data-element-id",c),e.disabled=b.readOnly,this._setRequired(e,this.data.required),e.type="checkbox",e.name=b.fieldName,d&&e.setAttribute("checked",!0),e.setAttribute("exportValue",b.exportValue),e.tabIndex=1e3,e.addEventListener("change",d=>{let{name:e,checked:f}=d.target;for(let g of this._getElementsByName(e,c)){let h=f&&g.exportValue===b.exportValue;g.domElement&&(g.domElement.checked=h),a.setValue(g.id,{value:h})}a.setValue(c,{value:f})}),e.addEventListener("resetform",a=>{let c=b.defaultFieldValue||"Off";a.target.checked=c===b.exportValue}),this.enableScripting&&this.hasJSActions&&(e.addEventListener("updatefromsandbox",b=>{let d={value(b){b.target.checked="Off"!==b.detail.value,a.setValue(c,{value:b.target.checked})}};this._dispatchEventFromSandbox(d,b)}),this._setEventListeners(e,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(e),this._setDefaultPropertiesFromJS(e),this.container.append(e),this.container}}class g1 extends gZ{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let a=this.annotationStorage,b=this.data,c=b.id,d=a.getValue(c,{value:b.fieldValue===b.buttonValue}).value;if("string"==typeof d&&(d=d!==b.buttonValue,a.setValue(c,{value:d})),d)for(let e of this._getElementsByName(b.fieldName,c))a.setValue(e.id,{value:!1});let f=document.createElement("input");if(gE.add(f),f.setAttribute("data-element-id",c),f.disabled=b.readOnly,this._setRequired(f,this.data.required),f.type="radio",f.name=b.fieldName,d&&f.setAttribute("checked",!0),f.tabIndex=1e3,f.addEventListener("change",b=>{let{name:d,checked:e}=b.target;for(let f of this._getElementsByName(d,c))a.setValue(f.id,{value:!1});a.setValue(c,{value:e})}),f.addEventListener("resetform",a=>{let c=b.defaultFieldValue;a.target.checked=null!=c&&c===b.buttonValue}),this.enableScripting&&this.hasJSActions){let g=b.buttonValue;f.addEventListener("updatefromsandbox",b=>{let d={value:b=>{let d=g===b.detail.value;for(let e of this._getElementsByName(b.target.name)){let f=d&&e.id===c;e.domElement&&(e.domElement.checked=f),a.setValue(e.id,{value:f})}}};this._dispatchEventFromSandbox(d,b)}),this._setEventListeners(f,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(f),this._setDefaultPropertiesFromJS(f),this.container.append(f),this.container}}class g2 extends gS{constructor(a){super(a,{ignoreBorder:a.data.hasAppearance})}render(){let a=super.render();a.classList.add("buttonWidgetAnnotation","pushButton");let b=a.lastChild;return this.enableScripting&&this.hasJSActions&&b&&(this._setDefaultPropertiesFromJS(b),b.addEventListener("updatefromsandbox",a=>{this._dispatchEventFromSandbox({},a)})),a}}class g3 extends gZ{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let a=this.annotationStorage,b=this.data.id,c=a.getValue(b,{value:this.data.fieldValue}),d=document.createElement("select");gE.add(d),d.setAttribute("data-element-id",b),d.disabled=this.data.readOnly,this._setRequired(d,this.data.required),d.name=this.data.fieldName,d.tabIndex=1e3;let e=this.data.combo&&this.data.options.length>0;for(let f of(!this.data.combo&&(d.size=this.data.options.length,this.data.multiSelect&&(d.multiple=!0)),d.addEventListener("resetform",a=>{let b=this.data.defaultFieldValue;for(let c of d.options)c.selected=c.value===b}),this.data.options)){let g=document.createElement("option");g.textContent=f.displayValue,g.value=f.exportValue,c.value.includes(f.exportValue)&&(g.setAttribute("selected",!0),e=!1),d.append(g)}let h=null;if(e){let i=document.createElement("option");i.value=" ",i.setAttribute("hidden",!0),i.setAttribute("selected",!0),d.prepend(i),h=()=>{i.remove(),d.removeEventListener("input",h),h=null},d.addEventListener("input",h)}let j=a=>{let b=a?"value":"textContent",{options:c,multiple:e}=d;return e?Array.prototype.filter.call(c,a=>a.selected).map(a=>a[b]):-1===c.selectedIndex?null:c[c.selectedIndex][b]},k=j(!1),l=a=>{let b=a.target.options;return Array.prototype.map.call(b,a=>({displayValue:a.textContent,exportValue:a.value}))};return this.enableScripting&&this.hasJSActions?(d.addEventListener("updatefromsandbox",c=>{let e={value(c){h?.();let e=c.detail.value,f=new Set(Array.isArray(e)?e:[e]);for(let g of d.options)g.selected=f.has(g.value);a.setValue(b,{value:j(!0)}),k=j(!1)},multipleSelection(a){d.multiple=!0},remove(c){let e=d.options,f=c.detail.remove;if(e[f].selected=!1,d.remove(f),e.length>0){let g=Array.prototype.findIndex.call(e,a=>a.selected);-1===g&&(e[0].selected=!0)}a.setValue(b,{value:j(!0),items:l(c)}),k=j(!1)},clear(c){for(;0!==d.length;)d.remove(0);a.setValue(b,{value:null,items:[]}),k=j(!1)},insert(c){let{index:e,displayValue:f,exportValue:g}=c.detail.insert,h=d.children[e],i=document.createElement("option");i.textContent=f,i.value=g,h?h.before(i):d.append(i),a.setValue(b,{value:j(!0),items:l(c)}),k=j(!1)},items(c){let{items:e}=c.detail;for(;0!==d.length;)d.remove(0);for(let f of e){let{displayValue:g,exportValue:h}=f,i=document.createElement("option");i.textContent=g,i.value=h,d.append(i)}d.options.length>0&&(d.options[0].selected=!0),a.setValue(b,{value:j(!0),items:l(c)}),k=j(!1)},indices(c){let d=new Set(c.detail.indices);for(let e of c.target.options)e.selected=d.has(e.index);a.setValue(b,{value:j(!0)}),k=j(!1)},editable(a){a.target.disabled=!a.detail.editable}};this._dispatchEventFromSandbox(e,c)}),d.addEventListener("input",c=>{let d=j(!0),e=j(!1);a.setValue(b,{value:d}),c.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:k,change:e,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(d,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],a=>a.target.value)):d.addEventListener("input",function(c){a.setValue(b,{value:j(!0)})}),this.data.combo&&this._setTextStyle(d),this._setBackgroundColor(d),this._setDefaultPropertiesFromJS(d),this.container.append(d),this.container}}class g4 extends gH{constructor(a){let{data:b,elements:c}=a;super(a,{isRenderable:gH._hasPopupData(b)}),this.elements=c,this.popup=null}render(){this.container.classList.add("popupAnnotation");let a=this.popup=new g5({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),b=[];for(let c of this.elements)c.popup=a,c.container.ariaHasPopup="dialog",b.push(c.data.id),c.addHighlightArea();return this.container.setAttribute("aria-controls",b.map(a=>`${aw}${a}`).join(",")),this.container}}class g5{#c3=this.#c4.bind(this);#c5=this.#c6.bind(this);#c7=this.#c8.bind(this);#c9=this.#da.bind(this);#db=null;#am=null;#dc=null;#dd=null;#de=null;#df=null;#dg=null;#dh=!1;#di=null;#J=null;#dj=null;#dk=null;#dl=null;#cY=null;#dm=!1;constructor({container:a,color:b,elements:c,titleObj:d,modificationDate:e,contentsObj:f,richText:g,parent:h,rect:i,parentRect:j,open:k}){for(let l of(this.#am=a,this.#dl=d,this.#dc=f,this.#dk=g,this.#df=h,this.#db=b,this.#dj=i,this.#dg=j,this.#de=c,this.#dd=aL.toDateObject(e),this.trigger=c.flatMap(a=>a.getElementsToTriggerPopup()),this.trigger))l.addEventListener("click",this.#c9),l.addEventListener("mouseenter",this.#c7),l.addEventListener("mouseleave",this.#c5),l.classList.add("popupTriggerArea");for(let m of c)m.container?.addEventListener("keydown",this.#c3);this.#am.hidden=!0,k&&this.#da()}render(){if(this.#di)return;let a=this.#di=document.createElement("div");if(a.className="popup",this.#db){let b=a.style.outlineColor=P.makeHexColor(...this.#db);if(CSS.supports("background-color","color-mix(in srgb, red 30%, white)"))a.style.backgroundColor=`color-mix(in srgb, ${b} 30%, white)`;else{let c=.7;a.style.backgroundColor=P.makeHexColor(...this.#db.map(a=>Math.floor(c*(255-a)+a)))}}let d=document.createElement("span");d.className="header";let e=document.createElement("h1");if(d.append(e),{dir:e.dir,str:e.textContent}=this.#dl,a.append(d),this.#dd){let f=document.createElement("span");f.classList.add("popupDate"),f.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),f.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#dd.valueOf()})),d.append(f)}let g=this.#dn;if(g)gD.render({xfaHtml:g,intent:"richText",div:a}),a.lastChild.classList.add("richText","popupContent");else{let h=this._formatContents(this.#dc);a.append(h)}this.#am.append(a)}get #dn(){let g6=this.#dk,g7=this.#dc;return g6?.str&&(!g7?.str||g7.str===g6.str)&&this.#dk.html||null}get #dp(){return this.#dn?.attributes?.style?.fontSize||0}get #dq(){return this.#dn?.attributes?.style?.color||null} #dr(g8){let g9=[],ha={style:{color:this.#dq,fontSize:this.#dp?`calc(${this.#dp}px * var(--scale-factor))`:""}};for(let hb of g8.split("\n"))g9.push({name:"span",value:hb,attributes:ha});return{str:g8,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:g9}]}}}_formatContents({str:a,dir:b}){let c=document.createElement("p");c.classList.add("popupContent"),c.dir=b;let d=a.split(/(?:\r\n?|\n)/);for(let e=0,f=d.length;e<f;++e){let g=d[e];c.append(document.createTextNode(g)),e<f-1&&c.append(document.createElement("br"))}return c} #c4(hc){!hc.altKey&&!hc.shiftKey&&!hc.ctrlKey&&!hc.metaKey&&("Enter"===hc.key||"Escape"===hc.key&&this.#dh)&&this.#da()}updateEdited({rect:a,popupContent:b}){this.#cY||={contentsObj:this.#dc,richText:this.#dk},a&&(this.#J=null),b&&(this.#dk=this.#dr(b),this.#dc=null),this.#di?.remove(),this.#di=null}resetEdited(){this.#cY&&({contentsObj:this.#dc,richText:this.#dk}=this.#cY,this.#cY=null,this.#di?.remove(),this.#di=null,this.#J=null)} #ds(){if(null!==this.#J)return;let{page:{view:hd},viewport:{rawDims:{pageWidth:he,pageHeight:hf,pageX:hg,pageY:hh}}}=this.#df,hi=!!this.#dg,hj=hi?this.#dg:this.#dj;for(let hk of this.#de)if(!hj||null!==P.intersect(hk.data.rect,hj)){hj=hk.data.rect,hi=!0;break}let hl=P.normalizeRect([hj[0],hd[3]-hj[1]+hd[1],hj[2],hd[3]-hj[3]+hd[1]]),hm=hi?hj[2]-hj[0]+5:0,hn=hl[0]+hm,ho=hl[1];this.#J=[100*(hn-hg)/he,100*(ho-hh)/hf];let{style:hp}=this.#am;hp.left=`${this.#J[0]}%`,hp.top=`${this.#J[1]}%`} #da(){this.#dh=!this.#dh,this.#dh?(this.#c8(),this.#am.addEventListener("click",this.#c9),this.#am.addEventListener("keydown",this.#c3)):(this.#c6(),this.#am.removeEventListener("click",this.#c9),this.#am.removeEventListener("keydown",this.#c3))} #c8(){this.#di||this.render(),this.isVisible?this.#dh&&this.#am.classList.add("focused"):(this.#ds(),this.#am.hidden=!1,this.#am.style.zIndex=parseInt(this.#am.style.zIndex)+1e3)} #c6(){this.#am.classList.remove("focused"),!this.#dh&&this.isVisible&&(this.#am.hidden=!0,this.#am.style.zIndex=parseInt(this.#am.style.zIndex)-1e3)}forceHide(){this.#dm=this.isVisible,this.#dm&&(this.#am.hidden=!0)}maybeShow(){this.#dm&&(this.#di||this.#c8(),this.#dm=!1,this.#am.hidden=!1)}get isVisible(){return!1===this.#am.hidden}}class hq extends gH{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.textContent=a.data.textContent,this.textPosition=a.data.textPosition,this.annotationEditorType=l.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let a=document.createElement("div");for(let b of(a.classList.add("annotationTextContent"),a.setAttribute("role","comment"),this.textContent)){let c=document.createElement("span");c.textContent=b,a.append(c)}this.container.append(a)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class hr extends gH{#dt=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");let a=this.data,{width:b,height:c}=gF(a.rect),d=this.svgFactory.create(b,c,!0),e=this.#dt=this.svgFactory.createElement("svg:line");return e.setAttribute("x1",a.rect[2]-a.lineCoordinates[0]),e.setAttribute("y1",a.rect[3]-a.lineCoordinates[1]),e.setAttribute("x2",a.rect[2]-a.lineCoordinates[2]),e.setAttribute("y2",a.rect[3]-a.lineCoordinates[3]),e.setAttribute("stroke-width",a.borderStyle.width||1),e.setAttribute("stroke","transparent"),e.setAttribute("fill","transparent"),d.append(e),this.container.append(d),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#dt}addHighlightArea(){this.container.classList.add("highlightArea")}}class hs extends gH{#du=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");let a=this.data,{width:b,height:c}=gF(a.rect),d=this.svgFactory.create(b,c,!0),e=a.borderStyle.width,f=this.#du=this.svgFactory.createElement("svg:rect");return f.setAttribute("x",e/2),f.setAttribute("y",e/2),f.setAttribute("width",b-e),f.setAttribute("height",c-e),f.setAttribute("stroke-width",e||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),d.append(f),this.container.append(d),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#du}addHighlightArea(){this.container.classList.add("highlightArea")}}class ht extends gH{#dv=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");let a=this.data,{width:b,height:c}=gF(a.rect),d=this.svgFactory.create(b,c,!0),e=a.borderStyle.width,f=this.#dv=this.svgFactory.createElement("svg:ellipse");return f.setAttribute("cx",b/2),f.setAttribute("cy",c/2),f.setAttribute("rx",b/2-e/2),f.setAttribute("ry",c/2-e/2),f.setAttribute("stroke-width",e||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),d.append(f),this.container.append(d),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#dv}addHighlightArea(){this.container.classList.add("highlightArea")}}class hu extends gH{#dw=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:a,vertices:b,borderStyle:c,popupRef:d}}=this;if(!b)return this.container;let{width:e,height:f}=gF(a),g=this.svgFactory.create(e,f,!0),h=[];for(let i=0,j=b.length;i<j;i+=2){let k=b[i]-a[0],l=a[3]-b[i+1];h.push(`${k},${l}`)}h=h.join(" ");let m=this.#dw=this.svgFactory.createElement(this.svgElementName);return m.setAttribute("points",h),m.setAttribute("stroke-width",c.width||1),m.setAttribute("stroke","transparent"),m.setAttribute("fill","transparent"),g.append(m),this.container.append(g),!d&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#dw}addHighlightArea(){this.container.classList.add("highlightArea")}}class hv extends hu{constructor(a){super(a),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class hw extends gH{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class hx extends gH{#dx=[];constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType="InkHighlight"===this.data.it?l.HIGHLIGHT:l.INK}render(){this.container.classList.add(this.containerClassName);let{data:{rect:a,inkLists:b,borderStyle:c,popupRef:d}}=this,{width:e,height:f}=gF(a),g=this.svgFactory.create(e,f,!0);for(let h of b){let i=[];for(let j=0,k=h.length;j<k;j+=2){let l=h[j]-a[0],m=a[3]-h[j+1];i.push(`${l},${m}`)}i=i.join(" ");let n=this.svgFactory.createElement(this.svgElementName);this.#dx.push(n),n.setAttribute("points",i),n.setAttribute("stroke-width",c.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),g.append(n)}return!d&&this.hasPopupData&&this._createPopup(),this.container.append(g),this._editOnDoubleClick(),this.container}getElementsToTriggerPopup(){return this.#dx}addHighlightArea(){this.container.classList.add("highlightArea")}}class hy extends gH{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=l.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class hz extends gH{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class hA extends gH{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class hB extends gH{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class hC extends gH{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=l.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class hD extends gH{#dy=null;constructor(a){super(a,{isRenderable:!0});let{file:b}=this.data;this.filename=b.filename,this.content=b.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...b})}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:a,data:b}=this,c;b.hasAppearance||0===b.fillAlpha?c=document.createElement("div"):((c=document.createElement("img")).src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(b.name)?"paperclip":"pushpin"}.svg`,b.fillAlpha&&b.fillAlpha<1&&(c.style=`filter: opacity(${Math.round(100*b.fillAlpha)}%);`)),c.addEventListener("dblclick",this.#dz.bind(this)),this.#dy=c;let{isMac:d}=N.platform;return a.addEventListener("keydown",a=>{"Enter"===a.key&&(d?a.metaKey:a.ctrlKey)&&this.#dz()}),!b.popupRef&&this.hasPopupData?this._createPopup():c.classList.add("popupTriggerArea"),a.append(c),a}getElementsToTriggerPopup(){return this.#dy}addHighlightArea(){this.container.classList.add("highlightArea")} #dz(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class hE{#dA=null;#dB=null;#dC=new Map;#dD=null;constructor({div:a,accessibilityManager:b,annotationCanvasMap:c,annotationEditorUIManager:d,page:e,viewport:f,structTreeLayer:g}){this.div=a,this.#dA=b,this.#dB=c,this.#dD=g||null,this.page=e,this.viewport=f,this.zIndex=0,this._annotationEditorUIManager=d}hasEditableAnnotations(){return this.#dC.size>0}async #dE(hF,hG){let hH=hF.firstChild||hF,hI=hH.id=`${aw}${hG}`,hJ=await this.#dD?.getAriaAttributes(hI);if(hJ)for(let[hK,hL]of hJ)hH.setAttribute(hK,hL);this.div.append(hF),this.#dA?.moveElementInDOM(this.div,hF,hH,!1)}async render(a){let{annotations:b}=a,c=this.div;aQ(c,this.viewport);let d=new Map,e={data:null,layer:c,linkService:a.linkService,downloadManager:a.downloadManager,imageResourcesPath:a.imageResourcesPath||"",renderForms:!1!==a.renderForms,svgFactory:new gC,annotationStorage:a.annotationStorage||new dB,enableScripting:!0===a.enableScripting,hasJSActions:a.hasJSActions,fieldObjects:a.fieldObjects,parent:this,elements:null};for(let f of b){if(f.noHTML)continue;let g=f.annotationType===q.POPUP;if(g){let h=d.get(f.id);if(!h)continue;e.elements=h}else{let{width:i,height:j}=gF(f.rect);if(i<=0||j<=0)continue}e.data=f;let k=gG.create(e);if(!k.isRenderable)continue;if(!g&&f.popupRef){let l=d.get(f.popupRef);l?l.push(k):d.set(f.popupRef,[k])}let m=k.render();f.hidden&&(m.style.visibility="hidden"),await this.#dE(m,f.id),k._isEditable&&(this.#dC.set(k.data.id,k),this._annotationEditorUIManager?.renderAnnotationElement(k))}this.#dF()}update({viewport:a}){let b=this.div;this.viewport=a,aQ(b,{rotation:a.rotation}),this.#dF(),b.hidden=!1} #dF(){if(!this.#dB)return;let hM=this.div;for(let[hN,hO]of this.#dB){let hP=hM.querySelector(`[data-annotation-id="${hN}"]`);if(!hP)continue;hO.className="annotationContent";let{firstChild:hQ}=hP;hQ?"CANVAS"===hQ.nodeName?hQ.replaceWith(hO):hQ.classList.contains("annotationContent")?hQ.after(hO):hQ.before(hO):hP.append(hO)}this.#dB.clear()}getEditableAnnotations(){return Array.from(this.#dC.values())}getEditableAnnotation(a){return this.#dC.get(a)}}let hR=/\r\n?|\n/g;class hS extends b7{#db;#dG="";#dH=`${this.id}-editor`;#dI=null;#dp;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){let a=hS.prototype,b=a=>a.isEmpty(),c=bs.TRANSLATE_SMALL,d=bs.TRANSLATE_BIG;return B(this,"_keyboardManager",new bo([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],a.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],a.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],a._translateEmpty,{args:[-c,0],checker:b}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],a._translateEmpty,{args:[-d,0],checker:b}],[["ArrowRight","mac+ArrowRight"],a._translateEmpty,{args:[c,0],checker:b}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],a._translateEmpty,{args:[d,0],checker:b}],[["ArrowUp","mac+ArrowUp"],a._translateEmpty,{args:[0,-c],checker:b}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],a._translateEmpty,{args:[0,-d],checker:b}],[["ArrowDown","mac+ArrowDown"],a._translateEmpty,{args:[0,c],checker:b}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],a._translateEmpty,{args:[0,d],checker:b}]]))}static _type="freetext";static _editorType=l.FREETEXT;constructor(a){super({...a,name:"freeTextEditor"}),this.#db=a.color||hS._defaultColor||b7._defaultLineColor,this.#dp=a.fontSize||hS._defaultFontSize}static initialize(a,b){b7.initialize(a,b);let c=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(c.getPropertyValue("--freetext-padding"))}static updateDefaultParams(a,b){switch(a){case m.FREETEXT_SIZE:hS._defaultFontSize=b;break;case m.FREETEXT_COLOR:hS._defaultColor=b}}updateParams(a,b){switch(a){case m.FREETEXT_SIZE:this.#dJ(b);break;case m.FREETEXT_COLOR:this.#dK(b)}}static get defaultPropertiesToUpdate(){return[[m.FREETEXT_SIZE,hS._defaultFontSize],[m.FREETEXT_COLOR,hS._defaultColor||b7._defaultLineColor]]}get propertiesToUpdate(){return[[m.FREETEXT_SIZE,this.#dp],[m.FREETEXT_COLOR,this.#db]]} #dJ(hT){let hU=a=>{this.editorDiv.style.fontSize=`calc(${a}px * var(--scale-factor))`,this.translate(0,-(a-this.#dp)*this.parentScale),this.#dp=a,this.#dL()},hV=this.#dp;this.addCommands({cmd:hU.bind(this,hT),undo:hU.bind(this,hV),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:m.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})} #dK(hW){let hX=a=>{this.#db=this.editorDiv.style.color=a},hY=this.#db;this.addCommands({cmd:hX.bind(this,hW),undo:hX.bind(this,hY),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:m.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(a,b){this._uiManager.translateSelectedEditors(a,b,!0)}getInitialTranslation(){let a=this.parentScale;return[-hS._internalPadding*a,-(hS._internalPadding+this.#dp)*a]}rebuild(){if(this.parent)super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(l.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#dI=new AbortController;let a=this._uiManager.combinedSignal(this.#dI);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:a}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:a}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:a}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:a}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:a})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#dH),this._isDraggable=!0,this.#dI?.abort(),this.#dI=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(a){this._focusEventsAllowed&&(super.focusin(a),a.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){!this.width&&(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()} #dM(){let hZ=[];this.editorDiv.normalize();let h$=null;for(let h_ of this.editorDiv.childNodes)(h$?.nodeType!==Node.TEXT_NODE||"BR"!==h_.nodeName)&&(hZ.push(hS.#dN(h_)),h$=h_);return hZ.join("\n")} #dL(){let[h0,h1]=this.parentDimensions,h2;if(this.isAttachedToDOM)h2=this.div.getBoundingClientRect();else{let{currentLayer:h3,div:h4}=this,h5=h4.style.display,h6=h4.classList.contains("hidden");h4.classList.remove("hidden"),h4.style.display="hidden",h3.div.append(this.div),h2=h4.getBoundingClientRect(),h4.remove(),h4.style.display=h5,h4.classList.toggle("hidden",h6)}this.rotation%180==this.parentRotation%180?(this.width=h2.width/h0,this.height=h2.height/h1):(this.width=h2.height/h0,this.height=h2.width/h1),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let a=this.#dG,b=this.#dG=this.#dM().trimEnd();if(a===b)return;let c=a=>{if(this.#dG=a,!a){this.remove();return}this.#dO(),this._uiManager.rebuild(this),this.#dL()};this.addCommands({cmd(){c(b)},undo(){c(a)},mustExec:!1}),this.#dL()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(a){this.enterInEditMode()}keydown(a){a.target===this.div&&"Enter"===a.key&&(this.enterInEditMode(),a.preventDefault())}editorDivKeydown(a){hS._keyboardManager.exec(this,a)}editorDivFocus(a){this.isEditing=!0}editorDivBlur(a){this.isEditing=!1}editorDivInput(a){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let a,b;this.width&&(a=this.x,b=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#dH),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:c}=this.editorDiv;if(c.fontSize=`calc(${this.#dp}px * var(--scale-factor))`,c.color=this.#db,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),bd(this,this.div,["dblclick","keydown"]),this.width){let[d,e]=this.parentDimensions;if(this.annotationElementId){let{position:f}=this._initialData,[g,h]=this.getInitialTranslation();[g,h]=this.pageTranslationToScreen(g,h);let[i,j]=this.pageDimensions,[k,l]=this.pageTranslation,m,n;switch(this.rotation){case 0:m=a+(f[0]-k)/i,n=b+this.height-(f[1]-l)/j;break;case 90:m=a+(f[0]-k)/i,n=b-(f[1]-l)/j,[g,h]=[h,-g];break;case 180:m=a-this.width+(f[0]-k)/i,n=b-(f[1]-l)/j,[g,h]=[-g,-h];break;case 270:m=a+(f[0]-k-this.height*j)/i,n=b+(f[1]-l-this.width*i)/j,[g,h]=[-h,g]}this.setAt(m*d,n*e,g,h)}else this.setAt(a*d,b*e,this.width*d,this.height*e);this.#dO(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static  #dN(h7){return(h7.nodeType===Node.TEXT_NODE?h7.nodeValue:h7.innerText).replaceAll(hR,"")}editorDivPaste(a){let b=a.clipboardData||window.clipboardData,{types:c}=b;if(1===c.length&&"text/plain"===c[0])return;a.preventDefault();let d=hS.#dP(b.getData("text")||"").replaceAll(hR,"\n");if(!d)return;let e=window.getSelection();if(!e.rangeCount)return;this.editorDiv.normalize(),e.deleteFromDocument();let f=e.getRangeAt(0);if(!d.includes("\n")){f.insertNode(document.createTextNode(d)),this.editorDiv.normalize(),e.collapseToStart();return}let{startContainer:g,startOffset:h}=f,i=[],j=[];if(g.nodeType===Node.TEXT_NODE){let k=g.parentElement;if(j.push(g.nodeValue.slice(h).replaceAll(hR,"")),k!==this.editorDiv){let l=i;for(let m of this.editorDiv.childNodes){if(m===k){l=j;continue}l.push(hS.#dN(m))}}i.push(g.nodeValue.slice(0,h).replaceAll(hR,""))}else if(g===this.editorDiv){let n=i,o=0;for(let p of this.editorDiv.childNodes)(o++)===h&&(n=j),n.push(hS.#dN(p))}this.#dG=`${i.join("\n")}${d}${j.join("\n")}`,this.#dO();let q=new Range,r=i.reduce((a,b)=>a+b.length,0);for(let{firstChild:s}of this.editorDiv.childNodes)if(s.nodeType===Node.TEXT_NODE){let t=s.nodeValue.length;if(r<=t){q.setStart(s,r),q.setEnd(s,r);break}r-=t}e.removeAllRanges(),e.addRange(q)} #dO(){if(this.editorDiv.replaceChildren(),this.#dG)for(let h8 of this.#dG.split("\n")){let h9=document.createElement("div");h9.append(h8?document.createTextNode(h8):document.createElement("br")),this.editorDiv.append(h9)}} #dQ(){return this.#dG.replaceAll("\xa0"," ")}static  #dP(ia){return ia.replaceAll(" ","\xa0")}get contentDiv(){return this.editorDiv}static async deserialize(a,b,c){let d=null;if(a instanceof hq){let{data:{defaultAppearanceData:{fontSize:e,fontColor:f},rect:g,rotation:h,id:i,popupRef:j},textContent:k,textPosition:m,parent:{page:{pageNumber:n}}}=a;if(!k||0===k.length)return null;d=a={annotationType:l.FREETEXT,color:Array.from(f),fontSize:e,value:k.join("\n"),position:m,pageIndex:n-1,rect:g.slice(0),rotation:h,id:i,deleted:!1,popupRef:j}}let o=await super.deserialize(a,b,c);return o.#dp=a.fontSize,o.#db=P.makeHexColor(...a.color),o.#dG=hS.#dP(a.value),o.annotationElementId=a.id||null,o._initialData=d,o}serialize(a=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let b=hS._internalPadding*this.parentScale,c=this.getRect(b,b),d=b7._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#db),e={annotationType:l.FREETEXT,color:d,fontSize:this.#dp,value:this.#dQ(),pageIndex:this.pageIndex,rect:c,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return a?e:this.annotationElementId&&!this.#dR(e)?null:(e.id=this.annotationElementId,e)} #dR(ib){let{value:ic,fontSize:id,color:ie,pageIndex:ig}=this._initialData;return this._hasBeenMoved||ib.value!==ic||ib.fontSize!==id||ib.color.some((a,b)=>a!==ie[b])||ib.pageIndex!==ig}renderAnnotationElement(a){let b=super.renderAnnotationElement(a);if(this.deleted)return b;let{style:c}=b;for(let d of(c.fontSize=`calc(${this.#dp}px * var(--scale-factor))`,c.color=this.#db,b.replaceChildren(),this.#dG.split("\n"))){let e=document.createElement("div");e.append(d?document.createTextNode(d):document.createElement("br")),b.append(e)}let f=hS._internalPadding*this.parentScale;return a.updateEdited({rect:this.getRect(f,f),popupContent:this.#dG}),b}resetAnnotationElement(a){super.resetAnnotationElement(a),a.resetEdited()}}class ih{toSVGPath(){y("Abstract method `toSVGPath` must be implemented.")}get box(){y("Abstract getter `box` must be implemented.")}serialize(a,b){y("Abstract method `serialize` must be implemented.")}get classNamesForDrawing(){y("Abstract getter `classNamesForDrawing` must be implemented.")}get classNamesForOutlining(){y("Abstract getter `classNamesForOutlining` must be implemented.")}get mustRemoveSelfIntersections(){return!1}}class ii{#dS;#dT=[];#dU;#dV;#dW=[];#dX=new Float64Array(18);#dY;#dZ;#d$;#d_;#d0;#d1;#d2=[];static #d3=8;static #d4=2;static #d5=ii.#d3+ii.#d4;constructor({x:a,y:b},c,d,e,f,g=0){this.#dS=c,this.#d1=e*d,this.#dV=f,this.#dX.set([NaN,NaN,NaN,NaN,a,b],6),this.#dU=g,this.#d_=ii.#d3*d,this.#d$=ii.#d5*d,this.#d0=d,this.#d2.push(a,b)}isEmpty(){return isNaN(this.#dX[8])} #d6(){let ij=this.#dX.subarray(4,6),ik=this.#dX.subarray(16,18),[il,im,io,ip]=this.#dS;return[(this.#dY+(ij[0]-ik[0])/2-il)/io,(this.#dZ+(ij[1]-ik[1])/2-im)/ip,(this.#dY+(ik[0]-ij[0])/2-il)/io,(this.#dZ+(ik[1]-ij[1])/2-im)/ip]}add({x:a,y:b}){this.#dY=a,this.#dZ=b;let[c,d,e,f]=this.#dS,[g,h,i,j]=this.#dX.subarray(8,12),k=a-i,l=b-j,m=Math.hypot(k,l);if(m<this.#d$)return!1;let n=m-this.#d_,o=n/m,p=o*k,q=o*l,r=g,s=h;g=i,h=j,i+=p,j+=q,this.#d2?.push(a,b);let t=-q/n,u=p/n,v=t*this.#d1,w=u*this.#d1;if(this.#dX.set(this.#dX.subarray(2,8),0),this.#dX.set([i+v,j+w],4),this.#dX.set(this.#dX.subarray(14,18),12),this.#dX.set([i-v,j-w],16),isNaN(this.#dX[6]))return 0===this.#dW.length&&(this.#dX.set([g+v,h+w],2),this.#dW.push(NaN,NaN,NaN,NaN,(g+v-c)/e,(h+w-d)/f),this.#dX.set([g-v,h-w],14),this.#dT.push(NaN,NaN,NaN,NaN,(g-v-c)/e,(h-w-d)/f)),this.#dX.set([r,s,g,h,i,j],6),!this.isEmpty();this.#dX.set([r,s,g,h,i,j],6);let x=Math.abs(Math.atan2(s-h,r-g)-Math.atan2(q,p));return x<Math.PI/2?([g,h,i,j]=this.#dX.subarray(2,6),this.#dW.push(NaN,NaN,NaN,NaN,((g+i)/2-c)/e,((h+j)/2-d)/f),[g,h,r,s]=this.#dX.subarray(14,18),this.#dT.push(NaN,NaN,NaN,NaN,((r+g)/2-c)/e,((s+h)/2-d)/f),!0):([r,s,g,h,i,j]=this.#dX.subarray(0,6),this.#dW.push(((r+5*g)/6-c)/e,((s+5*h)/6-d)/f,((5*g+i)/6-c)/e,((5*h+j)/6-d)/f,((g+i)/2-c)/e,((h+j)/2-d)/f),[i,j,g,h,r,s]=this.#dX.subarray(12,18),this.#dT.push(((r+5*g)/6-c)/e,((s+5*h)/6-d)/f,((5*g+i)/6-c)/e,((5*h+j)/6-d)/f,((g+i)/2-c)/e,((h+j)/2-d)/f),!0)}toSVGPath(){if(this.isEmpty())return"";let a=this.#dW,b=this.#dT;if(isNaN(this.#dX[6])&&!this.isEmpty())return this.#d7();let c=[];c.push(`M${a[4]} ${a[5]}`);for(let d=6;d<a.length;d+=6)isNaN(a[d])?c.push(`L${a[d+4]} ${a[d+5]}`):c.push(`C${a[d]} ${a[d+1]} ${a[d+2]} ${a[d+3]} ${a[d+4]} ${a[d+5]}`);this.#d8(c);for(let e=b.length-6;e>=6;e-=6)isNaN(b[e])?c.push(`L${b[e+4]} ${b[e+5]}`):c.push(`C${b[e]} ${b[e+1]} ${b[e+2]} ${b[e+3]} ${b[e+4]} ${b[e+5]}`);return this.#d9(c),c.join(" ")} #d7(){let[iq,ir,is,it]=this.#dS,[iu,iv,iw,ix]=this.#d6();return`M${(this.#dX[2]-iq)/is} ${(this.#dX[3]-ir)/it} L${(this.#dX[4]-iq)/is} ${(this.#dX[5]-ir)/it} L${iu} ${iv} L${iw} ${ix} L${(this.#dX[16]-iq)/is} ${(this.#dX[17]-ir)/it} L${(this.#dX[14]-iq)/is} ${(this.#dX[15]-ir)/it} Z`} #d9(iy){let iz=this.#dT;iy.push(`L${iz[4]} ${iz[5]} Z`)} #d8(iA){let[iB,iC,iD,iE]=this.#dS,iF=this.#dX.subarray(4,6),iG=this.#dX.subarray(16,18),[iH,iI,iJ,iK]=this.#d6();iA.push(`L${(iF[0]-iB)/iD} ${(iF[1]-iC)/iE} L${iH} ${iI} L${iJ} ${iK} L${(iG[0]-iB)/iD} ${(iG[1]-iC)/iE}`)}newFreeDrawOutline(a,b,c,d,e,f){return new i9(a,b,c,d,e,f)}getOutlines(){let a=this.#dW,b=this.#dT,c=this.#dX,[d,e,f,g]=this.#dS,h=new Float64Array((this.#d2?.length??0)+2);for(let i=0,j=h.length-2;i<j;i+=2)h[i]=(this.#d2[i]-d)/f,h[i+1]=(this.#d2[i+1]-e)/g;if(h[h.length-2]=(this.#dY-d)/f,h[h.length-1]=(this.#dZ-e)/g,isNaN(c[6])&&!this.isEmpty())return this.#ea(h);let k=new Float64Array(this.#dW.length+24+this.#dT.length),l=a.length;for(let m=0;m<l;m+=2){if(isNaN(a[m])){k[m]=k[m+1]=NaN;continue}k[m]=a[m],k[m+1]=a[m+1]}l=this.#eb(k,l);for(let n=b.length-6;n>=6;n-=6)for(let o=0;o<6;o+=2){if(isNaN(b[n+o])){k[l]=k[l+1]=NaN,l+=2;continue}k[l]=b[n+o],k[l+1]=b[n+o+1],l+=2}return this.#ec(k,l),this.newFreeDrawOutline(k,h,this.#dS,this.#d0,this.#dU,this.#dV)} #ea(iL){let iM=this.#dX,[iN,iO,iP,iQ]=this.#dS,[iR,iS,iT,iU]=this.#d6(),iV=new Float64Array(36);return iV.set([NaN,NaN,NaN,NaN,(iM[2]-iN)/iP,(iM[3]-iO)/iQ,NaN,NaN,NaN,NaN,(iM[4]-iN)/iP,(iM[5]-iO)/iQ,NaN,NaN,NaN,NaN,iR,iS,NaN,NaN,NaN,NaN,iT,iU,NaN,NaN,NaN,NaN,(iM[16]-iN)/iP,(iM[17]-iO)/iQ,NaN,NaN,NaN,NaN,(iM[14]-iN)/iP,(iM[15]-iO)/iQ],0),this.newFreeDrawOutline(iV,iL,this.#dS,this.#d0,this.#dU,this.#dV)} #ec(iW,iX){let iY=this.#dT;return iW.set([NaN,NaN,NaN,NaN,iY[4],iY[5]],iX),iX+6} #eb(iZ,i$){let i_=this.#dX.subarray(4,6),i0=this.#dX.subarray(16,18),[i1,i2,i3,i4]=this.#dS,[i5,i6,i7,i8]=this.#d6();return iZ.set([NaN,NaN,NaN,NaN,(i_[0]-i1)/i3,(i_[1]-i2)/i4,NaN,NaN,NaN,NaN,i5,i6,NaN,NaN,NaN,NaN,i7,i8,NaN,NaN,NaN,NaN,(i0[0]-i1)/i3,(i0[1]-i2)/i4],i$),i$+24}}class i9 extends ih{#dS;#ed=null;#dU;#dV;#d2;#d0;#ee;constructor(a,b,c,d,e,f){super(),this.#ee=a,this.#d2=b,this.#dS=c,this.#d0=d,this.#dU=e,this.#dV=f,this.#ef(f);let{x:g,y:h,width:i,height:j}=this.#ed;for(let k=0,l=a.length;k<l;k+=2)a[k]=(a[k]-g)/i,a[k+1]=(a[k+1]-h)/j;for(let m=0,n=b.length;m<n;m+=2)b[m]=(b[m]-g)/i,b[m+1]=(b[m+1]-h)/j}toSVGPath(){let a=[`M${this.#ee[4]} ${this.#ee[5]}`];for(let b=6,c=this.#ee.length;b<c;b+=6){if(isNaN(this.#ee[b])){a.push(`L${this.#ee[b+4]} ${this.#ee[b+5]}`);continue}a.push(`C${this.#ee[b]} ${this.#ee[b+1]} ${this.#ee[b+2]} ${this.#ee[b+3]} ${this.#ee[b+4]} ${this.#ee[b+5]}`)}return a.push("Z"),a.join(" ")}serialize([a,b,c,d],e){let f=c-a,g=d-b,h,i;switch(e){case 0:h=this.#eg(this.#ee,a,d,f,-g),i=this.#eg(this.#d2,a,d,f,-g);break;case 90:h=this.#eh(this.#ee,a,b,f,g),i=this.#eh(this.#d2,a,b,f,g);break;case 180:h=this.#eg(this.#ee,c,b,-f,g),i=this.#eg(this.#d2,c,b,-f,g);break;case 270:h=this.#eh(this.#ee,c,d,-f,-g),i=this.#eh(this.#d2,c,d,-f,-g)}return{outline:Array.from(h),points:[Array.from(i)]}} #eg(ja,jb,jc,jd,je){let jf=new Float64Array(ja.length);for(let jg=0,jh=ja.length;jg<jh;jg+=2)jf[jg]=jb+ja[jg]*jd,jf[jg+1]=jc+ja[jg+1]*je;return jf} #eh(ji,jj,jk,jl,jm){let jn=new Float64Array(ji.length);for(let jo=0,jp=ji.length;jo<jp;jo+=2)jn[jo]=jj+ji[jo+1]*jl,jn[jo+1]=jk+ji[jo]*jm;return jn} #ef(jq){let jr=this.#ee,js=jr[4],jt=jr[5],ju=js,jv=jt,jw=js,jx=jt,jy=js,jz=jt,jA=jq?Math.max:Math.min;for(let jB=6,jC=jr.length;jB<jC;jB+=6){if(isNaN(jr[jB]))ju=Math.min(ju,jr[jB+4]),jv=Math.min(jv,jr[jB+5]),jw=Math.max(jw,jr[jB+4]),jx=Math.max(jx,jr[jB+5]),jz<jr[jB+5]?(jy=jr[jB+4],jz=jr[jB+5]):jz===jr[jB+5]&&(jy=jA(jy,jr[jB+4]));else{let jD=P.bezierBoundingBox(js,jt,...jr.slice(jB,jB+6));ju=Math.min(ju,jD[0]),jv=Math.min(jv,jD[1]),jw=Math.max(jw,jD[2]),jx=Math.max(jx,jD[3]),jz<jD[3]?(jy=jD[2],jz=jD[3]):jz===jD[3]&&(jy=jA(jy,jD[2]))}js=jr[jB+4],jt=jr[jB+5]}let jE=ju-this.#dU,jF=jv-this.#dU,jG=jw-ju+2*this.#dU,jH=jx-jv+2*this.#dU;this.#ed={x:jE,y:jF,width:jG,height:jH,lastPoint:[jy,jz]}}get box(){return this.#ed}newOutliner(a,b,c,d,e,f=0){return new ii(a,b,c,d,e,f)}getNewOutline(a,b){let{x:c,y:d,width:e,height:f}=this.#ed,[g,h,i,j]=this.#dS,k=e*i,l=f*j,m=c*i+g,n=d*j+h,o=this.newOutliner({x:this.#d2[0]*k+m,y:this.#d2[1]*l+n},this.#dS,this.#d0,a,this.#dV,b??this.#dU);for(let p=2;p<this.#d2.length;p+=2)o.add({x:this.#d2[p]*k+m,y:this.#d2[p+1]*l+n});return o.getOutlines()}get mustRemoveSelfIntersections(){return!0}}class jI{#dS;#ei=[];#ej=[];constructor(a,b=0,c=0,d=!0){let e=1/0,f=-1/0,g=1/0,h=-1/0;for(let{x:i,y:j,width:k,height:l}of a){let m=1e-4*Math.floor((i-b)/1e-4),n=1e-4*Math.ceil((i+k+b)/1e-4),o=1e-4*Math.floor((j-b)/1e-4),p=1e-4*Math.ceil((j+l+b)/1e-4),q=[m,o,p,!0],r=[n,o,p,!1];this.#ei.push(q,r),e=Math.min(e,m),f=Math.max(f,n),g=Math.min(g,o),h=Math.max(h,p)}let s=f-e+2*c,t=h-g+2*c,u=e-c,v=g-c,w=this.#ei.at(d?-1:-2),x=[w[0],w[2]];for(let y of this.#ei){let[z,A,B]=y;y[0]=(z-u)/s,y[1]=(A-v)/t,y[2]=(B-v)/t}this.#dS={x:u,y:v,width:s,height:t,lastPoint:x}}getOutlines(){this.#ei.sort((a,b)=>a[0]-b[0]||a[1]-b[1]||a[2]-b[2]);let a=[];for(let b of this.#ei)b[3]?(a.push(...this.#ek(b)),this.#el(b)):(this.#em(b),a.push(...this.#ek(b)));return this.#en(a)} #en(jJ){let jK=[],jL=new Set;for(let jM of jJ){let[jN,jO,jP]=jM;jK.push([jN,jO,jM],[jN,jP,jM])}jK.sort((a,b)=>a[1]-b[1]||a[0]-b[0]);for(let jQ=0,jR=jK.length;jQ<jR;jQ+=2){let jS=jK[jQ][2],jT=jK[jQ+1][2];jS.push(jT),jT.push(jS),jL.add(jS),jL.add(jT)}let jU=[],jV;for(;jL.size>0;){let jW=jL.values().next().value,[jX,jY,jZ,j$,j_]=jW;jL.delete(jW);let j0=jX,j1=jY;for(jV=[jX,jZ],jU.push(jV);;){let j2;if(jL.has(j$))j2=j$;else if(jL.has(j_))j2=j_;else break;jL.delete(j2),[jX,jY,jZ,j$,j_]=j2,j0!==jX&&(jV.push(j0,j1,jX,j1===jY?jY:jZ),j0=jX),j1=j1===jY?jZ:jY}jV.push(j0,j1)}return new ky(jU,this.#dS)} #eo(j3){let j4=this.#ej,j5=0,j6=j4.length-1;for(;j5<=j6;){let j7=j5+j6>>1,j8=j4[j7][0];if(j8===j3)return j7;j8<j3?j5=j7+1:j6=j7-1}return j6+1} #el([,j9,ka]){let kb=this.#eo(j9);this.#ej.splice(kb,0,[j9,ka])} #em([,kc,kd]){let ke=this.#eo(kc);for(let kf=ke;kf<this.#ej.length;kf++){let[kg,kh]=this.#ej[kf];if(kg!==kc)break;if(kg===kc&&kh===kd){this.#ej.splice(kf,1);return}}for(let ki=ke-1;ki>=0;ki--){let[kj,kk]=this.#ej[ki];if(kj!==kc)break;if(kj===kc&&kk===kd){this.#ej.splice(ki,1);return}}} #ek(kl){let[km,kn,ko]=kl,kp=[[km,kn,ko]],kq=this.#eo(ko);for(let kr=0;kr<kq;kr++){let[ks,kt]=this.#ej[kr];for(let ku=0,kv=kp.length;ku<kv;ku++){let[,kw,kx]=kp[ku];if(!(kt<=kw)&&!(kx<=ks)){if(kw>=ks){if(kx>kt)kp[ku][1]=kt;else{if(1===kv)return[];kp.splice(ku,1),ku--,kv--}continue}kp[ku][2]=ks,kx>kt&&kp.push([km,kt,kx])}}}return kp}}class ky extends ih{#dS;#ep;constructor(a,b){super(),this.#ep=a,this.#dS=b}toSVGPath(){let a=[];for(let b of this.#ep){let[c,d]=b;a.push(`M${c} ${d}`);for(let e=2;e<b.length;e+=2){let f=b[e],g=b[e+1];f===c?(a.push(`V${g}`),d=g):g===d&&(a.push(`H${f}`),c=f)}a.push("Z")}return a.join(" ")}serialize([a,b,c,d],e){let f=[],g=c-a,h=d-b;for(let i of this.#ep){let j=Array(i.length);for(let k=0;k<i.length;k+=2)j[k]=a+i[k]*g,j[k+1]=d-i[k+1]*h;f.push(j)}return f}get box(){return this.#dS}get classNamesForDrawing(){return["highlight"]}get classNamesForOutlining(){return["highlightOutline"]}}class kz extends ii{newFreeDrawOutline(a,b,c,d,e,f){return new kA(a,b,c,d,e,f)}get classNamesForDrawing(){return["highlight","free"]}}class kA extends i9{get classNamesForDrawing(){return["highlight","free"]}get classNamesForOutlining(){return["highlightOutline","free"]}newOutliner(a,b,c,d,e,f=0){return new kz(a,b,c,d,e,f)}}class kB{#eq=null;#er=null;#es;#et=null;#eu=!1;#ev=!1;#f=null;#ew;#ex=null;#p=null;#ey;static #ez=null;static get _keyboardManager(){return B(this,"_keyboardManager",new bo([[["Escape","mac+Escape"],kB.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],kB.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],kB.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],kB.prototype._moveToPrevious],[["Home","mac+Home"],kB.prototype._moveToBeginning],[["End","mac+End"],kB.prototype._moveToEnd]]))}constructor({editor:a=null,uiManager:b=null}){a?(this.#ev=!1,this.#ey=m.HIGHLIGHT_COLOR,this.#f=a):(this.#ev=!0,this.#ey=m.HIGHLIGHT_DEFAULT_COLOR),this.#p=a?._uiManager||b,this.#ew=this.#p._eventBus,this.#es=a?.color||this.#p?.highlightColors.values().next().value||"#FFFF98",kB.#ez||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){let a=this.#eq=document.createElement("button");a.className="colorPicker",a.tabIndex="0",a.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),a.setAttribute("aria-haspopup",!0);let b=this.#p._signal;a.addEventListener("click",this.#eA.bind(this),{signal:b}),a.addEventListener("keydown",this.#c4.bind(this),{signal:b});let c=this.#er=document.createElement("span");return c.className="swatch",c.setAttribute("aria-hidden",!0),c.style.backgroundColor=this.#es,a.append(c),a}renderMainDropdown(){let a=this.#et=this.#eB();return a.setAttribute("aria-orientation","horizontal"),a.setAttribute("aria-labelledby","highlightColorPickerLabel"),a} #eB(){let kC=document.createElement("div"),kD=this.#p._signal;for(let[kE,kF]of(kC.addEventListener("contextmenu",aJ,{signal:kD}),kC.className="dropdown",kC.role="listbox",kC.setAttribute("aria-multiselectable",!1),kC.setAttribute("aria-orientation","vertical"),kC.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#p.highlightColors)){let kG=document.createElement("button");kG.tabIndex="0",kG.role="option",kG.setAttribute("data-color",kF),kG.title=kE,kG.setAttribute("data-l10n-id",kB.#ez[kE]);let kH=document.createElement("span");kG.append(kH),kH.className="swatch",kH.style.backgroundColor=kF,kG.setAttribute("aria-selected",kF===this.#es),kG.addEventListener("click",this.#eC.bind(this,kF),{signal:kD}),kC.append(kG)}return kC.addEventListener("keydown",this.#c4.bind(this),{signal:kD}),kC} #eC(kI,kJ){kJ.stopPropagation(),this.#ew.dispatch("switchannotationeditorparams",{source:this,type:this.#ey,value:kI})}_colorSelectFromKeyboard(a){if(a.target===this.#eq){this.#eA(a);return}let b=a.target.getAttribute("data-color");b&&this.#eC(b,a)}_moveToNext(a){if(!this.#eD){this.#eA(a);return}if(a.target===this.#eq){this.#et.firstChild?.focus();return}a.target.nextSibling?.focus()}_moveToPrevious(a){if(a.target===this.#et?.firstChild||a.target===this.#eq){this.#eD&&this._hideDropdownFromKeyboard();return}this.#eD||this.#eA(a),a.target.previousSibling?.focus()}_moveToBeginning(a){if(!this.#eD){this.#eA(a);return}this.#et.firstChild?.focus()}_moveToEnd(a){if(!this.#eD){this.#eA(a);return}this.#et.lastChild?.focus()} #c4(kK){kB._keyboardManager.exec(this,kK)} #eA(kL){if(this.#eD){this.hideDropdown();return}if(this.#eu=0===kL.detail,this.#ex||(this.#ex=new AbortController,window.addEventListener("pointerdown",this.#j.bind(this),{signal:this.#p.combinedSignal(this.#ex)})),this.#et){this.#et.classList.remove("hidden");return}let kM=this.#et=this.#eB();this.#eq.append(kM)} #j(kN){!this.#et?.contains(kN.target)&&this.hideDropdown()}hideDropdown(){this.#et?.classList.add("hidden"),this.#ex?.abort(),this.#ex=null}get #eD(){return this.#et&&!this.#et.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#ev){if(!this.#eD){this.#f?.unselect();return}this.hideDropdown(),this.#eq.focus({preventScroll:!0,focusVisible:this.#eu})}}updateColor(a){if(this.#er&&(this.#er.style.backgroundColor=a),!this.#et)return;let b=this.#p.highlightColors.values();for(let c of this.#et.children)c.setAttribute("aria-selected",b.next().value===a)}destroy(){this.#eq?.remove(),this.#eq=null,this.#er=null,this.#et?.remove(),this.#et=null}}class kO extends b7{#eE=null;#eF=0;#eG;#eH=null;#e=null;#eI=null;#eJ=null;#eK=0;#eL=null;#eM=null;#u=null;#eN=!1;#eO=null;#eP;#eQ=null;#eR="";#d1;#eS="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=l.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){let a=kO.prototype;return B(this,"_keyboardManager",new bo([[["ArrowLeft","mac+ArrowLeft"],a._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],a._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],a._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],a._moveCaret,{args:[3]}]]))}constructor(a){super({...a,name:"highlightEditor"}),this.color=a.color||kO._defaultColor,this.#d1=a.thickness||kO._defaultThickness,this.#eP=a.opacity||kO._defaultOpacity,this.#eG=a.boxes||null,this.#eS=a.methodOfCreation||"",this.#eR=a.text||"",this._isDraggable=!1,a.highlightId> -1?(this.#eN=!0,this.#eT(a),this.#eU()):this.#eG&&(this.#eE=a.anchorNode,this.#eF=a.anchorOffset,this.#eJ=a.focusNode,this.#eK=a.focusOffset,this.#eV(),this.#eU(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#eN?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#d1,methodOfCreation:this.#eS}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(a){return{numberOfColors:a.get("color").size}} #eV(){let kP=new jI(this.#eG,.001);this.#eM=kP.getOutlines(),{x:this.x,y:this.y,width:this.width,height:this.height}=this.#eM.box;let kQ=new jI(this.#eG,.0025,.001,"ltr"===this._uiManager.direction);this.#eI=kQ.getOutlines();let{lastPoint:kR}=this.#eI.box;this.#eO=[(kR[0]-this.x)/this.width,(kR[1]-this.y)/this.height]} #eT({highlightOutlines:kS,highlightId:kT,clipPathId:kU}){if(this.#eM=kS,this.#eI=kS.getNewOutline(this.#d1/2+1.5,.0025),kT>=0)this.#u=kT,this.#eH=kU,this.parent.drawLayer.finalizeLine(kT,kS),this.#eQ=this.parent.drawLayer.drawOutline(this.#eI);else if(this.parent){let kV=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(this.#u,kS),this.parent.drawLayer.updateBox(this.#u,kO.#eW(this.#eM.box,(kV-this.rotation+360)%360)),this.parent.drawLayer.updateLine(this.#eQ,this.#eI),this.parent.drawLayer.updateBox(this.#eQ,kO.#eW(this.#eI.box,kV))}let{x:kW,y:kX,width:kY,height:kZ}=kS.box;switch(this.rotation){case 0:this.x=kW,this.y=kX,this.width=kY,this.height=kZ;break;case 90:{let[k$,k_]=this.parentDimensions;this.x=kX,this.y=1-kW,this.width=kY*k_/k$,this.height=kZ*k$/k_;break}case 180:this.x=1-kW,this.y=1-kX,this.width=kY,this.height=kZ;break;case 270:{let[k0,k1]=this.parentDimensions;this.x=1-kX,this.y=kW,this.width=kY*k1/k0,this.height=kZ*k0/k1}}let{lastPoint:k2}=this.#eI.box;this.#eO=[(k2[0]-kW)/kY,(k2[1]-kX)/kZ]}static initialize(a,b){b7.initialize(a,b),kO._defaultColor||=b.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(a,b){switch(a){case m.HIGHLIGHT_DEFAULT_COLOR:kO._defaultColor=b;break;case m.HIGHLIGHT_THICKNESS:kO._defaultThickness=b}}translateInPage(a,b){}get toolbarPosition(){return this.#eO}updateParams(a,b){switch(a){case m.HIGHLIGHT_COLOR:this.#dK(b);break;case m.HIGHLIGHT_THICKNESS:this.#eX(b)}}static get defaultPropertiesToUpdate(){return[[m.HIGHLIGHT_DEFAULT_COLOR,kO._defaultColor],[m.HIGHLIGHT_THICKNESS,kO._defaultThickness]]}get propertiesToUpdate(){return[[m.HIGHLIGHT_COLOR,this.color||kO._defaultColor],[m.HIGHLIGHT_THICKNESS,this.#d1||kO._defaultThickness],[m.HIGHLIGHT_FREE,this.#eN]]} #dK(k3){let k4=(a,b)=>{this.color=a,this.parent?.drawLayer.changeColor(this.#u,a),this.#e?.updateColor(a),this.#eP=b,this.parent?.drawLayer.changeOpacity(this.#u,b)},k5=this.color,k6=this.#eP;this.addCommands({cmd:k4.bind(this,k3,kO._defaultOpacity),undo:k4.bind(this,k5,k6),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:m.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(k3)},!0)} #eX(k7){let k8=this.#d1,k9=a=>{this.#d1=a,this.#eY(a)};this.addCommands({cmd:k9.bind(this,k7),undo:k9.bind(this,k8),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:m.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:k7},!0)}async addEditToolbar(){let a=await super.addEditToolbar();return a?(this._uiManager.highlightColors&&(this.#e=new kB({editor:this}),a.addColorPicker(this.#e)),a):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#eZ())}getBaseTranslation(){return[0,0]}getRect(a,b){return super.getRect(a,b,this.#eZ())}onceAdded(){this.annotationElementId||this.parent.addUndoableEditor(this),this.div.focus()}remove(){this.#e$(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){if(this.parent)super.rebuild(),null!==this.div&&(this.#eU(),this.isAttachedToDOM||this.parent.add(this))}setParent(a){let b=!1;this.parent&&!a?this.#e$():a&&(this.#eU(a),b=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(a),this.show(this._isVisible),b&&this.select()} #eY(la){if(!this.#eN)return;this.#eT({highlightOutlines:this.#eM.getNewOutline(la/2)}),this.fixAndSetPosition();let[lb,lc]=this.parentDimensions;this.setDims(this.width*lb,this.height*lc)} #e$(){null!==this.#u&&this.parent&&(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#eQ),this.#eQ=null)} #eU(ld=this.parent){null===this.#u&&({id:this.#u,clipPathId:this.#eH}=ld.drawLayer.draw(this.#eM,this.color,this.#eP),this.#eQ=ld.drawLayer.drawOutline(this.#eI),this.#eL&&(this.#eL.style.clipPath=this.#eH))}static  #eW({x:le,y:lf,width:lg,height:lh},li){switch(li){case 90:return{x:1-lf-lh,y:le,width:lh,height:lg};case 180:return{x:1-le-lg,y:1-lf-lh,width:lg,height:lh};case 270:return{x:lf,y:1-le-lg,width:lh,height:lg}}return{x:le,y:lf,width:lg,height:lh}}rotate(a){let{drawLayer:b}=this.parent,c;this.#eN?(a=(a-this.rotation+360)%360,c=kO.#eW(this.#eM.box,a)):c=kO.#eW(this,a),b.rotate(this.#u,a),b.rotate(this.#eQ,a),b.updateBox(this.#u,c),b.updateBox(this.#eQ,kO.#eW(this.#eI.box,a))}render(){if(this.div)return this.div;let a=super.render();this.#eR&&(a.setAttribute("aria-label",this.#eR),a.setAttribute("role","mark")),this.#eN?a.classList.add("free"):this.div.addEventListener("keydown",this.#e_.bind(this),{signal:this._uiManager._signal});let b=this.#eL=document.createElement("div");a.append(b),b.setAttribute("aria-hidden","true"),b.className="internal",b.style.clipPath=this.#eH;let[c,d]=this.parentDimensions;return this.setDims(this.width*c,this.height*d),bd(this,this.#eL,["pointerover","pointerleave"]),this.enableEditing(),a}pointerover(){this.isSelected||this.parent.drawLayer.addClass(this.#eQ,"hovered")}pointerleave(){this.isSelected||this.parent.drawLayer.removeClass(this.#eQ,"hovered")} #e_(lj){kO._keyboardManager.exec(this,lj)}_moveCaret(a){switch(this.parent.unselect(this),a){case 0:case 2:this.#e0(!0);break;case 1:case 3:this.#e0(!1)}} #e0(lk){if(!this.#eE)return;let ll=window.getSelection();lk?ll.setPosition(this.#eE,this.#eF):ll.setPosition(this.#eJ,this.#eK)}select(){super.select(),this.#eQ&&(this.parent?.drawLayer.removeClass(this.#eQ,"hovered"),this.parent?.drawLayer.addClass(this.#eQ,"selected"))}unselect(){super.unselect(),this.#eQ&&(this.parent?.drawLayer.removeClass(this.#eQ,"selected"),this.#eN||this.#e0(!1))}get _mustFixPosition(){return!this.#eN}show(a=this._isVisible){super.show(a),this.parent&&(this.parent.drawLayer.show(this.#u,a),this.parent.drawLayer.show(this.#eQ,a))} #eZ(){return this.#eN?this.rotation:0} #e1(){if(this.#eN)return null;let[lm,ln]=this.pageDimensions,[lo,lp]=this.pageTranslation,lq=this.#eG,lr=new Float32Array(8*lq.length),ls=0;for(let{x:lt,y:lu,width:lv,height:lw}of lq){let lx=lt*lm+lo,ly=(1-lu-lw)*ln+lp;lr[ls]=lr[ls+4]=lx,lr[ls+1]=lr[ls+3]=ly,lr[ls+2]=lr[ls+6]=lx+lv*lm,lr[ls+5]=lr[ls+7]=ly+lw*ln,ls+=8}return lr} #e2(lz){return this.#eM.serialize(lz,this.#eZ())}static startHighlighting(a,b,{target:c,x:d,y:e}){let{x:f,y:g,width:h,height:i}=c.getBoundingClientRect(),j=new AbortController,k=a.combinedSignal(j),l=a=>{a.preventDefault(),a.stopPropagation()},m=b=>{j.abort(),this.#e3(a,b)};window.addEventListener("blur",m,{signal:k}),window.addEventListener("pointerup",m,{signal:k}),window.addEventListener("pointerdown",l,{capture:!0,passive:!1,signal:k}),window.addEventListener("contextmenu",aJ,{signal:k}),c.addEventListener("pointermove",this.#e4.bind(this,a),{signal:k}),this._freeHighlight=new kz({x:d,y:e},[f,g,h,i],a.scale,this._defaultThickness/2,b,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=a.drawLayer.draw(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0)}static  #e4(lA,lB){this._freeHighlight.add(lB)&&lA.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}static  #e3(lC,lD){this._freeHighlight.isEmpty()?lC.drawLayer.remove(this._freeHighlightId):lC.createAndAddNewEditor(lD,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(a,b,c){let d=null;if(a instanceof hy){let{data:{quadPoints:e,rect:f,rotation:g,id:h,color:i,opacity:j,popupRef:k},parent:{page:{pageNumber:m}}}=a;d=a={annotationType:l.HIGHLIGHT,color:Array.from(i),opacity:j,quadPoints:e,boxes:null,pageIndex:m-1,rect:f.slice(0),rotation:g,id:h,deleted:!1,popupRef:k}}else if(a instanceof hx){let{data:{inkLists:n,rect:o,rotation:p,id:q,color:r,borderStyle:{rawWidth:s},popupRef:t},parent:{page:{pageNumber:u}}}=a;d=a={annotationType:l.HIGHLIGHT,color:Array.from(r),thickness:s,inkLists:n,boxes:null,pageIndex:u-1,rect:o.slice(0),rotation:p,id:q,deleted:!1,popupRef:t}}let{color:v,quadPoints:w,inkLists:x,opacity:y}=a,z=await super.deserialize(a,b,c);z.color=P.makeHexColor(...v),z.#eP=y||1,x&&(z.#d1=a.thickness),z.annotationElementId=a.id||null,z._initialData=d;let[A,B]=z.pageDimensions,[C,D]=z.pageTranslation;if(w){let E=z.#eG=[];for(let F=0;F<w.length;F+=8)E.push({x:(w[F]-C)/A,y:1-(w[F+1]-D)/B,width:(w[F+2]-w[F])/A,height:(w[F+1]-w[F+5])/B});z.#eV(),z.#eU(),z.rotate(z.rotation)}else if(x){z.#eN=!0;let G=x[0],H={x:G[0]-C,y:B-(G[1]-D)},I=new kz(H,[0,0,A,B],1,z.#d1/2,!0,.001);for(let J=0,K=G.length;J<K;J+=2)H.x=G[J]-C,H.y=B-(G[J+1]-D),I.add(H);let{id:L,clipPathId:M}=b.drawLayer.draw(I,z.color,z._defaultOpacity,!0);z.#eT({highlightOutlines:I.getOutlines(),highlightId:L,clipPathId:M}),z.#eU()}return z}serialize(a=!1){if(this.isEmpty()||a)return null;if(this.deleted)return this.serializeDeleted();let b=this.getRect(0,0),c=b7._colorManager.convert(this.color),d={annotationType:l.HIGHLIGHT,color:c,opacity:this.#eP,thickness:this.#d1,quadPoints:this.#e1(),outlines:this.#e2(b),pageIndex:this.pageIndex,rect:b,rotation:this.#eZ(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#dR(d)?null:(d.id=this.annotationElementId,d)} #dR(lE){let{color:lF}=this._initialData;return lE.color.some((a,b)=>a!==lF[b])}renderAnnotationElement(a){return a.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class lG extends b7{#e5=0;#e6=0;#e7=null;#e8=new Path2D;#e9=!1;#fa=null;#fb=!1;#fc=!1;#fd=null;#fe=null;#ff=0;#fg=0;#fh=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=l.INK;constructor(a){super({...a,name:"inkEditor"}),this.color=a.color||null,this.thickness=a.thickness||null,this.opacity=a.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(a,b){b7.initialize(a,b)}static updateDefaultParams(a,b){switch(a){case m.INK_THICKNESS:lG._defaultThickness=b;break;case m.INK_COLOR:lG._defaultColor=b;break;case m.INK_OPACITY:lG._defaultOpacity=b/100}}updateParams(a,b){switch(a){case m.INK_THICKNESS:this.#eX(b);break;case m.INK_COLOR:this.#dK(b);break;case m.INK_OPACITY:this.#fi(b)}}static get defaultPropertiesToUpdate(){return[[m.INK_THICKNESS,lG._defaultThickness],[m.INK_COLOR,lG._defaultColor||b7._defaultLineColor],[m.INK_OPACITY,Math.round(100*lG._defaultOpacity)]]}get propertiesToUpdate(){return[[m.INK_THICKNESS,this.thickness||lG._defaultThickness],[m.INK_COLOR,this.color||lG._defaultColor||b7._defaultLineColor],[m.INK_OPACITY,Math.round(100*(this.opacity??lG._defaultOpacity))]]} #eX(lH){let lI=a=>{this.thickness=a,this.#fj()},lJ=this.thickness;this.addCommands({cmd:lI.bind(this,lH),undo:lI.bind(this,lJ),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:m.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})} #dK(lK){let lL=a=>{this.color=a,this.#fk()},lM=this.color;this.addCommands({cmd:lL.bind(this,lK),undo:lL.bind(this,lM),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:m.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})} #fi(lN){let lO=a=>{this.opacity=a,this.#fk()};lN/=100;let lP=this.opacity;this.addCommands({cmd:lO.bind(this,lN),undo:lO.bind(this,lP),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:m.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){if(this.parent)super.rebuild(),null!==this.div&&(this.canvas||(this.#fl(),this.#fm()),this.isAttachedToDOM||(this.parent.add(this),this.#fn()),this.#fj())}remove(){null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#e7&&(clearTimeout(this.#e7),this.#e7=null),this.#fd?.disconnect(),this.#fd=null,super.remove())}setParent(a){!this.parent&&a?this._uiManager.removeShouldRescale(this):this.parent&&null===a&&this._uiManager.addShouldRescale(this),super.setParent(a)}onScaleChanging(){let[a,b]=this.parentDimensions,c=this.width*a,d=this.height*b;this.setDimensions(c,d)}enableEditMode(){!this.#e9&&null!==this.canvas&&(super.enableEditMode(),this._isDraggable=!1,this.#fo())}disableEditMode(){this.isInEditMode()&&null!==this.canvas&&(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.#fp())}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length} #fq(){let{parentRotation:lQ,parentDimensions:[lR,lS]}=this;switch(lQ){case 90:return[0,lS,lS,lR];case 180:return[lR,lS,lR,lS];case 270:return[lR,0,lS,lR];default:return[0,0,lR,lS]}} #fr(){var lT;let{ctx:lU,color:lV,opacity:lW,thickness:lX,parentScale:lY,scaleFactor:lZ}=this;lU.lineWidth=lX*lY/lZ,lU.lineCap="round",lU.lineJoin="round",lU.miterLimit=10,lU.strokeStyle=`${lV}${Math.round(Math.min(255,Math.max(1,255*(lT=lW)))).toString(16).padStart(2,"0")}`} #fs(l$,l_){this.canvas.addEventListener("contextmenu",aJ,{signal:this._uiManager._signal}),this.#fp(),this.#fa=new AbortController;let l0=this._uiManager.combinedSignal(this.#fa);this.canvas.addEventListener("pointerleave",this.canvasPointerleave.bind(this),{signal:l0}),this.canvas.addEventListener("pointermove",this.canvasPointermove.bind(this),{signal:l0}),this.canvas.addEventListener("pointerup",this.canvasPointerup.bind(this),{signal:l0}),this.isEditing=!0,this.#fc||(this.#fc=!0,this.#fn(),this.thickness||=lG._defaultThickness,this.color||=lG._defaultColor||b7._defaultLineColor,this.opacity??=lG._defaultOpacity),this.currentPath.push([l$,l_]),this.#fb=!1,this.#fr(),this.#fh=()=>{this.#ft(),this.#fh&&window.requestAnimationFrame(this.#fh)},window.requestAnimationFrame(this.#fh)} #fu(l1,l2){let[l3,l4]=this.currentPath.at(-1);if(this.currentPath.length>1&&l1===l3&&l2===l4)return;let l5=this.currentPath,l6=this.#e8;if(l5.push([l1,l2]),this.#fb=!0,l5.length<=2){l6.moveTo(...l5[0]),l6.lineTo(l1,l2);return}3===l5.length&&(this.#e8=l6=new Path2D,l6.moveTo(...l5[0])),this.#fv(l6,...l5.at(-3),...l5.at(-2),l1,l2)} #fw(){if(0===this.currentPath.length)return;let l7=this.currentPath.at(-1);this.#e8.lineTo(...l7)} #fx(l8,l9){this.#fh=null,l8=Math.min(Math.max(l8,0),this.canvas.width),l9=Math.min(Math.max(l9,0),this.canvas.height),this.#fu(l8,l9),this.#fw();let ma;if(1!==this.currentPath.length)ma=this.#fy();else{let mb=[l8,l9];ma=[[mb,mb.slice(),mb.slice(),mb]]}let mc=this.#e8,md=this.currentPath;this.currentPath=[],this.#e8=new Path2D;let me=()=>{this.allRawPaths.push(md),this.paths.push(ma),this.bezierPath2D.push(mc),this._uiManager.rebuild(this)},mf=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),0===this.paths.length?this.remove():(this.canvas||(this.#fl(),this.#fm()),this.#fj())};this.addCommands({cmd:me,undo:mf,mustExec:!0})} #ft(){if(!this.#fb)return;this.#fb=!1,this.thickness,this.parentScale;let mg=this.currentPath.slice(-3),{ctx:mh}=(mg.map(a=>a[0]),mg.map(a=>a[1]),this);for(let mi of(mh.save(),mh.clearRect(0,0,this.canvas.width,this.canvas.height),this.bezierPath2D))mh.stroke(mi);mh.stroke(this.#e8),mh.restore()} #fv(mj,mk,ml,mm,mn,mo,mp){let mq=(mk+mm)/2,mr=(ml+mn)/2,ms=(mm+mo)/2,mt=(mn+mp)/2;mj.bezierCurveTo(mq+2*(mm-mq)/3,mr+2*(mn-mr)/3,ms+2*(mm-ms)/3,mt+2*(mn-mt)/3,ms,mt)} #fy(){let mu=this.currentPath;if(mu.length<=2)return[[mu[0],mu[0],mu.at(-1),mu.at(-1)]];let mv=[],mw,[mx,my]=mu[0];for(mw=1;mw<mu.length-2;mw++){let[mz,mA]=mu[mw],[mB,mC]=mu[mw+1],mD=(mz+mB)/2,mE=(mA+mC)/2,mF=[mx+2*(mz-mx)/3,my+2*(mA-my)/3],mG=[mD+2*(mz-mD)/3,mE+2*(mA-mE)/3];mv.push([[mx,my],mF,mG,[mD,mE]]),[mx,my]=[mD,mE]}let[mH,mI]=mu[mw],[mJ,mK]=mu[mw+1],mL=[mx+2*(mH-mx)/3,my+2*(mI-my)/3];return mv.push([[mx,my],mL,[mJ+2*(mH-mJ)/3,mK+2*(mI-mK)/3],[mJ,mK]]),mv} #fk(){if(this.isEmpty()){this.#fz();return}this.#fr();let{canvas:mM,ctx:mN}=this;for(let mO of(mN.setTransform(1,0,0,1,0,0),mN.clearRect(0,0,mM.width,mM.height),this.#fz(),this.bezierPath2D))mN.stroke(mO)}commit(){!this.#e9&&(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#e9=!0,this.div.classList.add("disabled"),this.#fj(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(a){this._focusEventsAllowed&&(super.focusin(a),this.enableEditMode())} #fo(){if(this.#fe)return;this.#fe=new AbortController;let mP=this._uiManager.combinedSignal(this.#fe);this.canvas.addEventListener("pointerdown",this.canvasPointerdown.bind(this),{signal:mP})} #fp(){this.pointerdownAC?.abort(),this.pointerdownAC=null}canvasPointerdown(a){0===a.button&&this.isInEditMode()&&!this.#e9&&(this.setInForeground(),a.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#fs(a.offsetX,a.offsetY))}canvasPointermove(a){a.preventDefault(),this.#fu(a.offsetX,a.offsetY)}canvasPointerup(a){a.preventDefault(),this.#fA(a)}canvasPointerleave(a){this.#fA(a)} #fA(mQ){this.#fa?.abort(),this.#fa=null,this.#fo(),this.#e7&&clearTimeout(this.#e7),this.#e7=setTimeout(()=>{this.#e7=null,this.canvas.removeEventListener("contextmenu",aJ)},10),this.#fx(mQ.offsetX,mQ.offsetY),this.addToAnnotationStorage(),this.setInBackground()} #fl(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")} #fm(){this.#fd=new ResizeObserver(a=>{let b=a[0].contentRect;b.width&&b.height&&this.setDimensions(b.width,b.height)}),this.#fd.observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{this.#fd?.disconnect(),this.#fd=null},{once:!0})}get isResizable(){return!this.isEmpty()&&this.#e9}render(){if(this.div)return this.div;let a,b;this.width&&(a=this.x,b=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");let[c,d,e,f]=this.#fq();if(this.setAt(c,d,0,0),this.setDims(e,f),this.#fl(),this.width){let[g,h]=this.parentDimensions;this.setAspectRatio(this.width*g,this.height*h),this.setAt(a*g,b*h,this.width*g,this.height*h),this.#fc=!0,this.#fn(),this.setDims(this.width*g,this.height*h),this.#fk(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#fm(),this.div} #fn(){if(!this.#fc)return;let[mR,mS]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*mR),this.canvas.height=Math.ceil(this.height*mS),this.#fz()}setDimensions(a,b){let c=Math.round(a),d=Math.round(b);if(this.#ff===c&&this.#fg===d)return;this.#ff=c,this.#fg=d,this.canvas.style.visibility="hidden";let[e,f]=this.parentDimensions;this.width=a/e,this.height=b/f,this.fixAndSetPosition(),this.#e9&&this.#fB(a,b),this.#fn(),this.#fk(),this.canvas.style.visibility="visible",this.fixDims()} #fB(mT,mU){let mV=this.#fC(),mW=(mT-mV)/this.#e6,mX=(mU-mV)/this.#e5;this.scaleFactor=Math.min(mW,mX)} #fz(){let mY=this.#fC()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+mY,this.translationY*this.scaleFactor+mY)}static  #fD(mZ){let m$=new Path2D;for(let m_=0,m0=mZ.length;m_<m0;m_++){let[m1,m2,m3,m4]=mZ[m_];0===m_&&m$.moveTo(...m1),m$.bezierCurveTo(m2[0],m2[1],m3[0],m3[1],m4[0],m4[1])}return m$}static  #fE(m5,m6,m7){let[m8,m9,na,nb]=m6;switch(m7){case 0:for(let nc=0,nd=m5.length;nc<nd;nc+=2)m5[nc]+=m8,m5[nc+1]=nb-m5[nc+1];break;case 90:for(let ne=0,nf=m5.length;ne<nf;ne+=2){let ng=m5[ne];m5[ne]=m5[ne+1]+m8,m5[ne+1]=ng+m9}break;case 180:for(let nh=0,ni=m5.length;nh<ni;nh+=2)m5[nh]=na-m5[nh],m5[nh+1]+=m9;break;case 270:for(let nj=0,nk=m5.length;nj<nk;nj+=2){let nl=m5[nj];m5[nj]=na-m5[nj+1],m5[nj+1]=nb-nl}break;default:throw Error("Invalid rotation")}return m5}static  #fF(nm,nn,no){let[np,nq,nr,ns]=nn;switch(no){case 0:for(let nt=0,nu=nm.length;nt<nu;nt+=2)nm[nt]-=np,nm[nt+1]=ns-nm[nt+1];break;case 90:for(let nv=0,nw=nm.length;nv<nw;nv+=2){let nx=nm[nv];nm[nv]=nm[nv+1]-nq,nm[nv+1]=nx-np}break;case 180:for(let ny=0,nz=nm.length;ny<nz;ny+=2)nm[ny]=nr-nm[ny],nm[ny+1]-=nq;break;case 270:for(let nA=0,nB=nm.length;nA<nB;nA+=2){let nC=nm[nA];nm[nA]=ns-nm[nA+1],nm[nA+1]=nr-nC}break;default:throw Error("Invalid rotation")}return nm} #fG(nD,nE,nF,nG){let nH=[],nI=this.thickness/2,nJ=nD*nE+nI,nK=nD*nF+nI;for(let nL of this.paths){let nM=[],nN=[];for(let nO=0,nP=nL.length;nO<nP;nO++){let[nQ,nR,nS,nT]=nL[nO];if(nQ[0]===nT[0]&&nQ[1]===nT[1]&&1===nP){let nU=nD*nQ[0]+nJ,nV=nD*nQ[1]+nK;nM.push(nU,nV),nN.push(nU,nV);break}let nW=nD*nQ[0]+nJ,nX=nD*nQ[1]+nK,nY=nD*nR[0]+nJ,nZ=nD*nR[1]+nK,n$=nD*nS[0]+nJ,n_=nD*nS[1]+nK,n0=nD*nT[0]+nJ,n1=nD*nT[1]+nK;0===nO&&(nM.push(nW,nX),nN.push(nW,nX)),nM.push(nY,nZ,n$,n_,n0,n1),nN.push(nY,nZ),nO===nP-1&&nN.push(n0,n1)}nH.push({bezier:lG.#fE(nM,nG,this.rotation),points:lG.#fE(nN,nG,this.rotation)})}return nH} #fH(){let n2=1/0,n3=-1/0,n4=1/0,n5=-1/0;for(let n6 of this.paths)for(let[n7,n8,n9,oa]of n6){let ob=P.bezierBoundingBox(...n7,...n8,...n9,...oa);n2=Math.min(n2,ob[0]),n4=Math.min(n4,ob[1]),n3=Math.max(n3,ob[2]),n5=Math.max(n5,ob[3])}return[n2,n4,n3,n5]} #fC(){return this.#e9?Math.ceil(this.thickness*this.parentScale):0} #fj(oc=!1){if(this.isEmpty())return;if(!this.#e9){this.#fk();return}let od=this.#fH(),oe=this.#fC();this.#e6=Math.max(b7.MIN_SIZE,od[2]-od[0]),this.#e5=Math.max(b7.MIN_SIZE,od[3]-od[1]);let of=Math.ceil(oe+this.#e6*this.scaleFactor),og=Math.ceil(oe+this.#e5*this.scaleFactor),[oh,oi]=this.parentDimensions;this.width=of/oh,this.height=og/oi,this.setAspectRatio(of,og);let oj=this.translationX,ok=this.translationY;this.translationX=-od[0],this.translationY=-od[1],this.#fn(),this.#fk(),this.#ff=of,this.#fg=og,this.setDims(of,og);let ol=oc?oe/this.scaleFactor/2:0;this.translate(oj-this.translationX-ol,ok-this.translationY-ol)}static async deserialize(a,b,c){if(a instanceof hx)return null;let d=await super.deserialize(a,b,c);d.thickness=a.thickness,d.color=P.makeHexColor(...a.color),d.opacity=a.opacity;let[e,f]=d.pageDimensions,g=d.width*e,h=d.height*f,i=d.parentScale,j=a.thickness/2;d.#e9=!0,d.#ff=Math.round(g),d.#fg=Math.round(h);let{paths:k,rect:l,rotation:m}=a;for(let{bezier:n}of k){n=lG.#fF(n,l,m);let o=[];d.paths.push(o);let p=i*(n[0]-j),q=i*(n[1]-j);for(let r=2,s=n.length;r<s;r+=6){let t=i*(n[r]-j),u=i*(n[r+1]-j),v=i*(n[r+2]-j),w=i*(n[r+3]-j),x=i*(n[r+4]-j),y=i*(n[r+5]-j);o.push([[p,q],[t,u],[v,w],[x,y]]),p=x,q=y}let z=this.#fD(o);d.bezierPath2D.push(z)}let A=d.#fH();return d.#e6=Math.max(b7.MIN_SIZE,A[2]-A[0]),d.#e5=Math.max(b7.MIN_SIZE,A[3]-A[1]),d.#fB(g,h),d}serialize(){if(this.isEmpty())return null;let a=this.getRect(0,0),b=b7._colorManager.convert(this.ctx.strokeStyle);return{annotationType:l.INK,color:b,thickness:this.thickness,opacity:this.opacity,paths:this.#fG(this.scaleFactor/this.parentScale,this.translationX,this.translationY,a),pageIndex:this.pageIndex,rect:a,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}class om extends b7{#fI=null;#fJ=null;#fK=null;#fL=null;#fM=null;#fN="";#fO=null;#fd=null;#fP=null;#fQ=!1;#fR=!1;static _type="stamp";static _editorType=l.STAMP;constructor(a){super({...a,name:"stampEditor"}),this.#fL=a.bitmapUrl,this.#fM=a.bitmapFile}static initialize(a,b){b7.initialize(a,b)}static get supportedTypes(){return B(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(a=>`image/${a}`))}static get supportedTypesStr(){return B(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(a){return this.supportedTypes.includes(a)}static paste(a,b){b.pasteEditor(l.STAMP,{bitmapFile:a.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(a){let b=a.get("hasAltText");return{hasAltText:b.get(!0)??0,hasNoAltText:b.get(!1)??0}} #fS(on,oo=!1){if(!on){this.remove();return}this.#fI=on.bitmap,oo||(this.#fJ=on.id,this.#fQ=on.isSvg),on.file&&(this.#fN=on.file.name),this.#fl()} #fT(){if(this.#fK=null,this._uiManager.enableWaiting(!1),this.#fO){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#fI){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#fI){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(a=null,b=!0){if(this.hasAltTextData())return null;let{mlManager:c}=this._uiManager;if(!c)throw Error("No ML.");if(!await c.isEnabledFor("altText"))throw Error("ML isn't enabled for alt text.");let{data:d,width:e,height:f}=a||this.copyCanvas(null,null,!0).imageData,g=await c.guess({name:"altText",request:{data:d,width:e,height:f,channels:d.length/(e*f)}});if(!g)throw Error("No response from the AI service.");if(g.error)throw Error("Error from the AI service.");if(g.cancel)return null;if(!g.output)throw Error("No valid response from the AI service.");let h=g.output;return await this.setGuessedAltText(h),b&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h} #fU(){if(this.#fJ){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#fJ).then(a=>this.#fS(a,!0)).finally(()=>this.#fT());return}if(this.#fL){let op=this.#fL;this.#fL=null,this._uiManager.enableWaiting(!0),this.#fK=this._uiManager.imageManager.getFromUrl(op).then(a=>this.#fS(a)).finally(()=>this.#fT());return}if(this.#fM){let oq=this.#fM;this.#fM=null,this._uiManager.enableWaiting(!0),this.#fK=this._uiManager.imageManager.getFromFile(oq).then(a=>this.#fS(a)).finally(()=>this.#fT());return}let or=document.createElement("input");or.type="file",or.accept=om.supportedTypesStr;let os=this._uiManager._signal;this.#fK=new Promise(a=>{or.addEventListener("change",async()=>{if(or.files&&0!==or.files.length){this._uiManager.enableWaiting(!0);let b=await this._uiManager.imageManager.getFromFile(or.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#fS(b)}else this.remove();a()},{signal:os}),or.addEventListener("cancel",()=>{this.remove(),a()},{signal:os})}).finally(()=>this.#fT()),or.click()}remove(){this.#fJ&&(this.#fI=null,this._uiManager.imageManager.deleteId(this.#fJ),this.#fO?.remove(),this.#fO=null,this.#fd?.disconnect(),this.#fd=null,this.#fP&&(clearTimeout(this.#fP),this.#fP=null)),super.remove()}rebuild(){if(!this.parent){this.#fJ&&this.#fU();return}super.rebuild(),null!==this.div&&(this.#fJ&&null===this.#fO&&this.#fU(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#fK||this.#fI||this.#fL||this.#fM||this.#fJ)}get isResizable(){return!0}render(){if(this.div)return this.div;let a,b;if(this.width&&(a=this.x,b=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),this.#fI?this.#fl():this.#fU(),this.width&&!this.annotationElementId){let[c,d]=this.parentDimensions;this.setAt(a*c,b*d,this.width*c,this.height*d)}return this.div} #fl(){let{div:ot}=this,{width:ou,height:ov}=this.#fI,[ow,ox]=this.pageDimensions,oy=.75;if(this.width)ou=this.width*ow,ov=this.height*ox;else if(ou>oy*ow||ov>oy*ox){let oz=Math.min(oy*ow/ou,oy*ox/ov);ou*=oz,ov*=oz}let[oA,oB]=this.parentDimensions;this.setDims(ou*oA/ow,ov*oB/ox),this._uiManager.enableWaiting(!1);let oC=this.#fO=document.createElement("canvas");oC.setAttribute("role","img"),this.addContainer(oC),this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&!this.annotationElementId||(ot.hidden=!1),this.#fV(ou,ov),this.#fm(),this.#fR||(this.parent.addUndoableEditor(this),this.#fR=!0),this._reportTelemetry({action:"inserted_image"}),this.#fN&&oC.setAttribute("aria-label",this.#fN)}copyCanvas(a,b,c=!1){a||(a=224);let{width:d,height:e}=this.#fI,f=new aR,g=this.#fI,h=d,i=e,j=null;if(b){if(d>b||e>b){let k=Math.min(b/d,b/e);h=Math.floor(d*k),i=Math.floor(e*k)}j=document.createElement("canvas");let l=j.width=Math.ceil(h*f.sx),m=j.height=Math.ceil(i*f.sy);this.#fQ||(g=this.#fW(l,m));let n=j.getContext("2d");n.filter=this._uiManager.hcmFilter;let o="white",p="#cfcfd8";"none"!==this._uiManager.hcmFilter?p="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(o="#8f8f9d",p="#42414d");let q=15,r=q*f.sx,s=q*f.sy,t=new OffscreenCanvas(2*r,2*s),u=t.getContext("2d");u.fillStyle=o,u.fillRect(0,0,2*r,2*s),u.fillStyle=p,u.fillRect(0,0,r,s),u.fillRect(r,s,r,s),n.fillStyle=n.createPattern(t,"repeat"),n.fillRect(0,0,l,m),n.drawImage(g,0,0,g.width,g.height,0,0,l,m)}let v=null;if(c){let w,x;if(f.symmetric&&g.width<a&&g.height<a)w=g.width,x=g.height;else if(g=this.#fI,d>a||e>a){let y=Math.min(a/d,a/e);w=Math.floor(d*y),x=Math.floor(e*y),this.#fQ||(g=this.#fW(w,x))}let z=new OffscreenCanvas(w,x),A=z.getContext("2d",{willReadFrequently:!0});A.drawImage(g,0,0,g.width,g.height,0,0,w,x),v={width:w,height:x,data:A.getImageData(0,0,w,x).data}}return{canvas:j,width:h,height:i,imageData:v}} #fX(oD,oE){let[oF,oG]=this.parentDimensions;this.width=oD/oF,this.height=oE/oG,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,null!==this.#fP&&clearTimeout(this.#fP),this.#fP=setTimeout(()=>{this.#fP=null,this.#fV(oD,oE)},200)} #fW(oH,oI){let{width:oJ,height:oK}=this.#fI,oL=oJ,oM=oK,oN=this.#fI;for(;oL>2*oH||oM>2*oI;){let oO=oL,oP=oM;oL>2*oH&&(oL=oL>=16384?Math.floor(oL/2)-1:Math.ceil(oL/2)),oM>2*oI&&(oM=oM>=16384?Math.floor(oM/2)-1:Math.ceil(oM/2));let oQ=new OffscreenCanvas(oL,oM),oR=oQ.getContext("2d");oR.drawImage(oN,0,0,oO,oP,0,0,oL,oM),oN=oQ.transferToImageBitmap()}return oN} #fV(oS,oT){let oU=new aR,oV=Math.ceil(oS*oU.sx),oW=Math.ceil(oT*oU.sy),oX=this.#fO;if(!oX||oX.width===oV&&oX.height===oW)return;oX.width=oV,oX.height=oW;let oY=this.#fQ?this.#fI:this.#fW(oV,oW),oZ=oX.getContext("2d");oZ.filter=this._uiManager.hcmFilter,oZ.drawImage(oY,0,0,oY.width,oY.height,0,0,oV,oW)}getImageForAltText(){return this.#fO} #fY(o$){if(o$){if(this.#fQ){let o_=this._uiManager.imageManager.getSvgUrl(this.#fJ);if(o_)return o_}let o0=document.createElement("canvas");({width:o0.width,height:o0.height}=this.#fI);let o1=o0.getContext("2d");return o1.drawImage(this.#fI,0,0),o0.toDataURL()}if(this.#fQ){let[o2,o3]=this.pageDimensions,o4=Math.round(this.width*o2*az.PDF_TO_CSS_UNITS),o5=Math.round(this.height*o3*az.PDF_TO_CSS_UNITS),o6=new OffscreenCanvas(o4,o5),o7=o6.getContext("2d");return o7.drawImage(this.#fI,0,0,this.#fI.width,this.#fI.height,0,0,o4,o5),o6.transferToImageBitmap()}return structuredClone(this.#fI)} #fm(){this._uiManager._signal&&(this.#fd=new ResizeObserver(a=>{let b=a[0].contentRect;b.width&&b.height&&this.#fX(b.width,b.height)}),this.#fd.observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{this.#fd?.disconnect(),this.#fd=null},{once:!0}))}static async deserialize(a,b,c){let d=null;if(a instanceof hC){let{data:{rect:e,rotation:f,id:g,structParent:h,popupRef:i},container:j,parent:{page:{pageNumber:k}}}=a,m=j.querySelector("canvas"),n=c.imageManager.getFromCanvas(j.id,m);m.remove();let o=(await b._structTree.getAriaAttributes(`${aw}${g}`))?.get("aria-label")||"";d=a={annotationType:l.STAMP,bitmapId:n.id,bitmap:n.bitmap,pageIndex:k-1,rect:e.slice(0),rotation:f,id:g,deleted:!1,accessibilityData:{decorative:!1,altText:o},isSvg:!1,structParent:h,popupRef:i}}let p=await super.deserialize(a,b,c),{rect:q,bitmap:r,bitmapUrl:s,bitmapId:t,isSvg:u,accessibilityData:v}=a;t&&c.imageManager.isValidId(t)?(p.#fJ=t,r&&(p.#fI=r)):p.#fL=s,p.#fQ=u;let[w,x]=p.pageDimensions;return p.width=(q[2]-q[0])/w,p.height=(q[3]-q[1])/x,p.annotationElementId=a.id||null,v&&(p.altTextData=v),p._initialData=d,p.#fR=!!d,p}serialize(a=!1,b=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let c={annotationType:l.STAMP,bitmapId:this.#fJ,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#fQ,structTreeParentId:this._structTreeParentId};if(a)return c.bitmapUrl=this.#fY(!0),c.accessibilityData=this.serializeAltText(!0),c;let{decorative:d,altText:e}=this.serializeAltText(!1);if(!d&&e&&(c.accessibilityData={type:"Figure",alt:e}),this.annotationElementId){let f=this.#dR(c);if(f.isSame)return null;f.isSameAltText?delete c.accessibilityData:c.accessibilityData.structParent=this._initialData.structParent?? -1}if(c.id=this.annotationElementId,null===b)return c;b.stamps||=new Map;let g=this.#fQ?(c.rect[2]-c.rect[0])*(c.rect[3]-c.rect[1]):null;if(b.stamps.has(this.#fJ)){if(this.#fQ){let h=b.stamps.get(this.#fJ);g>h.area&&(h.area=g,h.serialized.bitmap.close(),h.serialized.bitmap=this.#fY(!1))}}else b.stamps.set(this.#fJ,{area:g,serialized:c}),c.bitmap=this.#fY(!1);return c} #dR(o8){let{rect:o9,pageIndex:pa,accessibilityData:{altText:pb}}=this._initialData,pc=o8.rect.every((a,b)=>1>Math.abs(a-o9[b])),pd=o8.pageIndex===pa,pe=(o8.accessibilityData?.alt||"")===pb;return{isSame:pc&&pd&&pe,isSameAltText:pe}}renderAnnotationElement(a){return a.updateEdited({rect:this.getRect(0,0)}),null}}class pf{#dA;#fZ=!1;#f$=null;#f_=null;#f0=null;#f1=new Map;#f2=!1;#f3=!1;#f4=!1;#f5=null;#f6=null;#p;static _initialized=!1;static #O=new Map([hS,lG,om,kO].map(a=>[a._editorType,a]));constructor({uiManager:a,pageIndex:b,div:c,structTreeLayer:d,accessibilityManager:e,annotationLayer:f,drawLayer:g,textLayer:h,viewport:i,l10n:j}){let k=[...pf.#O.values()];if(!pf._initialized)for(let l of(pf._initialized=!0,k))l.initialize(j,a);a.registerEditorTypes(k),this.#p=a,this.pageIndex=b,this.div=c,this.#dA=e,this.#f$=f,this.viewport=i,this.#f5=h,this.drawLayer=g,this._structTree=d,this.#p.addLayer(this)}get isEmpty(){return 0===this.#f1.size}get isInvisible(){return this.isEmpty&&this.#p.getMode()===l.NONE}updateToolbar(a){this.#p.updateToolbar(a)}updateMode(a=this.#p.getMode()){switch(this.#f7(),a){case l.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case l.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case l.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:b}=this.div;for(let c of pf.#O.values())b.toggle(`${c._type}Editing`,a===c._editorType);this.div.hidden=!1}hasTextLayer(a){return a===this.#f5?.div}addInkEditorIfNeeded(a){if(this.#p.getMode()!==l.INK)return;if(!a){for(let b of this.#f1.values())if(b.isEmpty()){b.setInBackground();return}}let c=this.createAndAddNewEditor({offsetX:0,offsetY:0},!1);c.setInBackground()}setEditingState(a){this.#p.setEditingState(a)}addCommands(a){this.#p.addCommands(a)}toggleDrawing(a=!1){this.div.classList.toggle("drawing",!a)}togglePointerEvents(a=!1){this.div.classList.toggle("disabled",!a)}toggleAnnotationLayerPointerEvents(a=!1){this.#f$?.div.classList.toggle("disabled",!a)}async enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);let a=new Set;for(let b of this.#f1.values())b.enableEditing(),b.show(!0),b.annotationElementId&&(this.#p.removeChangedExistingAnnotation(b),a.add(b.annotationElementId));if(!this.#f$)return;let c=this.#f$.getEditableAnnotations();for(let d of c){if(d.hide(),this.#p.isDeletedAnnotationElement(d.data.id)||a.has(d.data.id))continue;let e=await this.deserialize(d);e&&(this.addOrRebuild(e),e.enableEditing())}}disable(){this.#f4=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);let a=new Map,b=new Map;for(let c of this.#f1.values())if(c.disableEditing(),c.annotationElementId){if(null!==c.serialize()){a.set(c.annotationElementId,c);continue}b.set(c.annotationElementId,c),this.getEditableAnnotation(c.annotationElementId)?.show(),c.remove()}if(this.#f$){let d=this.#f$.getEditableAnnotations();for(let e of d){let{id:f}=e.data;if(this.#p.isDeletedAnnotationElement(f))continue;let g=b.get(f);if(g){g.resetAnnotationElement(e),g.show(!1),e.show();continue}(g=a.get(f))&&(this.#p.addChangedExistingAnnotation(g),g.renderAnnotationElement(e)&&g.show(!1)),e.show()}}this.#f7(),this.isEmpty&&(this.div.hidden=!0);let{classList:h}=this.div;for(let i of pf.#O.values())h.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#f4=!1}getEditableAnnotation(a){return this.#f$?.getEditableAnnotation(a)||null}setActiveEditor(a){let b=this.#p.getActive();b!==a&&this.#p.setActiveEditor(a)}enableTextSelection(){if(this.div.tabIndex=-1,this.#f5?.div&&!this.#f6){this.#f6=new AbortController;let a=this.#p.combinedSignal(this.#f6);this.#f5.div.addEventListener("pointerdown",this.#f8.bind(this),{signal:a}),this.#f5.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#f5?.div&&this.#f6&&(this.#f6.abort(),this.#f6=null,this.#f5.div.classList.remove("highlighting"))} #f8(pg){this.#p.unselectAll();let{target:ph}=pg;if(ph===this.#f5.div||("img"===ph.getAttribute("role")||ph.classList.contains("endOfContent"))&&this.#f5.div.contains(ph)){let{isMac:pi}=N.platform;if(0!==pg.button||pg.ctrlKey&&pi)return;this.#p.showAllEditors("highlight",!0,!0),this.#f5.div.classList.add("free"),this.toggleDrawing(),kO.startHighlighting(this,"ltr"===this.#p.direction,{target:this.#f5.div,x:pg.x,y:pg.y}),this.#f5.div.addEventListener("pointerup",()=>{this.#f5.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#p._signal}),pg.preventDefault()}}enableClick(){if(this.#f_)return;this.#f_=new AbortController;let a=this.#p.combinedSignal(this.#f_);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:a}),this.div.addEventListener("pointerup",this.pointerup.bind(this),{signal:a})}disableClick(){this.#f_?.abort(),this.#f_=null}attach(a){this.#f1.set(a.id,a);let{annotationElementId:b}=a;b&&this.#p.isDeletedAnnotationElement(b)&&this.#p.removeDeletedAnnotationElement(a)}detach(a){this.#f1.delete(a.id),this.#dA?.removePointerInTextLayer(a.contentDiv),!this.#f4&&a.annotationElementId&&this.#p.addDeletedAnnotationElement(a)}remove(a){this.detach(a),this.#p.removeEditor(a),a.div.remove(),a.isAttachedToDOM=!1,this.#f3||this.addInkEditorIfNeeded(!1)}changeParent(a){a.parent!==this&&(a.parent&&a.annotationElementId&&(this.#p.addDeletedAnnotationElement(a.annotationElementId),b7.deleteAnnotationElement(a),a.annotationElementId=null),this.attach(a),a.parent?.detach(a),a.setParent(this),a.div&&a.isAttachedToDOM&&(a.div.remove(),this.div.append(a.div)))}add(a){if(a.parent!==this||!a.isAttachedToDOM){if(this.changeParent(a),this.#p.addEditor(a),this.attach(a),!a.isAttachedToDOM){let b=a.render();this.div.append(b),a.isAttachedToDOM=!0}a.fixAndSetPosition(),a.onceAdded(),this.#p.addToAnnotationStorage(a),a._reportTelemetry(a.telemetryInitialData)}}moveEditorInDOM(a){if(!a.isAttachedToDOM)return;let{activeElement:b}=document;a.div.contains(b)&&!this.#f0&&(a._focusEventsAllowed=!1,this.#f0=setTimeout(()=>{this.#f0=null,a.div.contains(document.activeElement)?a._focusEventsAllowed=!0:(a.div.addEventListener("focusin",()=>{a._focusEventsAllowed=!0},{once:!0,signal:this.#p._signal}),b.focus())},0)),a._structTreeParentId=this.#dA?.moveElementInDOM(this.div,a.div,a.contentDiv,!0)}addOrRebuild(a){a.needsToBeRebuilt()?(a.parent||=this,a.rebuild(),a.show()):this.add(a)}addUndoableEditor(a){let b=()=>a._uiManager.rebuild(a),c=()=>{a.remove()};this.addCommands({cmd:b,undo:c,mustExec:!1})}getNextId(){return this.#p.getId()}get #f9(){return pf.#O.get(this.#p.getMode())}combinedSignal(a){return this.#p.combinedSignal(a)} #ga(pj){let pk=this.#f9;return pk?new pk.prototype.constructor(pj):null}canCreateNewEmptyEditor(){return this.#f9?.canCreateNewEmptyEditor()}pasteEditor(a,b){this.#p.updateToolbar(a),this.#p.updateMode(a);let{offsetX:c,offsetY:d}=this.#gb(),e=this.getNextId(),f=this.#ga({parent:this,id:e,x:c,y:d,uiManager:this.#p,isCentered:!0,...b});f&&this.add(f)}async deserialize(a){return await pf.#O.get(a.annotationType??a.annotationEditorType)?.deserialize(a,this,this.#p)||null}createAndAddNewEditor(a,b,c={}){let d=this.getNextId(),e=this.#ga({parent:this,id:d,x:a.offsetX,y:a.offsetY,uiManager:this.#p,isCentered:b,...c});return e&&this.add(e),e} #gb(){let{x:pl,y:pm,width:pn,height:po}=this.div.getBoundingClientRect(),pp=Math.min(window.innerWidth,pl+pn),pq=Math.min(window.innerHeight,pm+po),pr=(Math.max(0,pl)+pp)/2-pl,ps=(Math.max(0,pm)+pq)/2-pm,[pt,pu]=this.viewport.rotation%180==0?[pr,ps]:[ps,pr];return{offsetX:pt,offsetY:pu}}addNewEditor(){this.createAndAddNewEditor(this.#gb(),!0)}setSelected(a){this.#p.setSelected(a)}toggleSelected(a){this.#p.toggleSelected(a)}unselect(a){this.#p.unselect(a)}pointerup(a){let{isMac:b}=N.platform;if(0===a.button&&(!a.ctrlKey||!b)&&a.target===this.div&&this.#f2){if(this.#f2=!1,!this.#fZ){this.#fZ=!0;return}if(this.#p.getMode()===l.STAMP){this.#p.unselectAll();return}this.createAndAddNewEditor(a,!1)}}pointerdown(a){if(this.#p.getMode()===l.HIGHLIGHT&&this.enableTextSelection(),this.#f2){this.#f2=!1;return}let{isMac:b}=N.platform;if(0!==a.button||a.ctrlKey&&b||a.target!==this.div)return;this.#f2=!0;let c=this.#p.getActive();this.#fZ=!c||c.isEmpty()}findNewParent(a,b,c){let d=this.#p.findParent(b,c);return null!==d&&d!==this&&(d.changeParent(a),!0)}destroy(){for(let a of(this.#p.getActive()?.parent===this&&(this.#p.commitOrRemove(),this.#p.setActiveEditor(null)),this.#f0&&(clearTimeout(this.#f0),this.#f0=null),this.#f1.values()))this.#dA?.removePointerInTextLayer(a.contentDiv),a.setParent(null),a.isAttachedToDOM=!1,a.div.remove();this.div=null,this.#f1.clear(),this.#p.removeLayer(this)} #f7(){for(let pv of(this.#f3=!0,this.#f1.values()))pv.isEmpty()&&pv.remove();this.#f3=!1}render({viewport:a}){for(let b of(this.viewport=a,aQ(this.div,a),this.#p.getEditors(this.pageIndex)))this.add(b),b.rebuild();this.updateMode()}update({viewport:a}){this.#p.commitOrRemove(),this.#f7();let b=this.viewport.rotation,c=a.rotation;if(this.viewport=a,aQ(this.div,{rotation:c}),b!==c)for(let d of this.#f1.values())d.rotate(c);this.addInkEditorIfNeeded(!1)}get pageDimensions(){let{pageWidth:a,pageHeight:b}=this.viewport.rawDims;return[a,b]}get scale(){return this.#p.viewParameters.realScale}}class pw{#df=null;#u=0;#gc=new Map;#gd=new Map;constructor({pageIndex:a}){this.pageIndex=a}setParent(a){if(!this.#df){this.#df=a;return}if(this.#df!==a){if(this.#gc.size>0)for(let b of this.#gc.values())b.remove(),a.append(b);this.#df=a}}static get _svgFactory(){return B(this,"_svgFactory",new gC)}static  #ge(px,{x:py=0,y:pz=0,width:pA=1,height:pB=1}={}){let{style:pC}=px;pC.top=`${100*pz}%`,pC.left=`${100*py}%`,pC.width=`${100*pA}%`,pC.height=`${100*pB}%`} #gf(pD){let pE=pw._svgFactory.create(1,1,!0);return this.#df.append(pE),pE.setAttribute("aria-hidden",!0),pw.#ge(pE,pD),pE} #gg(pF,pG){let pH=pw._svgFactory.createElement("clipPath");pF.append(pH);let pI=`clip_${pG}`;pH.setAttribute("id",pI),pH.setAttribute("clipPathUnits","objectBoundingBox");let pJ=pw._svgFactory.createElement("use");return pH.append(pJ),pJ.setAttribute("href",`#${pG}`),pJ.classList.add("clip"),pI}draw(a,b,c,d=!1){let e=this.#u++,f=this.#gf(a.box);f.classList.add(...a.classNamesForDrawing);let g=pw._svgFactory.createElement("defs");f.append(g);let h=pw._svgFactory.createElement("path");g.append(h);let i=`path_p${this.pageIndex}_${e}`;h.setAttribute("id",i),h.setAttribute("d",a.toSVGPath()),d&&this.#gd.set(e,h);let j=this.#gg(g,i),k=pw._svgFactory.createElement("use");return f.append(k),f.setAttribute("fill",b),f.setAttribute("fill-opacity",c),k.setAttribute("href",`#${i}`),this.#gc.set(e,f),{id:e,clipPathId:`url(#${j})`}}drawOutline(a){let b=this.#u++,c=this.#gf(a.box);c.classList.add(...a.classNamesForOutlining);let d=pw._svgFactory.createElement("defs");c.append(d);let e=pw._svgFactory.createElement("path");d.append(e);let f=`path_p${this.pageIndex}_${b}`;e.setAttribute("id",f),e.setAttribute("d",a.toSVGPath()),e.setAttribute("vector-effect","non-scaling-stroke");let g;if(a.mustRemoveSelfIntersections){let h=pw._svgFactory.createElement("mask");d.append(h),g=`mask_p${this.pageIndex}_${b}`,h.setAttribute("id",g),h.setAttribute("maskUnits","objectBoundingBox");let i=pw._svgFactory.createElement("rect");h.append(i),i.setAttribute("width","1"),i.setAttribute("height","1"),i.setAttribute("fill","white");let j=pw._svgFactory.createElement("use");h.append(j),j.setAttribute("href",`#${f}`),j.setAttribute("stroke","none"),j.setAttribute("fill","black"),j.setAttribute("fill-rule","nonzero"),j.classList.add("mask")}let k=pw._svgFactory.createElement("use");c.append(k),k.setAttribute("href",`#${f}`),g&&k.setAttribute("mask",`url(#${g})`);let l=k.cloneNode();return c.append(l),k.classList.add("mainOutline"),l.classList.add("secondaryOutline"),this.#gc.set(b,c),b}finalizeLine(a,b){let c=this.#gd.get(a);this.#gd.delete(a),this.updateBox(a,b.box),c.setAttribute("d",b.toSVGPath())}updateLine(a,b){let c=this.#gc.get(a),d=c.firstChild,e=d.firstChild;e.setAttribute("d",b.toSVGPath())}updatePath(a,b){this.#gd.get(a).setAttribute("d",b.toSVGPath())}updateBox(a,b){pw.#ge(this.#gc.get(a),b)}show(a,b){this.#gc.get(a).classList.toggle("hidden",!b)}rotate(a,b){this.#gc.get(a).setAttribute("data-main-rotation",b)}changeColor(a,b){this.#gc.get(a).setAttribute("fill",b)}changeOpacity(a,b){this.#gc.get(a).setAttribute("fill-opacity",b)}addClass(a,b){this.#gc.get(a).classList.add(b)}removeClass(a,b){this.#gc.get(a).classList.remove(b)}getSVGRoot(a){return this.#gc.get(a)}remove(a){this.#gd.delete(a),null!==this.#df&&(this.#gc.get(a).remove(),this.#gc.delete(a))}destroy(){for(let a of(this.#df=null,this.#gc.values()))a.remove();this.#gc.clear(),this.#gd.clear()}}var pK=b.AbortException,pL=b.AnnotationEditorLayer,pM=b.AnnotationEditorParamsType,pN=b.AnnotationEditorType,pO=b.AnnotationEditorUIManager,pP=b.AnnotationLayer,pQ=b.AnnotationMode,pR=b.ColorPicker,pS=b.DOMSVGFactory,pT=b.DrawLayer,pU=b.FeatureTest,pV=b.GlobalWorkerOptions,pW=b.ImageKind,pX=b.InvalidPDFException,pY=b.MissingPDFException,pZ=b.OPS,p$=b.OutputScale,p_=b.PDFDataRangeTransport,p0=b.PDFDateString,p1=b.PDFWorker,p2=b.PasswordResponses,p3=b.PermissionFlag,p4=b.PixelsPerInch,p5=b.RenderingCancelledException,p6=b.TextLayer,p7=b.UnexpectedResponseException,p8=b.Util,p9=b.VerbosityLevel,qa=b.XfaLayer,qb=b.build,qc=b.createValidAbsoluteUrl,qd=b.fetchData,qe=b.getDocument,qf=b.getFilenameFromUrl,qg=b.getPdfFilenameFromUrl,qh=b.getXfaPageViewport,qi=b.isDataScheme,qj=b.isPdfFile,qk=b.noContextMenu,ql=b.normalizeUnicode,qm=b.setLayerDimensions,qn=b.shadow,qo=b.version}}])